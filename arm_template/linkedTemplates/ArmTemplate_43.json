{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "EnterpriseDataSourceProdDF"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/initialLoad_CardEntryMethod')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Reference"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "dim_Card_Entry_Method",
                                "type": "DatasetReference"
                            },
                            "name": "DimCardEntryMethod"
                        },
                        {
                            "dataset": {
                                "referenceName": "CardEntryMethod",
                                "type": "DatasetReference"
                            },
                            "name": "CardEntryMethod"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Card_Entry_Method",
                                "type": "DatasetReference"
                            },
                            "name": "snkDimCardEntryMethod"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Trim"
                        },
                        {
                            "name": "DoesExist"
                        },
                        {
                            "name": "MarkUpdates"
                        },
                        {
                            "name": "DoesntExist"
                        },
                        {
                            "name": "MarkInserts"
                        },
                        {
                            "name": "Union1"
                        },
                        {
                            "name": "CreateCardEntryMethodHashkey"
                        },
                        {
                            "name": "CreateSourceSystem"
                        },
                        {
                            "name": "RemoveKeyFromOnPrem"
                        },
                        {
                            "name": "GetDistinctResponseCodes"
                        },
                        {
                            "name": "GetCreateDate"
                        },
                        {
                            "name": "RemoveNegative1"
                        }
                    ],
                    "script": "source(output(\n\t\tcard_entry_key as long,\n\t\tsource_system_key as integer,\n\t\tcard_entry_cde as string,\n\t\tcard_entry_name as string,\n\t\tcard_entry_type as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DimCardEntryMethod\nsource(output(\n\t\tCardEntryMethodID as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardEntryMethodName as string,\n\t\tCardEntryMethodType as string,\n\t\tRecordCreated as string,\n\t\tmeta_batch_key as string,\n\t\tmeta_insert_date as string,\n\t\tsource_system_key as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> CardEntryMethod\nRemoveKeyFromOnPrem derive(each(match(type=='string'), $$ = trim($$))) ~> Trim\nGetDistinctResponseCodes, DimCardEntryMethod exists(CardEntryMethodHashkey == card_entry_key,\n\tnegate:false,\n\tbroadcast: 'auto')~> DoesExist\nDoesExist alterRow(updateIf(true())) ~> MarkUpdates\nGetDistinctResponseCodes, DimCardEntryMethod exists(CardEntryMethodHashkey == card_entry_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> DoesntExist\nDoesntExist alterRow(insertIf(true())) ~> MarkInserts\nMarkUpdates, MarkInserts union(byName: true)~> Union1\nCreateSourceSystem derive(CardEntryMethodHashkey = crc32(iif(isNull(CardEntryMethodCode),'',CardEntryMethodCode)\r\n, iif(isNull(source_system_key),0,source_system_key))) ~> CreateCardEntryMethodHashkey\nTrim derive(RecordCreated = toDate(RecordCreated, 'yyyy-mm-dd'),\n\t\tsource_system_key = toInteger(source_system_key)) ~> CreateSourceSystem\nRemoveNegative1 select(mapColumn(\n\t\tCardEntryMethodCode,\n\t\tCardEntryMethodName,\n\t\tCardEntryMethodType,\n\t\tRecordCreated,\n\t\tsource_system_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveKeyFromOnPrem\nCreateCardEntryMethodHashkey aggregate(groupBy(CardEntryMethodHashkey,\n\t\tCardEntryMethodCode,\n\t\tCardEntryMethodName,\n\t\tCardEntryMethodType,\n\t\tsource_system_key),\n\tGetMaxLoadDate = max(RecordCreated)) ~> GetDistinctResponseCodes\nUnion1 derive(create_date = currentTimestamp(),\n\t\tsource_system_key = toInteger(source_system_key)) ~> GetCreateDate\nCardEntryMethod filter(source_system_key!='-1') ~> RemoveNegative1\nGetCreateDate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tcard_entry_key as long,\n\t\tsource_system_key as integer,\n\t\tcard_entry_cde as string,\n\t\tcard_entry_name as string,\n\t\tcard_entry_type as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['card_entry_key'],\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tcard_entry_key = CardEntryMethodHashkey,\n\t\tsource_system_key,\n\t\tcard_entry_cde = CardEntryMethodCode,\n\t\tcard_entry_name = CardEntryMethodName,\n\t\tcard_entry_type = CardEntryMethodType,\n\t\tload_date = GetMaxLoadDate,\n\t\tcreate_date\n\t)) ~> snkDimCardEntryMethod"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimMerchant')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "This dataflow will use transactional conformed files to populate DimMerchant dimensional data and sink it to SQL DW dim_merchant",
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_cnfmFISTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "ConformedTransactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Merchant",
                                "type": "DatasetReference"
                            },
                            "name": "SrcDWDimMerchant"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Source_System",
                                "type": "DatasetReference"
                            },
                            "name": "SrcDWDimSourceSystem"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Merchant",
                                "type": "DatasetReference"
                            },
                            "name": "LoadDWDimMerchant"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "GetSourceSystemKey"
                        },
                        {
                            "name": "NewMerchants"
                        },
                        {
                            "name": "DistinctMerchantRows"
                        },
                        {
                            "name": "RemoveNulls"
                        },
                        {
                            "name": "ChangeSrcToLowerCase"
                        },
                        {
                            "name": "TrimSpaces"
                        },
                        {
                            "name": "CreateMerchantHashKey"
                        },
                        {
                            "name": "ChangeAttributesToTitleCase"
                        },
                        {
                            "name": "LimitColumns"
                        }
                    ],
                    "script": "parameters{\n\tfileName as string\n}\nsource(output(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string,\n\t\tTransaction_Key as long,\n\t\tAgentNo as string,\n\t\tSystemNo as string,\n\t\tOperCode as string,\n\t\tPrincipalNo as string,\n\t\tAuthorizationNo as string,\n\t\tClientNo as string,\n\t\ttransaction_amount as float,\n\t\tis_authorization as integer,\n\t\tAcquiringRTN as string,\n\t\tSettlementRTN as string,\n\t\tTraceNumber as string,\n\t\tAcqTraceNumber as string,\n\t\tVisaTransactionID as string,\n\t\tMasterCardTransactionID as string,\n\t\tMerchantAccountNumber as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> ConformedTransactions\nsource(output(\n\t\tmerchant_key as long,\n\t\tsource_system_key as integer,\n\t\tmerchant_terminal_geography_key as long,\n\t\tmerchant as string,\n\t\tmerchant_name as string,\n\t\tterminal_address as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false,\n\tpartitionColumn: 'merchant_key',\n\tpartitionBy('external', 50)) ~> SrcDWDimMerchant\nsource(output(\n\t\tsource_system_key as integer,\n\t\tsource_system_name as string,\n\t\tsource_system_description as string,\n\t\tsource_system_abbreviation as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> SrcDWDimSourceSystem\nRemoveNulls, SrcDWDimSourceSystem lookup(Source == source_system_abbreviation,\n\tmultiple: true,\n\tbroadcast: 'auto')~> GetSourceSystemKey\nCreateMerchantHashKey, SrcDWDimMerchant exists(MerchantHashkey == merchant_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> NewMerchants\nChangeSrcToLowerCase aggregate(groupBy(MerchantName,\n\t\tSource,\n\t\tTerminalAddress,\n\t\tTerminalCity,\n\t\tTerminalState,\n\t\tTerminalZipCode,\n\t\tTerminalCountry,\n\t\tImportFileDate),\n\tCount_TerminalAddress = count(TerminalAddress)) ~> DistinctMerchantRows\nDistinctMerchantRows filter(!isNull(MerchantName) && !isNull(TerminalAddress)) ~> RemoveNulls\nTrimSpaces derive(MerchantName = lower(MerchantName),\n\t\tTerminalAddress = lower(TerminalAddress),\n\t\tTerminalCity = lower(TerminalCity),\n\t\tTerminalState = lower(TerminalState),\n\t\tTerminalCountry = lower(TerminalCountry)) ~> ChangeSrcToLowerCase\nLimitColumns derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimSpaces\nGetSourceSystemKey derive(MerchantHashkey = crc32(iif(isNull(MerchantName),'',MerchantName)\r\n, iif(isNull(TerminalAddress),'',TerminalAddress)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tMerchantTerminalGeographyHashkey = crc32(iif(isNull(TerminalCity),'',TerminalCity)\r\n, iif(isNull(TerminalState),'',TerminalState)\r\n, iif(isNull(TerminalZipCode),'',TerminalZipCode)\r\n, iif(isNull(TerminalCountry),'',TerminalCountry)\r\n, iif(isNull(source_system_key),0,source_system_key))) ~> CreateMerchantHashKey\nNewMerchants derive(MerchantName = initCap(MerchantName),\n\t\tTerminalAddress = initCap(TerminalAddress),\n\t\tCreateDate = currentTimestamp()) ~> ChangeAttributesToTitleCase\nConformedTransactions select(mapColumn(\n\t\tSource,\n\t\tMerchantName,\n\t\tTerminalAddress,\n\t\tTerminalCity,\n\t\tTerminalState,\n\t\tTerminalZipCode,\n\t\tTerminalCountry,\n\t\tImportFileDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LimitColumns\nChangeAttributesToTitleCase sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmerchant_key as long,\n\t\tsource_system_key as integer,\n\t\tmerchant_terminal_geography_key as long,\n\t\tmerchant as string,\n\t\tmerchant_name as string,\n\t\tterminal_address as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tallowCopyCommand: true,\n\tbatchSize: 5000,\n\tdateFormat:'yyyy/MM/dd',\n\ttimestampFormat:'yyyy/MM/dd',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tmerchant_key = MerchantHashkey,\n\t\tsource_system_key,\n\t\tmerchant_terminal_geography_key = MerchantTerminalGeographyHashkey,\n\t\tmerchant_name = MerchantName,\n\t\tterminal_address = TerminalAddress,\n\t\tload_date = ImportFileDate,\n\t\tcreate_date = CreateDate\n\t)) ~> LoadDWDimMerchant"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/initialLoad_PaymentTokenRequestor')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Reference"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "dim_Payment_Token_Requestor",
                                "type": "DatasetReference"
                            },
                            "name": "DimPaymentTokenRequestor"
                        },
                        {
                            "dataset": {
                                "referenceName": "PaymentTokenRequestor",
                                "type": "DatasetReference"
                            },
                            "name": "PaymentTokenRequestor"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Payment_Token_Requestor",
                                "type": "DatasetReference"
                            },
                            "name": "snkDimPaymentTokenRequestor"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Trim"
                        },
                        {
                            "name": "MarkUpserts"
                        },
                        {
                            "name": "CreatePaymentTokenRequestorHashkey"
                        },
                        {
                            "name": "CreateSourceSystemFIS"
                        },
                        {
                            "name": "CreateSourceSystemFiserv"
                        },
                        {
                            "name": "UnionSourceSystems"
                        },
                        {
                            "name": "JoinDim"
                        },
                        {
                            "name": "DerivedDates"
                        },
                        {
                            "name": "SelectUpsertColumns"
                        }
                    ],
                    "script": "source(output(\n\t\tpayment_token_key as long,\n\t\tsource_system_key as integer,\n\t\ttoken_request_id as string,\n\t\ttoken_request_desc as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DimPaymentTokenRequestor\nsource(output(\n\t\tTokenReqID as string,\n\t\tTokenReqDescription as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> PaymentTokenRequestor\nPaymentTokenRequestor derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> Trim\nSelectUpsertColumns alterRow(upsertIf(true())) ~> MarkUpserts\nUnionSourceSystems derive(PaymentTokenRequestorHashkey = crc32(iif(isNull(TokenReqID),'',TokenReqID)\r\n, iif(isNull(source_system_key_src),0,source_system_key_src))) ~> CreatePaymentTokenRequestorHashkey\nTrim derive(source_system_key_src = 1,\n\t\tCreateDate = currentTimestamp()) ~> CreateSourceSystemFIS\nTrim derive(source_system_key_src = 2,\n\t\tCreateDate = currentTimestamp()) ~> CreateSourceSystemFiserv\nCreateSourceSystemFIS, CreateSourceSystemFiserv union(byName: true)~> UnionSourceSystems\nCreatePaymentTokenRequestorHashkey, DimPaymentTokenRequestor join(TokenReqID == token_request_id\n\t&& source_system_key_src == source_system_key\n\t&& PaymentTokenRequestorHashkey == payment_token_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinDim\nJoinDim derive(create_date = coalesce(create_date,CreateDate)) ~> DerivedDates\nDerivedDates select(mapColumn(\n\t\tTokenReqID,\n\t\tTokenReqDescription,\n\t\tsource_system_key_src,\n\t\tPaymentTokenRequestorHashkey,\n\t\tcreate_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectUpsertColumns\nMarkUpserts sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tpayment_token_key as long,\n\t\tsource_system_key as integer,\n\t\ttoken_request_id as string,\n\t\ttoken_request_desc as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['payment_token_key','source_system_key','token_request_id'],\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tpayment_token_key = PaymentTokenRequestorHashkey,\n\t\tsource_system_key = source_system_key_src,\n\t\ttoken_request_id = TokenReqID,\n\t\ttoken_request_desc = TokenReqDescription,\n\t\tcreate_date\n\t)) ~> snkDimPaymentTokenRequestor"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimPaymentTokenRequestor')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_cnfmFISTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "ConformedTransactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Source_System",
                                "type": "DatasetReference"
                            },
                            "name": "SourceSystem"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Payment_Token_Requestor",
                                "type": "DatasetReference"
                            },
                            "name": "srcdimPaymentTokenRequestor"
                        },
                        {
                            "dataset": {
                                "referenceName": "PaymentTokenRequestor",
                                "type": "DatasetReference"
                            },
                            "name": "srcPaymentToken"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Payment_Token_Requestor",
                                "type": "DatasetReference"
                            },
                            "name": "dimPaymentTokentRequestor"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "SourceSystemKeyTransform"
                        },
                        {
                            "name": "PaymentTokenRequestor"
                        },
                        {
                            "name": "dedupePaymenTokenRequestor"
                        },
                        {
                            "name": "removeNullPaymentToken"
                        },
                        {
                            "name": "CreateHashkey"
                        },
                        {
                            "name": "Trim"
                        },
                        {
                            "name": "JoinSource"
                        },
                        {
                            "name": "MarkUpsert"
                        },
                        {
                            "name": "SelectUpsertColumns"
                        },
                        {
                            "name": "JoinDim"
                        },
                        {
                            "name": "DerivedDates"
                        }
                    ],
                    "script": "parameters{\n\tfileName as string\n}\nsource(output(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string,\n\t\tTransaction_Key as long,\n\t\tAgentNo as string,\n\t\tSystemNo as string,\n\t\tOperCode as string,\n\t\tPrincipalNo as string,\n\t\tAuthorizationNo as string,\n\t\tClientNo as string,\n\t\ttransaction_amount as float,\n\t\tis_authorization as integer,\n\t\tAcquiringRTN as string,\n\t\tSettlementRTN as string,\n\t\tTraceNumber as string,\n\t\tAcqTraceNumber as string,\n\t\tVisaTransactionID as string,\n\t\tMasterCardTransactionID as string,\n\t\tMerchantAccountNumber as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> ConformedTransactions\nsource(output(\n\t\tsource_system_key as integer,\n\t\tsource_system_name as string,\n\t\tsource_system_description as string,\n\t\tsource_system_abbreviation as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> SourceSystem\nsource(output(\n\t\tpayment_token_key as long,\n\t\tsource_system_key as integer,\n\t\ttoken_request_id as string,\n\t\ttoken_request_desc as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false,\n\tpartitionColumn: 'payment_token_key',\n\tpartitionBy('external', 5)) ~> srcdimPaymentTokenRequestor\nsource(output(\n\t\tTokenReqID as string,\n\t\tTokenReqDescription as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcPaymentToken\nConformedTransactions, SourceSystem lookup(Source == source_system_abbreviation,\n\tmultiple: true,\n\tbroadcast: 'right')~> SourceSystemKeyTransform\nSourceSystemKeyTransform select(mapColumn(\n\t\tImportFileDate,\n\t\tTokenRequestID = TokenRequestId,\n\t\tsource_system_key_conformed = source_system_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> PaymentTokenRequestor\nPaymentTokenRequestor aggregate(groupBy(source_system_key_conformed,\n\t\tTokenRequestID),\n\tImportFileDate = min(iifNull(ImportFileDate, currentDate()))) ~> dedupePaymenTokenRequestor\nCreateHashkey filter(!isNull(TokenRequestID)) ~> removeNullPaymentToken\ndedupePaymenTokenRequestor derive(PaymentTokenRequestorHashKey = crc32(iif(isNull(TokenRequestID),'',TokenRequestID)\r\n, iif(isNull(source_system_key_conformed),0,source_system_key_conformed)),\n\t\tCreateDate = currentTimestamp()) ~> CreateHashkey\nsrcPaymentToken derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> Trim\nremoveNullPaymentToken, srcPaymentToken join(TokenRequestID == TokenReqID,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinSource\nSelectUpsertColumns alterRow(upsertIf(true())) ~> MarkUpsert\nDerivedDates select(mapColumn(\n\t\tPaymentTokenRequestorHashKey,\n\t\tsource_system_key = source_system_key_conformed,\n\t\tTokenRequestID,\n\t\tTokenReqDescription,\n\t\tImportFileDate = load_date,\n\t\tCreateDate = create_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectUpsertColumns\nJoinSource, srcdimPaymentTokenRequestor join(source_system_key_conformed == source_system_key\n\t&& TokenRequestID == token_request_id\n\t&& PaymentTokenRequestorHashKey == payment_token_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinDim\nJoinDim derive(load_date = coalesce(load_date,ImportFileDate),\n\t\tcreate_date = coalesce(create_date,CreateDate)) ~> DerivedDates\nMarkUpsert sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tpayment_token_key as long,\n\t\tsource_system_key as integer,\n\t\ttoken_request_id as string,\n\t\ttoken_request_desc as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['payment_token_key','source_system_key','token_request_id'],\n\tformat: 'table',\n\tstaged: true,\n\tallowCopyCommand: true,\n\tbatchSize: 5000,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tpayment_token_key = PaymentTokenRequestorHashKey,\n\t\tsource_system_key,\n\t\ttoken_request_id = TokenRequestID,\n\t\ttoken_request_desc = TokenReqDescription,\n\t\tload_date = ImportFileDate,\n\t\tcreate_date = CreateDate\n\t)) ~> dimPaymentTokentRequestor"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimMerchantType')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "This dataflow will  uses a static reference file to populate Dim Merchant Type in SQL DW.",
                "folder": {
                    "name": "Dimensions/Static Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "FIS_MerchantType",
                                "type": "DatasetReference"
                            },
                            "name": "srcMerchantType"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Merchant_Type",
                                "type": "DatasetReference"
                            },
                            "name": "DwDimMerchantType"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Merchant_Type",
                                "type": "DatasetReference"
                            },
                            "name": "snkDimMerchantType"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "MerchantTypeAttributes"
                        },
                        {
                            "name": "CreateHashkey"
                        },
                        {
                            "name": "NewMerchantTypes"
                        },
                        {
                            "name": "RemoveNullHashkeys"
                        }
                    ],
                    "script": "source(output(\n\t\tMerchantTypeID as string,\n\t\tMerchantType as string,\n\t\tMerchantCategoryGroup as string,\n\t\tMerchantCategoryCodeName as string,\n\t\tTransactionType as string,\n\t\tMerchantGroup as string,\n\t\tRecordCreated as string,\n\t\tmeta_batch_key as string,\n\t\tmeta_insert_date as string,\n\t\tRecordUpdated as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcMerchantType\nsource(output(\n\t\tmerchant_type_key as long,\n\t\tmerchant_type as string,\n\t\tmerchant_group as string,\n\t\tmerchant_category_code_name as string,\n\t\tmerchant_category_group as string,\n\t\ttransaction_type as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DwDimMerchantType\nsrcMerchantType select(mapColumn(\n\t\tMerchantType,\n\t\tMerchantCategoryGroup,\n\t\tMerchantCategoryCodeName,\n\t\tTransactionType,\n\t\tMerchantGroup\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> MerchantTypeAttributes\nMerchantTypeAttributes derive(load_date = currentDate(),\n\t\tcreate_date = currentTimestamp(),\n\t\tMerchantTypeHashkey = crc32(iif(isNull(MerchantType),'',MerchantType))) ~> CreateHashkey\nCreateHashkey, DwDimMerchantType exists(MerchantTypeHashkey == merchant_type_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> NewMerchantTypes\nNewMerchantTypes filter(!isNull(MerchantTypeHashkey)) ~> RemoveNullHashkeys\nRemoveNullHashkeys sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmerchant_type_key as long,\n\t\tmerchant_type as string,\n\t\tmerchant_group as string,\n\t\tmerchant_category_code_name as string,\n\t\tmerchant_category_group as string,\n\t\ttransaction_type as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tmerchant_type_key = MerchantTypeHashkey,\n\t\tmerchant_type = MerchantType,\n\t\tmerchant_group = MerchantGroup,\n\t\tmerchant_category_code_name = MerchantCategoryCodeName,\n\t\tmerchant_category_group = MerchantCategoryGroup,\n\t\ttransaction_type = TransactionType,\n\t\tload_date,\n\t\tcreate_date\n\t)) ~> snkDimMerchantType"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_FactTransactions_old')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Facts"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_cnfmFISTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "Transactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Source_System",
                                "type": "DatasetReference"
                            },
                            "name": "dimSourceSystem"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "fact_Transaction",
                                "type": "DatasetReference"
                            },
                            "name": "FactTransaction",
                            "description": "Need to fix the settltment date mapping"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "LookupSourceSystem"
                        },
                        {
                            "name": "HashKeys"
                        },
                        {
                            "name": "LowerColumns"
                        }
                    ],
                    "script": "source(output(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string,\n\t\tTransaction_Key as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> Transactions\nsource(output(\n\t\tsource_system_key as integer,\n\t\tsource_system_name as string,\n\t\tsource_system_description as string,\n\t\tsource_system_abbreviation as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> dimSourceSystem\nLowerColumns, dimSourceSystem lookup(Source == source_system_abbreviation,\n\tmultiple: true,\n\tbroadcast: 'right')~> LookupSourceSystem\nLookupSourceSystem derive(card_entry_hash_key = crc32(iif(isNull(CardEntryMethodCode),'',CardEntryMethodCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tpayment_token_hash_key = crc32(iif(isNull(TokenRequestId),'',TokenRequestId)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tresponse_code_hash_key = crc32(iif(isNull(ResponseCode),'',ResponseCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\ttransaction_name_hash_key = crc32(iif(isNull(TransactionName),'',TransactionName)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_type_hash_key = crc32(iif(isNull(MerchantType),'',MerchantType)),\n\t\tacquirer_network_hash_key = crc32(iif(isNull(AcquirerNetworkCode),'',AcquirerNetworkCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tissuer_network_hash_key = crc32(iif(isNull(IssuerNetworkCode),'',IssuerNetworkCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tterminal_hash_key = crc32(iif(isNull(TerminalKey),'',TerminalKey)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_termnial_georgraphy_hash_key = crc32(iif(isNull(TerminalCity),'',TerminalCity)\r\n, iif(isNull(TerminalState),'',TerminalState)\r\n, iif(isNull(TerminalZipCode),'',TerminalZipCode)\r\n, iif(isNull(TerminalCountry),'',TerminalCountry)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_hash_key = crc32(iif(isNull(MerchantName),'',MerchantName)\r\n, iif(isNull(TerminalAddress),'',TerminalAddress)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tbin_hash_key = crc32(iif(isNull(Bin_EXT),iif(isNull(Bin_ISO),'',Bin_ISO),Bin_EXT))) ~> HashKeys\nTransactions derive(MerchantName = lower(MerchantName),\n\t\tTerminalAddress = lower(TerminalAddress),\n\t\tTerminalCity = lower(TerminalCity),\n\t\tTerminalState = lower(TerminalState),\n\t\tTerminalZipCode = lower(TerminalZipCode),\n\t\tTerminalCountry = lower(TerminalCountry)) ~> LowerColumns\nHashKeys sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\ttransaction_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\taccount_key as string,\n\t\tacquirer_key as long,\n\t\tAcquirer_Network_key as long,\n\t\tbin_key as long,\n\t\tcard_entry_method_code_key as long,\n\t\tcard_presence_desc as string,\n\t\timport_file_date_key as date,\n\t\tinterchange_amount as decimal(25,2),\n\t\tissuer_key as long,\n\t\tissuer_network_key as long,\n\t\tmerchant_key as long,\n\t\tmerchant_terminal_geography_key as long,\n\t\tmerchant_type_key as long,\n\t\tmonetary as boolean,\n\t\ton_us_desc as string,\n\t\ttransmission_date_key as date,\n\t\torigin_date_key as date,\n\t\trecurring_desc as string,\n\t\tresponse_code_key as long,\n\t\tsettlement_amount as decimal(25,2),\n\t\tsettlement_date_key as date,\n\t\tsurcharge_amount as decimal(25,2),\n\t\ttermnial_key as long,\n\t\ttoken_requestid as long,\n\t\ttransaction_name_key as long,\n\t\tTransaction_type_key as long,\n\t\trun_id as long,\n\t\tdigital_card_issued_ind as boolean,\n\t\tauthorization_ind as boolean,\n\t\tauthorization_no as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\ttransaction_key = Transaction_Key,\n\t\tsource_system_key,\n\t\taccount_key = AccountNumber,\n\t\tacquirer_key = AcquirerAccountNumber,\n\t\tAcquirer_Network_key = acquirer_network_hash_key,\n\t\tbin_key = bin_hash_key,\n\t\tcard_entry_method_code_key = card_entry_hash_key,\n\t\tcard_presence_desc = CardPresenceDescription,\n\t\timport_file_date_key = ImportFileDate,\n\t\tinterchange_amount = InterchangeAmount,\n\t\tissuer_key = IssuerAccountNumber,\n\t\tissuer_network_key = issuer_network_hash_key,\n\t\tmerchant_key = merchant_hash_key,\n\t\tmerchant_terminal_geography_key = merchant_termnial_georgraphy_hash_key,\n\t\tmerchant_type_key = merchant_type_hash_key,\n\t\tmonetary = Monetary,\n\t\ton_us_desc = OnUsDescription,\n\t\ttransmission_date_key = OriginalDataTransmissionDate,\n\t\torigin_date_key = OriginDate,\n\t\trecurring_desc = RecurringDescription,\n\t\tresponse_code_key = response_code_hash_key,\n\t\tsettlement_amount = SettlementAmount,\n\t\tsurcharge_amount = SurchargeAmount,\n\t\ttermnial_key = terminal_hash_key,\n\t\ttoken_requestid = payment_token_hash_key,\n\t\ttransaction_name_key = transaction_name_hash_key,\n\t\tTransaction_type_key = TransactionTypeCode,\n\t\tsettlement_date_key = SettlementDate\n\t)) ~> FactTransaction"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_FactTransactions_CD031')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Facts"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_cnfmFISTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "Transactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Source_System",
                                "type": "DatasetReference"
                            },
                            "name": "dimSourceSystem"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "fact_Transaction",
                                "type": "DatasetReference"
                            },
                            "name": "FactTransaction",
                            "description": "Need to fix the settltment date mapping"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "LookupSourceSystem"
                        },
                        {
                            "name": "failsafeBin"
                        },
                        {
                            "name": "HashKeys"
                        },
                        {
                            "name": "LowerColumns"
                        }
                    ],
                    "script": "source(output(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> Transactions\nsource(output(\n\t\tsource_system_key as integer,\n\t\tsource_system_name as string,\n\t\tsource_system_description as string,\n\t\tsource_system_abbreviation as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> dimSourceSystem\nLowerColumns, dimSourceSystem lookup(Source == source_system_abbreviation,\n\tmultiple: true,\n\tbroadcast: 'right')~> LookupSourceSystem\nHashKeys derive(bin_key = iifNull(Bin_EXT, Bin_ISO)) ~> failsafeBin\nLookupSourceSystem derive(card_entry_hash_key = crc32(iif(isNull(CardEntryMethodCode),'',CardEntryMethodCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tpayment_token_hash_key = crc32(iif(isNull(TokenRequestId),'',TokenRequestId)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tresponse_code_hash_key = crc32(iif(isNull(ResponseCode),'',ResponseCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\ttransaction_name_hash_key = crc32(iif(isNull(TransactionName),'',TransactionName)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_type_hash_key = crc32(iif(isNull(MerchantType),'',MerchantType)),\n\t\tacquirer_network_hash_key = crc32(iif(isNull(AcquirerNetworkCode),'',AcquirerNetworkCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tissuer_network_hash_key = crc32(iif(isNull(IssuerNetworkCode),'',IssuerNetworkCode)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tterminal_hash_key = crc32(iif(isNull(TerminalKey),'',TerminalKey)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_termnial_georgraphy_hash_key = crc32(iif(isNull(TerminalCity),'',TerminalCity)\r\n, iif(isNull(TerminalState),'',TerminalState)\r\n, iif(isNull(TerminalZipCode),'',TerminalZipCode)\r\n, iif(isNull(TerminalCountry),'',TerminalCountry)\r\n, iif(isNull(source_system_key),0,source_system_key)),\n\t\tmerchant_hash_key = crc32(iif(isNull(MerchantName),'',MerchantName)\r\n, iif(isNull(TerminalAddress),'',TerminalAddress)\r\n, iif(isNull(source_system_key),0,source_system_key))) ~> HashKeys\nTransactions derive(MerchantName = lower(MerchantName),\n\t\tTerminalAddress = lower(TerminalAddress),\n\t\tTerminalCity = lower(TerminalCity),\n\t\tTerminalState = lower(TerminalState),\n\t\tTerminalZipCode = lower(TerminalZipCode),\n\t\tTerminalCountry = lower(TerminalCountry)) ~> LowerColumns\nfailsafeBin sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\ttransaction_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\taccount_key as string,\n\t\tacquirer_key as long,\n\t\tAcquirer_Network_key as long,\n\t\tbin_key as long,\n\t\tcard_entry_method_code_key as long,\n\t\tcard_presence_desc as string,\n\t\timport_file_date_key as date,\n\t\tinterchange_amount as decimal(25,2),\n\t\tissuer_key as long,\n\t\tissuer_network_key as long,\n\t\tmerchant_key as long,\n\t\tmerchant_terminal_geography_key as long,\n\t\tmerchant_type_key as long,\n\t\tmonetary as boolean,\n\t\ton_us_desc as string,\n\t\ttransmission_date_key as date,\n\t\torigin_date_key as date,\n\t\trecurring_desc as string,\n\t\tresponse_code_key as long,\n\t\tsettlement_amount as decimal(25,2),\n\t\tsettlement_date_key as date,\n\t\tsurcharge_amount as decimal(25,2),\n\t\ttermnial_key as long,\n\t\ttoken_requestid as long,\n\t\ttransaction_name_key as long,\n\t\tTransaction_type_key as long,\n\t\trun_id as long,\n\t\tdigital_card_issued_ind as boolean,\n\t\tauthorization_ind as boolean,\n\t\tauthorization_no as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tsource_system_key,\n\t\taccount_key = AccountNumber,\n\t\tacquirer_key = AcquirerAccountNumber,\n\t\tAcquirer_Network_key = acquirer_network_hash_key,\n\t\tbin_key,\n\t\tcard_entry_method_code_key = card_entry_hash_key,\n\t\tcard_presence_desc = CardPresenceDescription,\n\t\timport_file_date_key = ImportFileDate,\n\t\tinterchange_amount = InterchangeAmount,\n\t\tissuer_key = IssuerAccountNumber,\n\t\tissuer_network_key = issuer_network_hash_key,\n\t\tmerchant_key = merchant_hash_key,\n\t\tmerchant_terminal_geography_key = merchant_termnial_georgraphy_hash_key,\n\t\tmerchant_type_key = merchant_hash_key,\n\t\tmonetary = Monetary,\n\t\ton_us_desc = OnUsDescription,\n\t\ttransmission_date_key = OriginalDataTransmissionDate,\n\t\torigin_date_key = OriginDate,\n\t\trecurring_desc = RecurringDescription,\n\t\tresponse_code_key = response_code_hash_key,\n\t\tsettlement_amount = SettlementAmount,\n\t\tsurcharge_amount = SurchargeAmount,\n\t\ttermnial_key = terminal_hash_key,\n\t\ttoken_requestid = payment_token_hash_key,\n\t\ttransaction_name_key = transaction_name_hash_key,\n\t\tTransaction_type_key = TransactionTypeCode,\n\t\tsettlement_date_key = SettlementDate\n\t)) ~> FactTransaction"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/update_BinType_FiservPrograms')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "srcDWBin"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_rawBinType_Fiserv",
                                "type": "DatasetReference"
                            },
                            "name": "BinType"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Client",
                                "type": "DatasetReference"
                            },
                            "name": "srcDimClient"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "snkDWBinUpdates"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "sinkDWBinInserts"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Client",
                                "type": "DatasetReference"
                            },
                            "name": "snkDimClientNew"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Trim"
                        },
                        {
                            "name": "Join"
                        },
                        {
                            "name": "ResolveBinType"
                        },
                        {
                            "name": "LimitSelect"
                        },
                        {
                            "name": "RankBinType"
                        },
                        {
                            "name": "Dedupe"
                        },
                        {
                            "name": "MarkUpdate"
                        },
                        {
                            "name": "FilterInserts"
                        },
                        {
                            "name": "FilterUpdates"
                        },
                        {
                            "name": "InsertTransformations"
                        },
                        {
                            "name": "MarkInserts"
                        },
                        {
                            "name": "JoinNewClients"
                        },
                        {
                            "name": "HashNewClients"
                        },
                        {
                            "name": "FilterNewClients"
                        },
                        {
                            "name": "FilterBins"
                        },
                        {
                            "name": "CleanUpBinType"
                        }
                    ],
                    "script": "parameters{\n\tfileName as string\n}\nsource(output(\n\t\tbin_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string,\n\t\tbin_type as string,\n\t\tclient_key as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select * from [FinancialInstitution].[dim_bin] where source_system_key = 2',\n\tformat: 'query',\n\tstaged: false,\n\tpartitionColumn: 'bankIdentificationNumberEXT',\n\tpartitionBy('external', 2)) ~> srcDWBin\nsource(output(\n\t\tClientNumber as string,\n\t\tClientName as string,\n\t\tRoutingTransitNumber as string,\n\t\tOriginalBINNumber as string,\n\t\tBINNumberSixDigits as string,\n\t\tFirstDataPlatform as string,\n\t\tSys as string,\n\t\tPrin as string,\n\t\tAgent as string,\n\t\tCardType as string,\n\t\tType as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['Reference/CoreBin/Current',(concat('Reference/CoreBin/',substring($fileName,8,4),'/',substring($fileName,12,2),'/',substring($fileName,14,2)))]) ~> BinType\nsource(output(\n\t\tclient_key as long,\n\t\tir_id as integer,\n\t\tclient_name as string,\n\t\tstreet_address1 as string,\n\t\tstreet_address2 as string,\n\t\tcity as string,\n\t\tstate as string,\n\t\tzipcode as string,\n\t\tclient_number as string,\n\t\tis_current as boolean,\n\t\tbegin_effective_date as timestamp,\n\t\tend_effective_date as timestamp,\n\t\tPREFERRED_NAME as string,\n\t\tPARENT_CLIENT_KEY as long,\n\t\tMERGER_ACQUISITION_DTE as date,\n\t\tGEOGRAPHIC_REGION_KEY as integer,\n\t\tASSET_SIZE_KEY as integer,\n\t\tPORTFOLIO_SIZE_KEY as integer,\n\t\tASSET_SIZE_AMT as decimal(19,4),\n\t\tPORTFOLIO_SIZE_CNT as integer,\n\t\tBUSINESS_PARTNER_CLIENT_KEY as long,\n\t\tCREATE_DTE as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> srcDimClient\nBinType derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> Trim\nsrcDWBin, Dedupe join(bankIdentificationNumberISO == BINISO,\n\tjoinType:'right',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join\nCleanUpBinType derive(FirstDataPlatform = coalesce(CardType,FirstDataPlatform,'Unknown')) ~> ResolveBinType\nFilterBins select(mapColumn(\n\t\tBINISO = BINNumberSixDigits,\n\t\tBinType = FirstDataPlatform,\n\t\tClientNumber,\n\t\tClientName\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LimitSelect\nLimitSelect window(over(BINISO,\n\t\tClientNumber,\n\t\tClientName),\n\tasc(BinType, false),\n\tranking = rowNumber()) ~> RankBinType\nRankBinType filter(ranking==1) ~> Dedupe\nFilterUpdates alterRow(updateIf(true())) ~> MarkUpdate\nJoin filter(isNull(bin_key)) ~> FilterInserts\nJoin filter(!isNull(bin_key)) ~> FilterUpdates\nFilterInserts derive(client_key = crc32(iif(isNull(ClientNumber),'',ClientNumber)),\n\t\tbin_key = crc32(iif(isNull(left(BINISO,6)),'',left(BINISO,6))),\n\t\tsource_system_key = 2,\n\t\tsource_system_id = BINISO,\n\t\tbankIdentificationNumberISO = BINISO,\n\t\tbankIdentificationNumberEXT = BINISO,\n\t\tbin_type = BinType) ~> InsertTransformations\nInsertTransformations alterRow(insertIf(true())) ~> MarkInserts\nsrcDimClient, Dedupe join(client_number == ClientNumber,\n\tjoinType:'right',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinNewClients\nFilterNewClients derive(client_key = crc32(iif(isNull(ClientNumber),'',ClientNumber)),\n\t\tis_current = true(),\n\t\tbegin_effective_date = toTimestamp(substring($fileName,8,8),'yyyyMMdd')) ~> HashNewClients\nJoinNewClients filter(isNull(client_number)) ~> FilterNewClients\nResolveBinType filter(!like(ClientName,'%Merged%')) ~> FilterBins\nTrim derive(FirstDataPlatform = iif(initCap(FirstDataPlatform)=='Credit'||initCap(FirstDataPlatform)=='Debit',initCap(FirstDataPlatform),toString(null())),\n\t\tCardType = iif(initCap(CardType)=='Credit'||initCap(CardType)=='Debit',initCap(CardType),toString(null()))) ~> CleanUpBinType\nMarkUpdate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tbin_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string,\n\t\tbin_type as string,\n\t\tclient_key as long\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['bin_key','source_system_key','bankIdentificationNumberEXT'],\n\tskipKeyWrites:true,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tbin_key,\n\t\tsource_system_key,\n\t\tbankIdentificationNumberEXT,\n\t\tbin_type = BinType\n\t)) ~> snkDWBinUpdates\nMarkInserts sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tbin_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string,\n\t\tbin_type as string,\n\t\tclient_key as long\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 2,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tbin_key,\n\t\tsource_system_key,\n\t\tsource_system_id,\n\t\tbankIdentificationNumberISO,\n\t\tbankIdentificationNumberEXT,\n\t\tbin_type,\n\t\tclient_key\n\t)) ~> sinkDWBinInserts\nHashNewClients sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tclient_key as long,\n\t\tir_id as integer,\n\t\tclient_name as string,\n\t\tstreet_address1 as string,\n\t\tstreet_address2 as string,\n\t\tcity as string,\n\t\tstate as string,\n\t\tzipcode as string,\n\t\tclient_number as string,\n\t\tis_current as boolean,\n\t\tbegin_effective_date as timestamp,\n\t\tend_effective_date as timestamp,\n\t\tPREFERRED_NAME as string,\n\t\tPARENT_CLIENT_KEY as long,\n\t\tMERGER_ACQUISITION_DTE as date,\n\t\tGEOGRAPHIC_REGION_KEY as integer,\n\t\tASSET_SIZE_KEY as integer,\n\t\tPORTFOLIO_SIZE_KEY as integer,\n\t\tASSET_SIZE_AMT as decimal(19,4),\n\t\tPORTFOLIO_SIZE_CNT as integer,\n\t\tBUSINESS_PARTNER_CLIENT_KEY as long,\n\t\tCREATE_DTE as date\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 3,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tclient_key,\n\t\tclient_name = ClientName,\n\t\tclient_number = ClientNumber,\n\t\tis_current,\n\t\tbegin_effective_date\n\t)) ~> snkDimClientNew"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimClient_Fiserv')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Dimensions/Static Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_rawFiservPrograms",
                                "type": "DatasetReference"
                            },
                            "name": "client"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Client",
                                "type": "DatasetReference"
                            },
                            "name": "DWClient"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Client",
                                "type": "DatasetReference"
                            },
                            "name": "ClientDimension"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "RemoveDuplicates"
                        },
                        {
                            "name": "ProcDateAndHash"
                        },
                        {
                            "name": "trim"
                        },
                        {
                            "name": "Join1"
                        },
                        {
                            "name": "filterNullAddress"
                        },
                        {
                            "name": "RemoveDuplicates1"
                        },
                        {
                            "name": "MarkUpdates"
                        },
                        {
                            "name": "MarkInserts"
                        },
                        {
                            "name": "Union1"
                        },
                        {
                            "name": "filterNull"
                        },
                        {
                            "name": "DerivedDW"
                        },
                        {
                            "name": "LimitSelect"
                        },
                        {
                            "name": "Inserts"
                        },
                        {
                            "name": "Updates"
                        },
                        {
                            "name": "Sort1"
                        }
                    ],
                    "script": "source(output(\n\t\tClientNumber as string,\n\t\tClientName as string,\n\t\tRoutingTransitNumber as string,\n\t\tFirstDataClientNumber as string,\n\t\tBillingRouteTransitNumber as string,\n\t\tAddressLine1 as string,\n\t\tAddressLine2 as string,\n\t\tCity as string,\n\t\tState as string,\n\t\tZip as string,\n\t\tCounty as string,\n\t\tBIN as string,\n\t\tAllowProgramFirstData as string,\n\t\tFirstDataPlatform as string,\n\t\tSys as string,\n\t\tPrin as string,\n\t\tAgent as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\twildcardPaths:['Reference/FiservPrograms/current/FiservPrograms*']) ~> client\nsource(output(\n\t\tclient_key as long,\n\t\tir_id as integer,\n\t\tclient_name as string,\n\t\tstreet_address1 as string,\n\t\tstreet_address2 as string,\n\t\tcity as string,\n\t\tstate as string,\n\t\tzipcode as string,\n\t\tclient_number as string,\n\t\tis_current as boolean,\n\t\tbegin_effective_date as timestamp,\n\t\tend_effective_date as timestamp,\n\t\tPREFERRED_NAME as string,\n\t\tPARENT_CLIENT_KEY as long,\n\t\tMERGER_ACQUISITION_DTE as date,\n\t\tGEOGRAPHIC_REGION_KEY as integer,\n\t\tASSET_SIZE_KEY as integer,\n\t\tPORTFOLIO_SIZE_KEY as integer,\n\t\tASSET_SIZE_AMT as decimal(19,4),\n\t\tPORTFOLIO_SIZE_CNT as integer,\n\t\tBUSINESS_PARTNER_CLIENT_KEY as long,\n\t\tCREATE_DTE as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DWClient\nInserts aggregate(groupBy(ClientNumber,\n\t\tFinancialInstitutionName,\n\t\tAddressLine1,\n\t\tAddressLine2,\n\t\tAddressCity,\n\t\tAddressState,\n\t\tAddressPostalCode,\n\t\tclient_key_src,\n\t\tis_current_file,\n\t\tir_id,\n\t\tbegin_effective_date,\n\t\tend_effective_date),\n\trecordcount = count(ClientNumber)) ~> RemoveDuplicates\ntrim derive(processDate = currentUTC(),\n\t\tclient_key_src = crc32(iif(isNull(ClientNumber),'',ClientNumber)\r\n, iif(isNull(ClientName),'',ClientName)),\n\t\tClientNumber_src = ClientNumber) ~> ProcDateAndHash\nfilterNull derive(each(match(type=='string'), $$ = trim($$)),\n\t\tis_current_file = true()) ~> trim\nProcDateAndHash, DerivedDW join(client_key_src == client_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nUpdates filter(!isNull(AddressLine1)) ~> filterNullAddress\nfilterNullAddress aggregate(groupBy(ClientNumber,\n\t\tFinancialInstitutionName,\n\t\tAddressLine1,\n\t\tAddressLine2,\n\t\tAddressCity,\n\t\tAddressState,\n\t\tAddressPostalCode,\n\t\tclient_key_src,\n\t\tis_current_file,\n\t\tir_id,\n\t\tbegin_effective_date,\n\t\tend_effective_date),\n\trecordcount = count(ClientNumber)) ~> RemoveDuplicates1\nRemoveDuplicates1 alterRow(updateIf(true())) ~> MarkUpdates\nRemoveDuplicates alterRow(insertIf(true())) ~> MarkInserts\nMarkInserts, MarkUpdates union(byName: true)~> Union1\nclient filter(!isNull(ClientNumber)) ~> filterNull\nDWClient derive(is_current_dw = is_current) ~> DerivedDW\nJoin1 select(mapColumn(\n\t\tClientNumber = ClientNumber_src,\n\t\tclient_key_src,\n\t\tFinancialInstitutionName = ClientName,\n\t\tBINNumber = BIN,\n\t\tRouteTransitNumber = RoutingTransitNumber,\n\t\tAddressLine1,\n\t\tAddressLine2,\n\t\tAddressCity = trim@City,\n\t\tAddressState = trim@State,\n\t\tAddressPostalCode = Zip,\n\t\tis_current_file,\n\t\tprocessDate,\n\t\tclient_key,\n\t\tir_id,\n\t\tbegin_effective_date,\n\t\tend_effective_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LimitSelect\nLimitSelect filter(isNull(client_key)) ~> Inserts\nLimitSelect filter(!isNull(client_key)) ~> Updates\nUnion1 sort(asc(client_key_src, false)) ~> Sort1\nSort1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tclient_key as long,\n\t\tir_id as integer,\n\t\tclient_name as string,\n\t\tstreet_address1 as string,\n\t\tstreet_address2 as string,\n\t\tcity as string,\n\t\tstate as string,\n\t\tzipcode as string,\n\t\tclient_number as string,\n\t\tis_current as boolean,\n\t\tbegin_effective_date as timestamp,\n\t\tend_effective_date as timestamp,\n\t\tPREFERRED_NAME as string,\n\t\tPARENT_CLIENT_KEY as long,\n\t\tMERGER_ACQUISITION_DTE as date,\n\t\tGEOGRAPHIC_REGION_KEY as integer,\n\t\tASSET_SIZE_KEY as integer,\n\t\tPORTFOLIO_SIZE_KEY as integer,\n\t\tASSET_SIZE_AMT as decimal(19,4),\n\t\tPORTFOLIO_SIZE_CNT as integer,\n\t\tBUSINESS_PARTNER_CLIENT_KEY as long,\n\t\tCREATE_DTE as date\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['client_key'],\n\tformat: 'table',\n\tstaged: true,\n\tpostSQLs:['ALTER INDEX ALL ON [FinancialInstitution].[dim_client]  REBUILD'],\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tclient_key = client_key_src,\n\t\tir_id,\n\t\tclient_name = FinancialInstitutionName,\n\t\tstreet_address1 = AddressLine1,\n\t\tstreet_address2 = AddressLine2,\n\t\tcity = AddressCity,\n\t\tstate = AddressState,\n\t\tzipcode = AddressPostalCode,\n\t\tclient_number = ClientNumber,\n\t\tis_current = is_current_file,\n\t\tbegin_effective_date,\n\t\tend_effective_date\n\t)) ~> ClientDimension"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimBinandRTN_Fiserv')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Dimensions/Static Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_rawFiservPrograms",
                                "type": "DatasetReference"
                            },
                            "name": "client"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Client",
                                "type": "DatasetReference"
                            },
                            "name": "DWClient"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Routing_Number",
                                "type": "DatasetReference"
                            },
                            "name": "dimRTN"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "dimBIN"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Routing_Number",
                                "type": "DatasetReference"
                            },
                            "name": "RTNDimension"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "BinDimension"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "BINList"
                        },
                        {
                            "name": "populateprocessdate"
                        },
                        {
                            "name": "RTNList"
                        },
                        {
                            "name": "BinISOAndHash"
                        },
                        {
                            "name": "removeBlankBIN"
                        },
                        {
                            "name": "removeBlankRTN"
                        },
                        {
                            "name": "removeduplicateBin"
                        },
                        {
                            "name": "removeduplicatRTN"
                        },
                        {
                            "name": "filterNull"
                        },
                        {
                            "name": "Join1"
                        },
                        {
                            "name": "Select1"
                        },
                        {
                            "name": "Exists1"
                        },
                        {
                            "name": "Exists2"
                        },
                        {
                            "name": "RTNHash"
                        },
                        {
                            "name": "Sort1"
                        },
                        {
                            "name": "Sort2"
                        }
                    ],
                    "script": "source(output(\n\t\tClientNumber as string,\n\t\tClientName as string,\n\t\tRoutingTransitNumber as string,\n\t\tFirstDataClientNumber as string,\n\t\tBillingRouteTransitNumber as string,\n\t\tAddressLine1 as string,\n\t\tAddressLine2 as string,\n\t\tCity as string,\n\t\tState as string,\n\t\tZip as string,\n\t\tCounty as string,\n\t\tBIN as string,\n\t\tAllowProgramFirstData as string,\n\t\tFirstDataPlatform as string,\n\t\tSys as string,\n\t\tPrin as string,\n\t\tAgent as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> client\nsource(output(\n\t\tclient_key as long,\n\t\tir_id as integer,\n\t\tclient_name as string,\n\t\tstreet_address1 as string,\n\t\tstreet_address2 as string,\n\t\tcity as string,\n\t\tstate as string,\n\t\tzipcode as string,\n\t\tclient_number as string,\n\t\tis_current as boolean,\n\t\tbegin_effective_date as timestamp,\n\t\tend_effective_date as timestamp,\n\t\tPREFERRED_NAME as string,\n\t\tPARENT_CLIENT_KEY as long,\n\t\tMERGER_ACQUISITION_DTE as date,\n\t\tGEOGRAPHIC_REGION_KEY as integer,\n\t\tASSET_SIZE_KEY as integer,\n\t\tPORTFOLIO_SIZE_KEY as integer,\n\t\tASSET_SIZE_AMT as decimal(19,4),\n\t\tPORTFOLIO_SIZE_CNT as integer,\n\t\tBUSINESS_PARTNER_CLIENT_KEY as long,\n\t\tCREATE_DTE as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DWClient\nsource(output(\n\t\trouting_number_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\trouting_number as string,\n\t\tclient_key as long,\n\t\tmeta_insert_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> dimRTN\nsource(output(\n\t\tbin_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string,\n\t\tbin_type as string,\n\t\tclient_key as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> dimBIN\nSelect1 select(mapColumn(\n\t\tBIN = BINNumber,\n\t\tprocessDate,\n\t\tclient_key_bin = client_key,\n\t\tsource_system_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> BINList\nfilterNull derive(processDate = currentUTC(),\n\t\tsource_system_key = 2,\n\t\tis_current_client = true()) ~> populateprocessdate\nSelect1 select(mapColumn(\n\t\tRoutingTransitNumber = RouteTransitNumber,\n\t\tprocessDate,\n\t\tclient_key_rtn = client_key,\n\t\tsource_system_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RTNList\nBINList derive(BinISO = left(BIN, 6),\n\t\tbin_key = crc32(iif(isNull(left(BIN,6)),'',left(BIN,6)))) ~> BinISOAndHash\nBinISOAndHash filter(!isNull(BIN)) ~> removeBlankBIN\nRTNHash filter(!isNull(RoutingTransitNumber)) ~> removeBlankRTN\nremoveBlankBIN aggregate(groupBy(BIN,\n\t\tBinISO,\n\t\tclient_key_bin,\n\t\tsource_system_key,\n\t\tbin_key,\n\t\tprocessDate),\n\tcount = count()) ~> removeduplicateBin\nremoveBlankRTN aggregate(groupBy(RoutingTransitNumber,\n\t\tclient_key_rtn,\n\t\tprocessDate,\n\t\tsource_system_key,\n\t\trouting_number_key),\n\tcount = count(RoutingTransitNumber)) ~> removeduplicatRTN\nclient filter(!isNull(ClientNumber)) ~> filterNull\npopulateprocessdate, DWClient join(ClientNumber == client_number\n\t&& ClientName == client_name,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tClientNumber,\n\t\tFinancialInstitutionName = ClientName,\n\t\tBINNumber = BIN,\n\t\tRouteTransitNumber = RoutingTransitNumber,\n\t\tAddressLine1,\n\t\tAddressLine2,\n\t\tAddressCity = client@City,\n\t\tAddressState = client@State,\n\t\tAddressPostalCode = Zip,\n\t\tis_current = is_current_client,\n\t\tprocessDate,\n\t\tsource_system_key,\n\t\tclient_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nremoveduplicatRTN, dimRTN exists(removeduplicatRTN@routing_number_key == dimRTN@routing_number_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> Exists1\nremoveduplicateBin, dimBIN exists(removeduplicateBin@bin_key == dimBIN@bin_key\n\t&& BIN == bankIdentificationNumberEXT\n\t&& removeduplicateBin@source_system_key == dimBIN@source_system_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> Exists2\nRTNList derive(routing_number_key = crc32(iif(isNull(RoutingTransitNumber),'',RoutingTransitNumber)\r\n, iif(isNull(client_key_rtn),0,toInteger(client_key_rtn)))) ~> RTNHash\nExists2 sort(asc(bin_key, false)) ~> Sort1\nExists1 sort(asc(routing_number_key, false)) ~> Sort2\nSort2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\trouting_number_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\trouting_number as string,\n\t\tis_pseudo as boolean,\n\t\tis_primary as boolean,\n\t\tclient_key as long,\n\t\tcreate_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\trouting_number_key,\n\t\tsource_system_key,\n\t\tsource_system_id = RoutingTransitNumber,\n\t\trouting_number = RoutingTransitNumber,\n\t\tclient_key = client_key_rtn,\n\t\tmeta_insert_date = processDate\n\t)) ~> RTNDimension\nSort1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tbin_key as long,\n\t\tsource_system_key as integer,\n\t\tsource_system_id as string,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string,\n\t\tbin_type as string,\n\t\tclient_key as long\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tbin_key,\n\t\tsource_system_key,\n\t\tsource_system_id = BIN,\n\t\tbankIdentificationNumberISO = BinISO,\n\t\tbankIdentificationNumberEXT = BIN,\n\t\tclient_key = client_key_bin\n\t)) ~> BinDimension"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimAccountGeography_FD')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "This will populate DimAccountGeograpy in the member schema in Azure SQ DW.",
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "all_stgFDCustomerData",
                                "type": "DatasetReference"
                            },
                            "name": "FDCustomerData"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Account_Geography",
                                "type": "DatasetReference"
                            },
                            "name": "dimAccountGeography"
                        },
                        {
                            "dataset": {
                                "referenceName": "AccountRegionReference",
                                "type": "DatasetReference"
                            },
                            "name": "RefAccountRegionReference"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Account_Geography",
                                "type": "DatasetReference"
                            },
                            "name": "SnkdimAccountGeography"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "GetDimAccountAttributes"
                        },
                        {
                            "name": "GetDistinctAccountGeography"
                        },
                        {
                            "name": "TrimSpacesAndSetSourceSystem"
                        },
                        {
                            "name": "GetRegionDivisionLabels"
                        },
                        {
                            "name": "FormatAttributes"
                        },
                        {
                            "name": "GetHashkey"
                        },
                        {
                            "name": "LowerAttributesForLookup"
                        },
                        {
                            "name": "JoinDimAccountGeography"
                        },
                        {
                            "name": "AlterRow1"
                        },
                        {
                            "name": "SortBeforeInsert"
                        }
                    ],
                    "script": "source(output(\n\t\tCustomerDataID as string,\n\t\t{      CHD_ACCOUNT_NUMBER} as string,\n\t\t{      CHD_PRINCIPAL_NAME} as string,\n\t\t{      CHD_SPOUSE_NAME} as string,\n\t\t{      CHD_ADDR_LINE_1} as string,\n\t\t{      CHD_ADDR_LINE_2} as string,\n\t\t{      CHD_CITY} as string,\n\t\t{      CHD_STATE} as string,\n\t\t{      CHD_NUMERIC_STATE} as string,\n\t\t{      CHD_DELIVERY_POINT} as string,\n\t\t{      CHD_PD_PREFIX} as string,\n\t\t{      CHD_PD_SUFFIX} as string,\n\t\t{      CHD_PD_ADDRESS_FORMAT} as string,\n\t\t{      CHD_PD_ADDR_LINE_3} as string,\n\t\t{      CHD_PD_COUNTY} as string,\n\t\t{      CHD_PD_POSTCODE} as string,\n\t\t{      CHD_SD_PREFIX} as string,\n\t\t{      CHD_SD_SUFFIX} as string,\n\t\t{      CHD_SEX_CODE} as string,\n\t\t{      CHD_SOC_SECURITY_NO} as string,\n\t\t{      CHD_TELEPHONE_NUMBER} as string,\n\t\t{      CHD_SECOND_TELEPHONE_NUMBER} as string,\n\t\t{      CHD_HOME_PHONE_FORMAT} as string,\n\t\t{      CHD_BUS_PHONE_FORMAT} as string,\n\t\t{      CHD_MOTHERS_MAIDEN_NAME} as string,\n\t\t{      CHD_SECONDARY_SOC_SEC_NO} as string,\n\t\t{      CHD_DATE_LAST_ADDR_CHANGE} as string,\n\t\t{      CHD_NAME_ADDR_CHG} as string,\n\t\t{      CHD_ADDRESS_FLAG} as string,\n\t\t{      CHD_HOME_PHONE_FLAG} as string,\n\t\t{      CHD_BUSINESS_PHONE_FLAG} as string,\n\t\t{      CHD_DECEASED_FLAG} as string,\n\t\t{      CHD_SOLICITATION_FLAG} as string,\n\t\t{      CHD_EMPL_ACCT_CD} as string,\n\t\t{      CHD_ALT_CUSTOMER_NO} as string,\n\t\t{      CHD_DATE_OF_BIRTH} as string,\n\t\t{      CHD_SECONDARY_DATE_OF_BIRTH} as string,\n\t\t{      FDR_Date_Processed} as string,\n\t\t{      ExtractDate} as string,\n\t\t{      DateProcessed} as string,\n\t\t{      ReportDate} as string,\n\t\t{      CHD_FIXD_MPD_USAG_CD} as string,\n\t\t{      CHD_MPW_APR_OVRR_USAG_CD} as string,\n\t\t{      CHD_MPW_APR_OVRR_USAG_DT} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM1} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT1} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM2} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT2} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM3} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT3} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM4} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT4} as string,\n\t\t{      CHD_TSM_PRTC_IN} as string,\n\t\t{      CHD_ZIP_CODE} as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\trowUrlColumn: 'file_name') ~> FDCustomerData\nsource(output(\n\t\taccount_geography_key as string,\n\t\tsource_system_key as integer,\n\t\tregion as string,\n\t\tdivision as string,\n\t\taccount_address_line_one as string,\n\t\taccount_address_line_two as string,\n\t\taccount_city as string,\n\t\taccount_state_province_code as string,\n\t\taccount_postal_code as string,\n\t\taccount_country_code as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false,\n\tpartitionColumn: 'account_geography_key',\n\tpartitionBy('external', 50)) ~> dimAccountGeography\nsource(output(\n\t\tRegion as string,\n\t\tRegionName as string,\n\t\tDivision as string,\n\t\tDivisionName as string,\n\t\tState as string,\n\t\tStateCode as string,\n\t\tCountryCode as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> RefAccountRegionReference\nFDCustomerData select(mapColumn(\n\t\tCardholderAddressState = {      CHD_STATE},\n\t\tCardholderAddressCity = {      CHD_CITY},\n\t\tCardholderAddressZip = {      CHD_PD_POSTCODE},\n\t\tReportDate = {      ReportDate},\n\t\tCHD_ADDR_LINE_1 = {      CHD_ADDR_LINE_1},\n\t\tCHD_ADDR_LINE_2 = {      CHD_ADDR_LINE_2}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> GetDimAccountAttributes\nLowerAttributesForLookup aggregate(groupBy(Source_System_Key_AccountData,\n\t\tCardholderAddressLineOne,\n\t\tCardholderAddressLineTwo,\n\t\tCardholderAddressCity,\n\t\tCardholderAddressState,\n\t\tCardholderAddressZip),\n\tReportDate = max(ReportDate)) ~> GetDistinctAccountGeography\nGetDimAccountAttributes derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null())))),\n\t\tSource_System_Key_AccountData = 2) ~> TrimSpacesAndSetSourceSystem\nGetHashkey, RefAccountRegionReference lookup(CardholderAddressState == lower(StateCode),\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> GetRegionDivisionLabels\nJoinDimAccountGeography derive(CreateDate = coalesce(create_date, currentTimestamp()),\n\t\tModifiedDateNew = currentTimestamp(),\n\t\tReportDate = toDate(ReportDate, 'yyyy-mm-dd'),\n\t\tTitle_account_city = initCap(CardholderAddressCity),\n\t\tTitle_CardholderAddressLineOne = initCap(CardholderAddressLineOne),\n\t\tTitle_CardholderAddressLineTwo = initCap(CardholderAddressLineTwo)) ~> FormatAttributes\nGetDistinctAccountGeography derive(AccountGeographyHashkey = md5\r\n(iif(isNull(CardholderAddressLineOne),'',CardholderAddressLineOne)\r\n, iif(isNull(CardholderAddressLineTwo),'',CardholderAddressLineTwo)\r\n, iif(isNull(CardholderAddressCity),'',CardholderAddressCity)\r\n, iif(isNull(CardholderAddressState),'',CardholderAddressState)\r\n, iif(isNull(CardholderAddressZip),'',CardholderAddressZip)\r\n, iif(isNull(Source_System_Key_AccountData),0,Source_System_Key_AccountData)\r\n)) ~> GetHashkey\nTrimSpacesAndSetSourceSystem derive(CardholderAddressCity = lower(CardholderAddressCity),\n\t\tCardholderAddressState = lower(CardholderAddressState),\n\t\tCardholderAddressLineOne = lower(CHD_ADDR_LINE_1),\n\t\tCardholderAddressLineTwo = lower(CHD_ADDR_LINE_2)) ~> LowerAttributesForLookup\nGetRegionDivisionLabels, dimAccountGeography join(AccountGeographyHashkey == account_geography_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinDimAccountGeography\nFormatAttributes alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sort(asc(Source_System_Key_AccountData, true),\n\tasc(AccountGeographyHashkey, true)) ~> SortBeforeInsert\nSortBeforeInsert sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\taccount_geography_key as string,\n\t\tsource_system_key as integer,\n\t\tregion as string,\n\t\tdivision as string,\n\t\taccount_address_line_one as string,\n\t\taccount_address_line_two as string,\n\t\taccount_city as string,\n\t\taccount_state_province_code as string,\n\t\taccount_postal_code as string,\n\t\taccount_country_code as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['account_geography_key'],\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tsource_system_key = Source_System_Key_AccountData,\n\t\taccount_geography_key = AccountGeographyHashkey,\n\t\tregion = RegionName,\n\t\tdivision = DivisionName,\n\t\taccount_address_line_one = Title_CardholderAddressLineOne,\n\t\taccount_address_line_two = Title_CardholderAddressLineTwo,\n\t\taccount_city = Title_account_city,\n\t\taccount_state_province_code = StateCode,\n\t\taccount_postal_code = CardholderAddressZip,\n\t\taccount_country_code = CountryCode,\n\t\tload_date = ReportDate,\n\t\tcreate_date = CreateDate,\n\t\tmodified_date = ModifiedDateNew\n\t)) ~> SnkdimAccountGeography"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimAccount_FD')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "This is to populate Dim Account to the Azure DW.",
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "all_stgFDCustomerData",
                                "type": "DatasetReference"
                            },
                            "name": "FDCustomerData"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Account",
                                "type": "DatasetReference"
                            },
                            "name": "DwDimAccount"
                        },
                        {
                            "dataset": {
                                "referenceName": "all_stgFDBaseData",
                                "type": "DatasetReference"
                            },
                            "name": "FDBaseData"
                        },
                        {
                            "dataset": {
                                "referenceName": "all_stgFDAccountHierarcy",
                                "type": "DatasetReference"
                            },
                            "name": "AccountHierarchy"
                        },
                        {
                            "dataset": {
                                "referenceName": "all_stgFDPIRecord",
                                "type": "DatasetReference"
                            },
                            "name": "PIRecord"
                        },
                        {
                            "dataset": {
                                "referenceName": "fact_Transaction",
                                "type": "DatasetReference"
                            },
                            "name": "FactTransactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_BIN",
                                "type": "DatasetReference"
                            },
                            "name": "DWDimBin"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgCCUMSTR",
                                "type": "DatasetReference"
                            },
                            "name": "CCUMSTR"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgCD495",
                                "type": "DatasetReference"
                            },
                            "name": "CD495"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgPI_Status",
                                "type": "DatasetReference"
                            },
                            "name": "PIStatus"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Account",
                                "type": "DatasetReference"
                            },
                            "name": "SnkDimAccount"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "CreateHashkeys"
                        },
                        {
                            "name": "SelectCustomerAttributes"
                        },
                        {
                            "name": "SelectAttributesBaseData"
                        },
                        {
                            "name": "SelectAccountHiearchyAttributes"
                        },
                        {
                            "name": "GetBaseDataAttributes"
                        },
                        {
                            "name": "GetAccountHierarchyAttributes"
                        },
                        {
                            "name": "TrimBaseData"
                        },
                        {
                            "name": "TrimAccountHierarchy"
                        },
                        {
                            "name": "ConvertDataAndApplyLogic"
                        },
                        {
                            "name": "DistinctAccounts"
                        },
                        {
                            "name": "TrimSpaces"
                        },
                        {
                            "name": "PIRecordSelect"
                        },
                        {
                            "name": "TrimPIRecord"
                        },
                        {
                            "name": "JoinwithAcctNbr"
                        },
                        {
                            "name": "FilterNullAcctNums"
                        },
                        {
                            "name": "DistinctAttributes"
                        },
                        {
                            "name": "JoinAccounts"
                        },
                        {
                            "name": "JoinTransactions"
                        },
                        {
                            "name": "ResetAttributes"
                        },
                        {
                            "name": "ExpirationDatePassOne"
                        },
                        {
                            "name": "FirstTxnDateLogic"
                        },
                        {
                            "name": "ActivationDateLogic"
                        },
                        {
                            "name": "AdditionalLogic"
                        },
                        {
                            "name": "SelectUpsertColumns"
                        },
                        {
                            "name": "Upsert"
                        },
                        {
                            "name": "ExpirationDatePassTwo"
                        },
                        {
                            "name": "IssueDateFillIn"
                        },
                        {
                            "name": "TrimCCUMSTR"
                        },
                        {
                            "name": "SelectCcuMstr"
                        },
                        {
                            "name": "GetPIrecordSpa"
                        },
                        {
                            "name": "JoinCcumstrBaseData"
                        },
                        {
                            "name": "SeparateEntityFlag"
                        },
                        {
                            "name": "SelectCD495"
                        },
                        {
                            "name": "TrimCD495"
                        },
                        {
                            "name": "GetBaseDataSpa"
                        },
                        {
                            "name": "OnlyAttributesNeededBaseData"
                        },
                        {
                            "name": "GetOnlyAttributesPIRecord"
                        },
                        {
                            "name": "PIStatusActivationFlag"
                        },
                        {
                            "name": "SelectPIStatus"
                        },
                        {
                            "name": "TrimPIStatus"
                        },
                        {
                            "name": "JoinCD496"
                        },
                        {
                            "name": "JoinPIRecord"
                        },
                        {
                            "name": "JoinPIStatus"
                        },
                        {
                            "name": "joinDimBinEXT"
                        },
                        {
                            "name": "RankBins"
                        },
                        {
                            "name": "FilterTopRankedBins"
                        },
                        {
                            "name": "selectAccountBinClient"
                        }
                    ],
                    "script": "source(output(\n\t\tCustomerDataID as string,\n\t\tCHD_ACCOUNT_NUMBER as string,\n\t\tCHD_PRINCIPAL_NAME as string,\n\t\tCHD_SPOUSE_NAME as string,\n\t\tCHD_ADDR_LINE_1 as string,\n\t\tCHD_ADDR_LINE_2 as string,\n\t\tCHD_CITY as string,\n\t\tCHD_STATE as string,\n\t\tCHD_NUMERIC_STATE as string,\n\t\tCHD_DELIVERY_POINT as string,\n\t\tCHD_PD_PREFIX as string,\n\t\tCHD_PD_SUFFIX as string,\n\t\tCHD_PD_ADDRESS_FORMAT as string,\n\t\tCHD_PD_ADDR_LINE_3 as string,\n\t\tCHD_PD_COUNTY as string,\n\t\tCHD_PD_POSTCODE as string,\n\t\tCHD_SD_PREFIX as string,\n\t\tCHD_SD_SUFFIX as string,\n\t\tCHD_SEX_CODE as string,\n\t\tCHD_SOC_SECURITY_NO as string,\n\t\tCHD_TELEPHONE_NUMBER as string,\n\t\tCHD_SECOND_TELEPHONE_NUMBER as string,\n\t\tCHD_HOME_PHONE_FORMAT as string,\n\t\tCHD_BUS_PHONE_FORMAT as string,\n\t\tCHD_MOTHERS_MAIDEN_NAME as string,\n\t\tCHD_SECONDARY_SOC_SEC_NO as string,\n\t\tCHD_DATE_LAST_ADDR_CHANGE as string,\n\t\tCHD_NAME_ADDR_CHG as string,\n\t\tCHD_ADDRESS_FLAG as string,\n\t\tCHD_HOME_PHONE_FLAG as string,\n\t\tCHD_BUSINESS_PHONE_FLAG as string,\n\t\tCHD_DECEASED_FLAG as string,\n\t\tCHD_SOLICITATION_FLAG as string,\n\t\tCHD_EMPL_ACCT_CD as string,\n\t\tCHD_ALT_CUSTOMER_NO as string,\n\t\tCHD_DATE_OF_BIRTH as string,\n\t\tCHD_SECONDARY_DATE_OF_BIRTH as string,\n\t\tFDR_Date_Processed as string,\n\t\tExtractDate as string,\n\t\tDateProcessed as string,\n\t\tReportDate as string,\n\t\tCHD_FIXD_MPD_USAG_CD as string,\n\t\tCHD_MPW_APR_OVRR_USAG_CD as string,\n\t\tCHD_MPW_APR_OVRR_USAG_DT as string,\n\t\tCHD_FIXD_MPD_OVRR_AM1 as string,\n\t\tCHD_FIXD_MPD_OVRR_DT1 as string,\n\t\tCHD_FIXD_MPD_OVRR_AM2 as string,\n\t\tCHD_FIXD_MPD_OVRR_DT2 as string,\n\t\tCHD_FIXD_MPD_OVRR_AM3 as string,\n\t\tCHD_FIXD_MPD_OVRR_DT3 as string,\n\t\tCHD_FIXD_MPD_OVRR_AM4 as string,\n\t\tCHD_FIXD_MPD_OVRR_DT4 as string,\n\t\tCHD_TSM_PRTC_IN as string,\n\t\tCHD_ZIP_CODE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> FDCustomerData\nsource(output(\n\t\taccount_key as string,\n\t\tsource_system_key as integer,\n\t\tbin_key as long,\n\t\tclient_key as long,\n\t\taccount_number as string,\n\t\taccount_issue_date as date,\n\t\taccount_activation_date as date,\n\t\taccount_activation_flag as string,\n\t\taccount_status_flag as string,\n\t\taccount_expiration_date as date,\n\t\tfirst_txn_date as date,\n\t\tdurable_key as integer,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp,\n\t\taccount_closed_date as date,\n\t\taccount_delinquent_date as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select * from [member].[dim_account] with (nolock) where source_system_key = 2 ',\n\tformat: 'query',\n\tstaged: false,\n\tpartitionColumn: 'account_key',\n\tpartitionBy('external', 50)) ~> DwDimAccount\nsource(output(\n\t\tBaseDataID as string,\n\t\tCHD_NEW_FILE_TYPE as string,\n\t\tCHD_RECORD_FORMAT as string,\n\t\tCHD_BRANCH_NO as string,\n\t\tCHD_CLIENT_NUMBER as string,\n\t\tCHD_SYSTEM_NO as string,\n\t\tCHD_PRIN_BANK as string,\n\t\tCHD_AGENT_BANK as string,\n\t\tCHD_ACCOUNT_NUMBER as string,\n\t\tCHD_EXTERNAL_STATUS as string,\n\t\tCHD_INTERNAL_STATUS as string,\n\t\tCHD_PREV_EXT_STATUS as string,\n\t\tCHD_CYCLE_CODE_99 as string,\n\t\tCHD_DATE_LAST_NONMON as string,\n\t\tCHD_PREVIOUS_CYCLE_CODE_99 as string,\n\t\tCHD_CHARGE_DDA_CODE as string,\n\t\tCHD_TRANSIT_ROUTING_NO as string,\n\t\tCHD_CHECKING_ACCT_NO as string,\n\t\tCHD_SAVINGS_ACCT_NO as string,\n\t\tCHD_SEC_CODE_NUM_1 as string,\n\t\tCHD_SEC_CODE_NUM_2 as string,\n\t\tCHD_PIN_TRANSFER_FLAG as string,\n\t\tCHD_ANN_RATE_CASH as string,\n\t\tCHD_ANN_RATE_MRCH as string,\n\t\tCHD_OLD_ANN_RATE as string,\n\t\tCHD_OLD_ANN_RATE_CASH as string,\n\t\tCHD_ANN_RATE_CASH_MAX as string,\n\t\tCHD_ANN_RATE_MRCH_MAX as string,\n\t\tCHD_ANN_RATE_MRCH_FUTURE as string,\n\t\tCHD_ANN_RATE_CASH_FUTURE as string,\n\t\tCHD_MONTHLY_RATE_CASH as string,\n\t\tCHD_DAILY_RATE_CASH as string,\n\t\tCHD_MONTHLY_RATE as string,\n\t\tCHD_DAILY_RATE_MRCH as string,\n\t\tCHD_ANN_RATE_CRDINT as string,\n\t\tCHD_MONTHLY_RATE_CRDINT as string,\n\t\tCHD_DAILY_RATE_CRDINT as string,\n\t\tCHD_MTH_RATE_CASH_MAX as string,\n\t\tCHD_MTH_RATE_MRCH_MAX as string,\n\t\tCHD_ANN_RATE_CASH_MIN as string,\n\t\tCHD_ANN_RATE_MRCH_MIN as string,\n\t\tCHD_MTH_RATE_CASH_MIN as string,\n\t\tCHD_MTH_RATE_MRCH_MIN as string,\n\t\tCHD_BEHAVIOR_SCORE as string,\n\t\tCHD_PREV_BHVR_SCORE as string,\n\t\tCHD_CR_SCORE_DATE as string,\n\t\tCHD_CREDIT_SCORE as string,\n\t\tCHD_COLLECTION_CODE as string,\n\t\tCHD_COFF_REASON_CODE as string,\n\t\tCHD_RECOURSE_FLAG as string,\n\t\tCHD_RECOURSE_MERCHANT as string,\n\t\tCHD_WB_TRAN_TYPE as string,\n\t\tCHD_WB_PURGE_DATE as string,\n\t\tCHD_CREDIT_BUREAU_FLAG as string,\n\t\tCHD_COLL_PROC_FLAG as string,\n\t\tCHD_RECOVERY_IND as string,\n\t\tCHD_RENEWAL_CODE as string,\n\t\tCHD_NO_PLASTICS as string,\n\t\tCHD_TYPE_PLASTIC as string,\n\t\tCHD_SPOUSE_TYPE_PLASTIC as string,\n\t\tCHD_DUAL_TYPE_PLASTIC as string,\n\t\tCHD_DUAL_SPOUSE_TYPE_PLASTIC as string,\n\t\tCHD_NEWCARD_FLAG as string,\n\t\tCHD_ANNUAL_CHARGE_FLAG as string,\n\t\tCHD_ANNUAL_CHG_DATE as string,\n\t\tCHD_MAIL_CODE as string,\n\t\tCHD_MAIL_CODE_FLAG as string,\n\t\tCHD_OPEN_DATE as string,\n\t\tCHD_MEMBER_SINCE_DATE as string,\n\t\tCHD_EXPIRATION_DATE as string,\n\t\tCHD_REISSUE_CONTROL as string,\n\t\tCHD_DATE_LAST_PLASTIC as string,\n\t\tCHD_SMRT_CARD_ICC_CD as string,\n\t\tCHD_CREDIT_LINE as string,\n\t\tCHD_TYPE_CRED_LINE_CHG as string,\n\t\tCHD_CR_LINE_DATE as string,\n\t\tCHD_DATE_LAST_REVIEW as string,\n\t\tCHD_DATE_NEXT_REVIEW as string,\n\t\tCHD_CUST_FLG_1 as string,\n\t\tCHD_CUST_FLG_2 as string,\n\t\tCHD_CUST_FLG_3 as string,\n\t\tCHD_CUST_FLG_4 as string,\n\t\tCHD_SC_1 as string,\n\t\tCHD_SC_2 as string,\n\t\tCHD_SC_3 as string,\n\t\tCHD_SC_4 as string,\n\t\tCHD_SC_5 as string,\n\t\tCHD_SC_6 as string,\n\t\tCHD_SC_7 as string,\n\t\tCHD_SC_8 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_1 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_2 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_3 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_4 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_5 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_6 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_7 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_8 as string,\n\t\tCHD_MISC_FIELD_9 as string,\n\t\tCHD_MISC_FIELD_10 as string,\n\t\tCHD_MISC_FIELD_11_TX as string,\n\t\tCHD_MISC_FIELD_12_TX as string,\n\t\tCHD_CROSS_REFERENCE_ACCT_NO as string,\n\t\tCHD_NEW_XREF_NO_1 as string,\n\t\tCHD_NEW_XREF_NO_2 as string,\n\t\tCHD_CUST_XREF_ID as string,\n\t\tCHD_CR_LIFE_STAT_DATE as string,\n\t\tCHD_CR_LIFE_PAID_AMT as string,\n\t\tCHD_LS_TERMS_FLAG as string,\n\t\tCHD_CTD_TERMS_FLAG as string,\n\t\tCHD_TERMS_DATE as string,\n\t\tCHD_TRANSFER_FLAG as string,\n\t\tCHD_DATE_LOST_STOLEN as string,\n\t\tCHD_ACCT_TRANSFER as string,\n\t\tCHD_ACCT_XFOOT as string,\n\t\tCHD_STMT_FEE_FLAG as string,\n\t\tCHD_FIXED_PAYMENT_AMT as string,\n\t\tCHD_CASH_FIXED_PAYMENT as string,\n\t\tCHD_ANN_ACTIVITY_SUMM_FLAG as string,\n\t\tCHD_90_DAY_FLAG as string,\n\t\tCHD_DEFER_PAY_FLAG as string,\n\t\tCHD_PAY_AHEAD_FLAG as string,\n\t\tCHD_CREDIT_LIFE_FLAG_N as string,\n\t\tCHD_MAX_REBATE_AMT as string,\n\t\tCHD_DELETE_FLAG as string,\n\t\tCHD_DUALITY_FLAG as string,\n\t\tCHD_TYPE_LAST_NONMON as string,\n\t\tCHD_SPEC_STMT_FLAG as string,\n\t\tCHD_AUTOPAY_SKIP_FLAG as string,\n\t\tCHD_GROSS_ACTIVE as string,\n\t\tCHD_DEBIT_ACTIVE as string,\n\t\tCHD_BASIC_ACTIVE as string,\n\t\tCHD_AUTH_FLAG as string,\n\t\tCHD_INTEREST_SWITCH as string,\n\t\tCHD_STMT_HOLD_FLAG as string,\n\t\tCHD_MULTRAN_FLAG as string,\n\t\tCHD_CR_LIFE_STATUS as string,\n\t\tCHD_CB_SCORE as string,\n\t\tCHD_CB_ID as string,\n\t\tCHD_CB_CODE as string,\n\t\tCHD_CB_ATTR1 as string,\n\t\tCHD_CB_ATTR2 as string,\n\t\tCHD_CB_ATTR3 as string,\n\t\tCHD_CB_SCORE_DATE as string,\n\t\tCHD_CB_REASON1 as string,\n\t\tCHD_CB_REASON2 as string,\n\t\tCHD_CB_REASON3 as string,\n\t\tCHD_CB_REASON4 as string,\n\t\tCHD_MO_CHARGE_INT_ONLY as string,\n\t\tCHD_DATE_STATUS_CHG as string,\n\t\tCHD_RISK_PREDICTOR_SCORE as string,\n\t\tCHD_RISK_PREDICTOR_BUREAU as string,\n\t\tCHD_RISK_PREDICTOR_MODEL as string,\n\t\tCHD_VISA_REGION as string,\n\t\tCHD_MC_REGION as string,\n\t\tCHD_ACCT_TRANSFER_DATE as string,\n\t\tCHD_ACCT_TRANSFER_FLAG as string,\n\t\tCHD_CASH_CREDIT_LINE_CHG_DT as string,\n\t\tCHD_CASH_CREDIT_LINE_CHG_TYP as string,\n\t\tCHD_ADD_ON_RATE_FLAG as string,\n\t\tCHD_CURR_PRICING_PORTFOLIO as string,\n\t\tCHD_CURR_PRICING_STRATEGY as string,\n\t\tCHD_CURR_PRICE_STRATEGY_DATE as string,\n\t\tCHD_CURR_STRAT_CYCLE_FLAG as string,\n\t\tCHD_LS_PRCN_PORT_ID as string,\n\t\tCHD_OLD_NEXT_PRICING_STRATEGY as string,\n\t\tCHD_NEXT_PRICE_STRATEGY_DATE as string,\n\t\tCHD_OLD_NEXT_STRAT_CYCLE_FLAG as string,\n\t\tCHD_OLD_NEXT_STRT_STAGE_REASO as string,\n\t\tCHD_LS_PRICING_STRATEGY as string,\n\t\tCHD_LAST_STRATEGY_CHANGE_DATE as string,\n\t\tCHD_PROCESSING_LEVEL as string,\n\t\tCHD_UD_SOURCE_CODE as string,\n\t\tCHD_UD_APPROVAL_OFFICER_CODE as string,\n\t\tCHD_FRAUD_PORT_ID as string,\n\t\tCHD_FRAUD_ASSG_STRATEGY as string,\n\t\tCHD_FRAUD_STRAT_CHANGE_DATE as string,\n\t\tCHD_FRAUD_SUSPEND_STRATEGY as string,\n\t\tCHD_FRAUD_SUSP_STRATEGY_DATE as string,\n\t\tCHD_LAST_PLASTIC_SOURCE as string,\n\t\tCHD_FRAUD_SCORE_CHANGE_DATE as string,\n\t\tCHD_FRAUD_SCORE as string,\n\t\tCHD_DATE_LAST_ACL_LTR as string,\n\t\tCHD_DISCOUNT_CODE as string,\n\t\tCHD_NO_MAIL_FLAG as string,\n\t\tCHD_PRICING_STRATEGY_STATUS as string,\n\t\tCHD_BONUS_STRATEGY as string,\n\t\tCHD_LS_BONUS_STRATEGY as string,\n\t\tCHD_LAST_ANNUAL_CHARGE_FLAG as string,\n\t\tCHD_HIGH_BAL_LIFE as string,\n\t\tCHD_MIN_DAYS_DELQ_NR as string,\n\t\tCHD_ACS_CLNT_ID as string,\n\t\tCHD_PREV_INTERNAL_STATUS as string,\n\t\tCHD_DATE_IN_COLLECTION as string,\n\t\tCHD_START_DATE_OF_DELQ as string,\n\t\tCHD_PRIMARY_PEF as string,\n\t\tCHD_SECONDARY_PEF as string,\n\t\tCHD_COV_STRATEGY_ID as string,\n\t\tCHD_BS_REASON_CODE_1 as string,\n\t\tCHD_BS_REASON_CODE_2 as string,\n\t\tCHD_BS_REASON_CODE_3 as string,\n\t\tCHD_BS_REASON_CODE_4 as string,\n\t\tCHD_REQ_CLOSED_DATE as string,\n\t\tCHD_PREV_CRLINE_CHANGE_DATE as string,\n\t\tCHD_CRLINE_CHANGE_AMT as string,\n\t\tCHD_CASH_CRDT_LINE_AM as string,\n\t\tCHD_CASH_LINE_REVW_DT as string,\n\t\tCHD_TLP_CLT_ID as string,\n\t\tCHD_TLP_CLT_EXPR_DT as string,\n\t\tCHD_ACCT_CT as string,\n\t\tCHD_CRRN_ANNL_CASH_RT as string,\n\t\tCHD_CRRN_ANNL_MRCH_RT as string,\n\t\tCHD_HIGH_NOM_MRCH_APPLIED_RT as string,\n\t\tCHD_LOW_NOM_MRCH_APPLIED_RT as string,\n\t\tCHD_HIGH_NOM_CASH_APPLIED_RT as string,\n\t\tCHD_LOW_NOM_CASH_APPLIED_RT as string,\n\t\tCHD_EQTY_ACCT_MTRT_DT as string,\n\t\tCHD_SUB_ACCT_CD as string,\n\t\tCHD_CMPN_ID as string,\n\t\tCHD_ACCT_MRKT_STRT_NM as string,\n\t\tCHD_ACCT_MRKT_PRCS_CD as string,\n\t\tCHD_ACCT_MRKT_STRT_DT as string,\n\t\tCHD_REIS_STRT_NM as string,\n\t\tCHD_REIS_PRCS_CD as string,\n\t\tCHD_REIS_STRT_DT as string,\n\t\tCHD_ACCT_GROP_ID as string,\n\t\tCHD_PYMN_DUE_DT as string,\n\t\tCHD_NEWCRD_FLAG_RETN_DT as string,\n\t\tCHD_NEXT_CYCL_DT as string,\n\t\tCHD_LAST_MON_TRAN_CD as string,\n\t\tCHD_DALY_INTR_CALC_MTHD_CD as string,\n\t\tCHD_CR_LIFE_STATUS_DT as string,\n\t\tCHD_LAST_LTTR_ID as string,\n\t\tCHD_LAST_LTTR_DT as string,\n\t\tCHD_AVLB_CRDT_AMT as string,\n\t\tCHD_CALC_NORM_CASH_RT as string,\n\t\tCHD_CALC_NORM_MRCH_RT as string,\n\t\tCHD_CALC_NORM_CASH_MNTH_RT as string,\n\t\tCHD_CALC_NORM_MRCH_MNTH_RT as string,\n\t\tCHD_CALC_NORM_CASH_ANN_RT as string,\n\t\tCHD_CALC_NORM_MRCH_ANN_RT as string,\n\t\tCHD_PAYMENT_DUE_DAYS_NR as string,\n\t\tCHD_MISC_13_PSTN_1_10_TX as string,\n\t\tCHD_MISC_13_PSTN_11_15_TX as string,\n\t\tCHD_MISC_13_PSTN_16_20_TX as string,\n\t\tCHD_MISC_13_PSTN_21_25_TX as string,\n\t\tCHD_MISC_13_PSTN_26_TX as string,\n\t\tCHD_MISC_13_PSTN_27_TX as string,\n\t\tCHD_MISC_13_PSTN_28_TX as string,\n\t\tCHD_MISC_13_PSTN_29_TX as string,\n\t\tCHD_MISC_13_PSTN_30_TX as string,\n\t\tCHD_MISC_13_PSTN_31_TX as string,\n\t\tCHD_MISC_13_PSTN_32_TX as string,\n\t\tCHD_MISC_13_PSTN_33_TX as string,\n\t\tCHD_MISC_13_PSTN_34_TX as string,\n\t\tCHD_MISC_13_PSTN_35_TX as string,\n\t\tCHD_MISC_13_PSTN_36_TX as string,\n\t\tCHD_MISC_13_PSTN_37_TX as string,\n\t\tCHD_MISC_13_PSTN_38_TX as string,\n\t\tCHD_MISC_13_PSTN_39_TX as string,\n\t\tCHD_MISC_13_PSTN_40_TX as string,\n\t\tCHD_MISC_13_PSTN_41_TX as string,\n\t\tCHD_MISC_13_PSTN_42_TX as string,\n\t\tCHD_MISC_13_PSTN_43_TX as string,\n\t\tCHD_MISC_13_PSTN_44_TX as string,\n\t\tCHD_MISC_13_PSTN_45_TX as string,\n\t\tCHD_MISC_13_PSTN_46_TX as string,\n\t\tCHD_MISC_13_PSTN_47_TX as string,\n\t\tCHD_MISC_13_PSTN_48_TX as string,\n\t\tCHD_MISC_13_PSTN_49_TX as string,\n\t\tCHD_MISC_13_PSTN_50_TX as string,\n\t\tCHD_BHVR_SCOR_DT as string,\n\t\tCHD_DBT_ACTV_ID as string,\n\t\tCHD_CRDT_LINE_CHNG_DT as string,\n\t\tCHD_PREV_CRDT_LINE_CHNG_DT as string,\n\t\tCHD_CRDT_BUR_BKCY_DT as string,\n\t\tRoutingTransit as string,\n\t\tFDR_Date_Processed as string,\n\t\tExtractDate as string,\n\t\tDateProcessed as string,\n\t\tCHDHD_1098_YTD_INTR_THRD_AM as string,\n\t\tCHDHD_1098_YTD_INTR_TOTL_AM as string,\n\t\tCHDHD_1098_PREV_INTR_THRD_AM as string,\n\t\tCHDHD_1098_PREV_INTR_TOTL_AM as string,\n\t\tSysPrinAgent as string,\n\t\tCHD_AVOD_FINC_CHRG_AM as string,\n\t\tCHD_LFTM_CASH_AND_MRCH_AM as string,\n\t\tCHD_RECOVERY_CD as string,\n\t\tReportDate as string,\n\t\tCHD_AUTO_PAY_PNDG_IN as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> FDBaseData\nsource(output(\n\t\tDurable_Key as string,\n\t\tAccount_Key_Id as string,\n\t\tAccount_Key_Internal as string,\n\t\tAccount_Number as string,\n\t\tCross_Reference_Account_Number_1 as string,\n\t\tCross_Reference_Account_Number_2 as string,\n\t\tCross_Reference_Account_Key_Internal as string,\n\t\tAccount_Open_Date as string,\n\t\tExternal_Status as string,\n\t\tAnalytics_Record_Created as string,\n\t\tActive_Flag as string,\n\t\tHierarchy_Path as string,\n\t\tHierarchy_RowNumber as string,\n\t\tOnBalStat as string,\n\t\tSSN as string,\n\t\tSSN_Mask as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> AccountHierarchy\nsource(output(\n\t\tPI_Record_ID as string,\n\t\tPINS_GROUP_ID as string,\n\t\tPINS_OUT_KEY_SYS_BANK as string,\n\t\tPINS_OUT_KEY_PRIN_BANK as string,\n\t\tPINS_OUT_KEY_AGENT_BANK as string,\n\t\tPINS_OUT_KEY_ACCT_NO as string,\n\t\tPINS_TYPE_CD as string,\n\t\tPINS_MMBR_SQNC_NR as string,\n\t\tPINS_OUT_PI_ID as string,\n\t\tPINS_OUT_ASSG_CRTN_DT as string,\n\t\tPINS_OUT_PLST_GNRT_LAST_DT as string,\n\t\tPINS_OUT_PIN_LAST_CHNG_DT as string,\n\t\tPINS_OUT_PIN_MALR_LAST_DT as string,\n\t\tPINS_OUT_EXPR_DT as string,\n\t\tPINS_OUT_PLST_CT as string,\n\t\tPINS_OUT_PIN_VRFY_NR as string,\n\t\tPINS_OUT_PSTN_TYPE_CD as string,\n\t\tPINS_OUT_PIN_TRNS_FLAG_IN as string,\n\t\tPINS_OUT_SCRT_CD as string,\n\t\tPINS_OUT_PLST_TYPE_CD as string,\n\t\tPINS_OUT_PLST_RPLC_IN as string,\n\t\tPINS_OUT_PIN_PRHB_IN as string,\n\t\tPINS_OUT_PHTC_USE_INDC_CD as string,\n\t\tPINS_OUT_PRSN_EMBS_TX as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_CD as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_DT as string,\n\t\tPINS_OUT_ACCT_ACCS_TS as string,\n\t\tPINS_OUT_PCKG_ID as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_TM as string,\n\t\tPINS_OUT_MNTN_TS as string,\n\t\tPINS_OUT_PI_BULK_MAIL_ID as string,\n\t\tPINS_OUT_PI_TYPE_CD as string,\n\t\tPINS_OUT_PLST_RPLC_DT as string,\n\t\tPINS_OUT_PRIR_EXPR_DT as string,\n\t\tPINS_OUT_PI_RPLC_SQNC_NR as string,\n\t\tPINS_OUT_AUTH_PRIR_EXPR_IN as string,\n\t\tPINS_OUT_PHTC_IMAG_STTS_CD as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> PIRecord\nsource(output(\n\t\tsource_system_key as integer,\n\t\taccount_key_trans as string,\n\t\tsettlement_date as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select source_system_key, account_key as account_key_trans, min(settlement_date_key) as settlement_date FROM [transaction].[fact_transaction] with (nolock) where source_system_key = 2  and settlement_date_key >\\'1900-01-01\\' group by source_system_key, account_key',\n\tformat: 'query',\n\tstaged: false,\n\tpartitionColumn: 'account_key_trans',\n\tpartitionBy('external', 50)) ~> FactTransactions\nsource(output(\n\t\tdw_binkey as long,\n\t\tdw_clientkey as long,\n\t\tbankIdentificationNumberISO as string,\n\t\tbankIdentificationNumberEXT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'select distinct bin_key as dw_binkey, client_key as dw_clientkey, bankIdentificationNumberISO, bankIdentificationNumberEXT from [financialinstitution].[dim_bin] with (nolock)',\n\tformat: 'query',\n\tstaged: false) ~> DWDimBin\nsource(output(\n\t\tSPAIdentifier as integer,\n\t\tsys as string,\n\t\tprin as string,\n\t\tagent as string,\n\t\tcu_odindx as string,\n\t\tcardtyp as integer,\n\t\tInterestRate as float,\n\t\tAnnualFee as decimal(10,0),\n\t\tOverlimitFee as decimal(10,0),\n\t\tLateFee as decimal(10,0),\n\t\tCwbFee as decimal(10,0),\n\t\tAutoDQFee as decimal(10,0),\n\t\tGroupNo as integer,\n\t\tGroupDesc as string,\n\t\tItemizedPerAcct as string,\n\t\tPrimaryBillingSys as string,\n\t\tPlatform as string,\n\t\tSPA as string,\n\t\tDateProcessed as timestamp,\n\t\tStatus as integer,\n\t\tUniversalAddressing as string,\n\t\tSeparateEntityFlag as string,\n\t\tInternationalDateFormat as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> CCUMSTR\nsource(output(\n\t\tCD495DTLID as string,\n\t\tINDX as string,\n\t\tID as string,\n\t\tDESCR as string,\n\t\tBSYS as string,\n\t\tBPRN as string,\n\t\tBAGT as string,\n\t\tTERMID as string,\n\t\tOPCODE as string,\n\t\tACCTNO as string,\n\t\tCUSTFG as string,\n\t\tTRANTP as string,\n\t\tTRDESC as string,\n\t\tTDDATE as string,\n\t\tTDYR as string,\n\t\tTDMO as string,\n\t\tTDDY as string,\n\t\tTDTIME as string,\n\t\tTDINPT as string,\n\t\tDateProcessed as string,\n\t\tRPTDT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\trowUrlColumn: 'see_data') ~> CD495\nsource(output(\n\t\tPI_Status_ID as string,\n\t\tPRST_GROUP_ID as string,\n\t\tPRST_OUT_KEY_SYS_BANK as string,\n\t\tPRST_OUT_KEY_PRIN_BANK as string,\n\t\tPRST_OUT_KEY_AGENT_BANK as string,\n\t\tPRST_OUT_KEY_ACCT_NO as string,\n\t\tPRST_TYPE_CD as string,\n\t\tPRST_MMBR_SQNC_NR as string,\n\t\tPRST_OUT_PI_ID as string,\n\t\tPRST_OUT_DRVN_SIDE_CD as string,\n\t\tPRST_OUT_LOST_STLN_DT as string,\n\t\tPRST_OUT_ACTV_CD as string,\n\t\tPRST_OUT_PI_STTS_CD as string,\n\t\tPRST_OUT_STTS_RESN_CD as string,\n\t\tPRST_OUT_STTS_CHNG_DT as string,\n\t\tPRST_OUT_SYS_ID as string,\n\t\tPRST_OUT_PRIN_ID as string,\n\t\tPRST_OUT_AGNT_ID as string,\n\t\tPRST_OUT_TMPR_CD as string,\n\t\tPRST_OUT_PI_FRAD_STGY_DT as string,\n\t\tPRST_OUT_PI_FRAD_STGY_ID as string,\n\t\tPRST_OUT_TRMN_PRMP_OVRR_CD as string,\n\t\tPRST_OUT_TRAN_RSTR_CD as string,\n\t\tPRST_OUT_EXTR_CLSS_CD as string,\n\t\tPRST_OUT_PITC_EXTR_CLSS_ID as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> PIStatus\nJoinwithAcctNbr derive(AccountHashkey = md5(iif(isNull(DistinctAttributes@CustomerData_AccountNumber),'',DistinctAttributes@CustomerData_AccountNumber)\r\n, iif(isNull(source_system_key_CustomerData),0,source_system_key_CustomerData))) ~> CreateHashkeys\nFDCustomerData select(mapColumn(\n\t\tCustomerData_AccountNumber = CHD_ACCOUNT_NUMBER,\n\t\tCustomerData_CHD_PRINCIPAL_NAME = CHD_PRINCIPAL_NAME,\n\t\tCustomerData_ReportDate = ReportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCustomerAttributes\nFDBaseData select(mapColumn(\n\t\tAccount_Number_BaseData = CHD_ACCOUNT_NUMBER,\n\t\tSysPrinAgent,\n\t\tCHD_EXTERNAL_STATUS,\n\t\tCHD_CUST_FLG_1,\n\t\tCHD_OPEN_DATE,\n\t\tCHD_DATE_LAST_PLASTIC,\n\t\tCHD_EXPIRATION_DATE,\n\t\tCHD_CLIENT_NUMBER,\n\t\tCHD_SYSTEM_NO,\n\t\tCHD_PRIN_BANK,\n\t\tCHD_AGENT_BANK,\n\t\tCHD_CUST_FLG_3,\n\t\tCHD_REQ_CLOSED_DATE,\n\t\tCHD_START_DATE_OF_DELQ\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectAttributesBaseData\nAccountHierarchy select(mapColumn(\n\t\tDurable_Key,\n\t\tAccount_Number_AccountHieracry = Account_Number\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectAccountHiearchyAttributes\nPIStatusActivationFlag, TrimBaseData join(CustomerData_AccountNumber == BaseData_Account_Number,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> GetBaseDataAttributes\nGetBaseDataAttributes, TrimAccountHierarchy join(CustomerData_AccountNumber == Account_Number_AccountHieracry,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> GetAccountHierarchyAttributes\nOnlyAttributesNeededBaseData derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimBaseData\nSelectAccountHiearchyAttributes derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimAccountHierarchy\nGetAccountHierarchyAttributes derive(source_system_key_CustomerData = 2,\n\t\tDurable_Key_AccountData = toInteger(Durable_Key),\n\t\tIssueDate = iif((coalesce(BaseData_CHD_DATE_LAST_PLASTIC,'0') == '0'), \r\ntoDate(concat(\r\nsubstring(\r\niif(length(BaseData_CHD_OPEN_DATE)==5,concat('0',BaseData_CHD_OPEN_DATE),BaseData_CHD_OPEN_DATE),1,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_OPEN_DATE)==5,concat('0',BaseData_CHD_OPEN_DATE),BaseData_CHD_OPEN_DATE),3,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_OPEN_DATE)==5,concat('0',BaseData_CHD_OPEN_DATE),BaseData_CHD_OPEN_DATE),5,2)),'yy-MM-dd'),\r\n\r\n\r\n\r\ntoDate(concat(\r\nsubstring(\r\niif(length(BaseData_CHD_DATE_LAST_PLASTIC)==5,concat('0',BaseData_CHD_DATE_LAST_PLASTIC),BaseData_CHD_DATE_LAST_PLASTIC),1,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_DATE_LAST_PLASTIC)==5,concat('0',BaseData_CHD_DATE_LAST_PLASTIC),BaseData_CHD_DATE_LAST_PLASTIC),3,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_DATE_LAST_PLASTIC)==5,concat('0',BaseData_CHD_DATE_LAST_PLASTIC),BaseData_CHD_DATE_LAST_PLASTIC),5,2)),'yy-MM-dd')),\n\t\tExpirationDate = toDate(concat(\r\nsubstring(\r\niif(length(BaseData_CHD_EXPIRATION_DATE)==5,concat('0',BaseData_CHD_EXPIRATION_DATE),BaseData_CHD_EXPIRATION_DATE),1,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_EXPIRATION_DATE)==5,concat('0',BaseData_CHD_EXPIRATION_DATE),BaseData_CHD_EXPIRATION_DATE),3,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_EXPIRATION_DATE)==5,concat('0',BaseData_CHD_EXPIRATION_DATE),BaseData_CHD_EXPIRATION_DATE),5,2)),'yy-MM-dd'),\n\t\tReportDate = toDate(CustomerData_ReportDate,'yyyy-MM-dd'),\n\t\tCardActivationDate = iif(\r\n    isNull (CD495_RPTDT)\r\n,toDate('1900-01-01'), toDate(CD495_RPTDT,'MM/dd/yy')),\n\t\tAccountActivationFlag = iif(\r\n    BaseData_CHD_CLIENT_NUMBER != '0744',\r\n    case(\r\nBaseData_CHD_CUST_FLG_1 == 'V'\r\n||BaseData_CHD_CUST_FLG_1 ==''\r\n||BaseData_CHD_CUST_FLG_1 ==' '\r\n||isNull(BaseData_CHD_CUST_FLG_1)\r\n|| (PIStatusActivationFlag) == '1'\r\n, 'Y'\r\n, 'N'),iif(BaseData_CHD_CLIENT_NUMBER == '0744', case(\r\nBaseData_CHD_CUST_FLG_3 == 'V'\r\n||BaseData_CHD_CUST_FLG_3 ==''\r\n||BaseData_CHD_CUST_FLG_3 ==' '\r\n||isNull(BaseData_CHD_CUST_FLG_3)\r\n|| PIStatusActivationFlag == '1'\r\n, 'Y'\r\n, 'N'), 'N')),\n\t\tAccountStatusInteger = toInteger(\r\ncase(\r\nBaseData_CHD_EXTERNAL_STATUS == 'A'\r\n||BaseData_CHD_EXTERNAL_STATUS ==' '\r\n||BaseData_CHD_EXTERNAL_STATUS ==''\r\n||isNull(BaseData_CHD_EXTERNAL_STATUS)\r\n, '0'\r\n, '1')),\n\t\tClosedDate = toDate(concat(\r\nsubstring(\r\niif(length(BaseData_CHD_REQ_CLOSED_DATE)==5,concat('0',BaseData_CHD_REQ_CLOSED_DATE),BaseData_CHD_REQ_CLOSED_DATE),1,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_REQ_CLOSED_DATE)==5,concat('0',BaseData_CHD_REQ_CLOSED_DATE),BaseData_CHD_REQ_CLOSED_DATE),3,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_REQ_CLOSED_DATE)==5,concat('0',BaseData_CHD_REQ_CLOSED_DATE),BaseData_CHD_REQ_CLOSED_DATE),5,2)),'yy-MM-dd'),\n\t\tDelinquentDate = toDate(concat(\r\nsubstring(\r\niif(length(BaseData_CHD_START_DATE_OF_DELQ)==8,BaseData_CHD_START_DATE_OF_DELQ),1,4),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_START_DATE_OF_DELQ)==8,BaseData_CHD_START_DATE_OF_DELQ),5,2),'-',\r\nsubstring(\r\niif(length(BaseData_CHD_START_DATE_OF_DELQ)==8,BaseData_CHD_START_DATE_OF_DELQ),7,2)),'yyyy-MM-dd')) ~> ConvertDataAndApplyLogic\nTrimSpaces aggregate(groupBy(CustomerData_AccountNumber,\n\t\tCustomerData_CHD_PRINCIPAL_NAME,\n\t\tCustomerData_ReportDate),\n\tCountAccountNumber = count(CustomerData_AccountNumber)) ~> DistinctAccounts\nFilterNullAcctNums derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimSpaces\nPIRecord select(mapColumn(\n\t\tPIRecord_PINS_OUT_PI_ID = PINS_OUT_PI_ID,\n\t\tPINS_OUT_EXPR_DT,\n\t\tPINS_OUT_KEY_SYS_BANK,\n\t\tPINS_OUT_KEY_PRIN_BANK,\n\t\tPINS_OUT_KEY_AGENT_BANK,\n\t\tPINS_OUT_PLST_RPLC_IN,\n\t\tPINS_OUT_KEY_ACCT_NO,\n\t\tPINS_TYPE_CD,\n\t\tPINS_MMBR_SQNC_NR\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> PIRecordSelect\nGetOnlyAttributesPIRecord derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimPIRecord\nDistinctAttributes, selectAccountBinClient join(DistinctAttributes@CustomerData_AccountNumber == selectAccountBinClient@CustomerData_AccountNumber,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinwithAcctNbr\nSelectCustomerAttributes filter(!isNull(CustomerData_AccountNumber)) ~> FilterNullAcctNums\nConvertDataAndApplyLogic aggregate(groupBy(CustomerData_AccountNumber,\n\t\tIssueDate,\n\t\tsource_system_key_CustomerData,\n\t\tDurable_Key_AccountData),\n\tcount = count(),\n\t\tCardActivationDate = iif(min(CardActivationDate<IssueDate),max(CardActivationDate),min(CardActivationDate)),\n\t\tExpirationDate = max(ExpirationDate),\n\t\tAccountStatusInteger = case(max(AccountStatusInteger)==0,'Non-Statused','Statused'),\n\t\tReportDate = max(ReportDate),\n\t\tAccountActivationFlag = max(AccountActivationFlag),\n\t\tClosedDate = max(ClosedDate),\n\t\tDelinquentDate = max(DelinquentDate)) ~> DistinctAttributes\nCreateHashkeys, DwDimAccount join(AccountHashkey == account_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinAccounts\nJoinAccounts, FactTransactions join(DistinctAttributes@CustomerData_AccountNumber == account_key_trans\n\t&& source_system_key_CustomerData == FactTransactions@source_system_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinTransactions\nIssueDateFillIn derive(account_activation_date = iif(\r\nIssueDate_updated>account_issue_date\r\n||isNull(account_issue_date)\r\n||account_activation_date<account_issue_date\r\n||account_activation_date<IssueDate_updated,toDate('1900-01-01'),account_activation_date),\n\t\taccount_issue_date = iif(\r\nisNull(account_issue_date)\r\n,toDate('1900-01-01'),account_issue_date),\n\t\taccount_expiration_date = iif(IssueDate_updated>account_issue_date||isNull(account_issue_date)||account_expiration_date<account_issue_date||account_expiration_date<IssueDate_updated,toDate('1900-01-01'),account_expiration_date),\n\t\tfirst_txn_date = iif(IssueDate_updated>account_issue_date||isNull(account_issue_date)||first_txn_date<account_issue_date||first_txn_date<IssueDate_updated,toDate('1900-01-01'),first_txn_date)) ~> ResetAttributes\nResetAttributes derive(ExpirationDate_passone = iif(ExpirationDate<IssueDate_updated || ExpirationDate<account_expiration_date || ExpirationDate==toDate('1900-01-01') || isNull(ExpirationDate)\r\n    ,coalesce(account_expiration_date,toDate('1900-01-01'))\r\n    ,ExpirationDate)) ~> ExpirationDatePassOne\nExpirationDatePassOne derive(first_txn_date_updated = iif(isNull(first_txn_date)||first_txn_date==toDate('1900-01-01')\r\n    ,iif(settlement_date>IssueDate_updated && iif(ExpirationDate_passone==toDate('1900-01-01')||isNull(ExpirationDate_passone), true(),settlement_date<ExpirationDate_passone)\r\n        , settlement_date\r\n        , toDate('1900-01-01'))\r\n    ,first_txn_date)) ~> FirstTxnDateLogic\nFirstTxnDateLogic derive(ActivationDate_updated = iif(isNull(CardActivationDate)||CardActivationDate==toDate('1900-01-01')||CardActivationDate<IssueDate_updated||CardActivationDate>ExpirationDate_passone\r\n    ,coalesce(account_activation_date,toDate('1900-01-01'))\r\n,CardActivationDate)) ~> ActivationDateLogic\nExpirationDatePassTwo derive(dw_binkey = coalesce(dw_binkey, bin_key),\n\t\tdw_clientkey = coalesce(dw_clientkey, client_key),\n\t\tAccountActivationFlag = coalesce(AccountActivationFlag, account_activation_flag),\n\t\tAccountStatus = coalesce(AccountStatusInteger, account_status_flag),\n\t\tReportDate = coalesce(load_date,ReportDate),\n\t\tcreate_date_new = coalesce(create_date,currentTimestamp()),\n\t\treport_date_updated = toTimestamp(ReportDate)) ~> AdditionalLogic\nAdditionalLogic select(mapColumn(\n\t\tsource_system_key_CustomerData,\n\t\tAccountHashkey,\n\t\tdw_binkey,\n\t\tdw_clientkey,\n\t\tAccountNumber_CustomerData = DistinctAttributes@CustomerData_AccountNumber,\n\t\tIssueDate_updated,\n\t\tfirst_txn_date_updated,\n\t\tActivationDate_updated,\n\t\tExpirationDate_updated = ExpirationDate_passtwo,\n\t\tAccountActivationFlag,\n\t\tAccountStatus,\n\t\tDurable_Key_AccountData,\n\t\tReportDate,\n\t\tcreate_date_new,\n\t\treport_date_updated,\n\t\tClosed_Date_updated = ClosedDate,\n\t\tDelinquent_Date_updated = DelinquentDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectUpsertColumns\nSelectUpsertColumns alterRow(upsertIf(true())) ~> Upsert\nActivationDateLogic derive(ExpirationDate_passtwo = iif(ExpirationDate_passone==toDate('1900-01-01')||ExpirationDate_passone<ActivationDate_updated\r\n    ,iif(first_txn_date_updated==toDate('1900-01-01')\r\n        ,iif(ActivationDate_updated==toDate('1900-01-01')\r\n            ,IssueDate_updated,ActivationDate_updated)\r\n    ,first_txn_date_updated)\r\n,ExpirationDate_passone)) ~> ExpirationDatePassTwo\nJoinTransactions derive(IssueDate_updated = iif(IssueDate > coalesce(account_issue_date,toDate('1900-01-01')) ,IssueDate,account_issue_date)) ~> IssueDateFillIn\nSelectCcuMstr derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimCCUMSTR\nCCUMSTR select(mapColumn(\n\t\tSPAIdentifier,\n\t\tsys,\n\t\tprin,\n\t\tagent,\n\t\tcu_odindx,\n\t\tcardtyp,\n\t\tInterestRate,\n\t\tAnnualFee,\n\t\tOverlimitFee,\n\t\tLateFee,\n\t\tCwbFee,\n\t\tAutoDQFee,\n\t\tGroupNo,\n\t\tGroupDesc,\n\t\tItemizedPerAcct,\n\t\tPrimaryBillingSys,\n\t\tPlatform,\n\t\tCCUMSTR_SPA = SPA,\n\t\tDateProcessed,\n\t\tStatus,\n\t\tUniversalAddressing,\n\t\tSeparateEntityFlag,\n\t\tInternationalDateFormat\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCcuMstr\nPIRecordSelect derive(PIrecord_SPA = toString(concat(PINS_OUT_KEY_SYS_BANK,PINS_OUT_KEY_PRIN_BANK,PINS_OUT_KEY_AGENT_BANK))) ~> GetPIrecordSpa\nTrimCCUMSTR, TrimBaseData join(CCUMSTR_SPA == BaseData_SPA,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinCcumstrBaseData\nJoinCcumstrBaseData select(mapColumn(\n\t\tCCUMSTR_SeparateEntityFlag = SeparateEntityFlag,\n\t\tSeparateEntityFlag_AccountNumber = BaseData_Account_Number\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SeparateEntityFlag\nCD495 select(mapColumn(\n\t\tCD495_ACCTNO = ACCTNO,\n\t\tCD495_RPTDT = RPTDT,\n\t\tCD495_TDDATE = TDDATE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCD495\nSelectCD495 derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimCD495\nSelectAttributesBaseData derive(BaseData_SPA = concat(CHD_SYSTEM_NO,CHD_PRIN_BANK,CHD_AGENT_BANK)) ~> GetBaseDataSpa\nGetBaseDataSpa select(mapColumn(\n\t\tBaseData_Account_Number = Account_Number_BaseData,\n\t\tBaseData_CHD_EXTERNAL_STATUS = CHD_EXTERNAL_STATUS,\n\t\tBaseData_CHD_CUST_FLG_1 = CHD_CUST_FLG_1,\n\t\tBaseData_CHD_DATE_LAST_PLASTIC = CHD_DATE_LAST_PLASTIC,\n\t\tBaseData_CHD_OPEN_DATE = CHD_OPEN_DATE,\n\t\tBaseData_CHD_EXPIRATION_DATE = CHD_EXPIRATION_DATE,\n\t\tBaseData_CHD_CLIENT_NUMBER = CHD_CLIENT_NUMBER,\n\t\tBaseData_CHD_CUST_FLG_3 = CHD_CUST_FLG_3,\n\t\tBaseData_SPA,\n\t\tBaseData_CHD_REQ_CLOSED_DATE = CHD_REQ_CLOSED_DATE,\n\t\tBaseData_CHD_START_DATE_OF_DELQ = CHD_START_DATE_OF_DELQ\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> OnlyAttributesNeededBaseData\nGetPIrecordSpa select(mapColumn(\n\t\tPIRecord_PINS_OUT_PI_ID,\n\t\tPIRecord_PINS_OUT_EXPR_DT = PINS_OUT_EXPR_DT,\n\t\tPIrecord_SPA,\n\t\tPIrecord_PINS_OUT_PLST_RPLC_IN = PINS_OUT_PLST_RPLC_IN,\n\t\tPIrecord_PINS_OUT_KEY_ACCT_NO = PINS_OUT_KEY_ACCT_NO,\n\t\tPIrecord_PINS_TYPE_CD = PINS_TYPE_CD,\n\t\tPIrecord_PINS_MMBR_SQNC_NR = PINS_MMBR_SQNC_NR\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> GetOnlyAttributesPIRecord\nJoinCD496 derive(PIStatusActivationFlag = case(in(['7','8'],PIStatus_PRST_OUT_ACTV_CD) || (PIrecord_PINS_OUT_PLST_RPLC_IN == 'N'), '0', '1')) ~> PIStatusActivationFlag\nPIStatus select(mapColumn(\n\t\tPIStatus_PRST_OUT_KEY_SYS_BANK = PRST_OUT_KEY_SYS_BANK,\n\t\tPIStatus_PRST_OUT_KEY_PRIN_BANK = PRST_OUT_KEY_PRIN_BANK,\n\t\tPIStatus_PRST_OUT_KEY_AGENT_BANK = PRST_OUT_KEY_AGENT_BANK,\n\t\tPIStatus_PRST_OUT_KEY_ACCT_NO = PRST_OUT_KEY_ACCT_NO,\n\t\tPIStatus_PRST_OUT_PI_ID = PRST_OUT_PI_ID,\n\t\tPIStatus_PRST_OUT_ACTV_CD = PRST_OUT_ACTV_CD,\n\t\tPIStatus_DBI_CLIENT_NUMBER = DBI_CLIENT_NUMBER,\n\t\tPIStatus_PRST_TYPE_CD = PRST_TYPE_CD,\n\t\tPIStatus_PRST_MMBR_SQNC_NR = PRST_MMBR_SQNC_NR\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPIStatus\nSelectPIStatus derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimPIStatus\nJoinPIStatus, TrimCD495 join(PIRecord_PINS_OUT_PI_ID == CD495_ACCTNO,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinCD496\nDistinctAccounts, TrimPIRecord join(CustomerData_AccountNumber == PIrecord_PINS_OUT_KEY_ACCT_NO,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinPIRecord\nJoinPIRecord, TrimPIStatus join(PIrecord_PINS_OUT_KEY_ACCT_NO == PIStatus_PRST_OUT_KEY_ACCT_NO\n\t&& PIrecord_PINS_TYPE_CD == PIStatus_PRST_TYPE_CD\n\t&& PIrecord_PINS_MMBR_SQNC_NR == PIStatus_PRST_MMBR_SQNC_NR\n\t&& PIRecord_PINS_OUT_PI_ID == PIStatus_PRST_OUT_PI_ID,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinPIStatus\nDistinctAttributes, DWDimBin join(left(CustomerData_AccountNumber,6) == left(bankIdentificationNumberEXT,6)\r\n&&\r\nlike(CustomerData_AccountNumber,bankIdentificationNumberEXT + '%'),\n\tjoinType:'cross',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> joinDimBinEXT\njoinDimBinEXT window(over(AccountNumber_CustomerData = CustomerData_AccountNumber,\n\t\tAccountActivationFlag,\n\t\tAccountStatusInteger,\n\t\tExpirationDate,\n\t\tIssueDate,\n\t\tReportDate,\n\t\tCardActivationDate,\n\t\tsource_system_key_CustomerData,\n\t\tDurable_Key_AccountData,\n\t\tClosedDate,\n\t\tDelinquentDate),\n\tdesc(bankIdentificationNumberEXT, true),\n\trownumber_bin_client = rowNumber()) ~> RankBins\nRankBins filter(rownumber_bin_client==1) ~> FilterTopRankedBins\nFilterTopRankedBins select(mapColumn(\n\t\tCustomerData_AccountNumber,\n\t\tdw_binkey,\n\t\tdw_clientkey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectAccountBinClient\nUpsert sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\taccount_key as string,\n\t\tsource_system_key as integer,\n\t\tbin_key as long,\n\t\tclient_key as long,\n\t\taccount_number as string,\n\t\taccount_issue_date as date,\n\t\taccount_activation_date as date,\n\t\taccount_activation_flag as string,\n\t\taccount_status_flag as string,\n\t\taccount_expiration_date as date,\n\t\tfirst_txn_date as date,\n\t\tdurable_key as integer,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp,\n\t\taccount_closed_date as date,\n\t\taccount_delinquent_date as date\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['account_key'],\n\tformat: 'table',\n\tstaged: true,\n\tallowCopyCommand: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\taccount_key = AccountHashkey,\n\t\tsource_system_key = source_system_key_CustomerData,\n\t\tbin_key = dw_binkey,\n\t\tclient_key = dw_clientkey,\n\t\taccount_number = AccountNumber_CustomerData,\n\t\taccount_issue_date = IssueDate_updated,\n\t\taccount_activation_date = ActivationDate_updated,\n\t\taccount_activation_flag = AccountActivationFlag,\n\t\taccount_status_flag = AccountStatus,\n\t\taccount_expiration_date = ExpirationDate_updated,\n\t\tfirst_txn_date = first_txn_date_updated,\n\t\tdurable_key = Durable_Key_AccountData,\n\t\tload_date = ReportDate,\n\t\tcreate_date = create_date_new,\n\t\tmodified_date = report_date_updated,\n\t\taccount_closed_date = Closed_Date_updated,\n\t\taccount_delinquent_date = Delinquent_Date_updated\n\t)) ~> SnkDimAccount"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimCustomer_FD')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "This is to populate Dim Customer to the Azure DW.",
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "all_stgFDCustomerData",
                                "type": "DatasetReference"
                            },
                            "name": "FDCustomerData"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Customer",
                                "type": "DatasetReference"
                            },
                            "name": "DWdimCustomer"
                        },
                        {
                            "dataset": {
                                "referenceName": "all_stgFDBaseData",
                                "type": "DatasetReference"
                            },
                            "name": "FDBaseData"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Customer",
                                "type": "DatasetReference"
                            },
                            "name": "SnkDimCustomer"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "SelectCustomerAttributes"
                        },
                        {
                            "name": "Dedupe"
                        },
                        {
                            "name": "ConvertDataAndApplyLogic"
                        },
                        {
                            "name": "TrimSpaces"
                        },
                        {
                            "name": "CreateHashkeys"
                        },
                        {
                            "name": "SelectCustomers"
                        },
                        {
                            "name": "UpdateAttributes"
                        },
                        {
                            "name": "BaseDataGetCardStatus"
                        },
                        {
                            "name": "TrimBaseData"
                        },
                        {
                            "name": "LookupCardStatusBaseData"
                        },
                        {
                            "name": "SortBeforeInsert"
                        },
                        {
                            "name": "JoinDW"
                        },
                        {
                            "name": "Upsert"
                        }
                    ],
                    "script": "source(output(\n\t\tCustomerDataID as string,\n\t\t{      CHD_ACCOUNT_NUMBER} as string,\n\t\t{      CHD_PRINCIPAL_NAME} as string,\n\t\t{      CHD_SPOUSE_NAME} as string,\n\t\t{      CHD_ADDR_LINE_1} as string,\n\t\t{      CHD_ADDR_LINE_2} as string,\n\t\t{      CHD_CITY} as string,\n\t\t{      CHD_STATE} as string,\n\t\t{      CHD_NUMERIC_STATE} as string,\n\t\t{      CHD_DELIVERY_POINT} as string,\n\t\t{      CHD_PD_PREFIX} as string,\n\t\t{      CHD_PD_SUFFIX} as string,\n\t\t{      CHD_PD_ADDRESS_FORMAT} as string,\n\t\t{      CHD_PD_ADDR_LINE_3} as string,\n\t\t{      CHD_PD_COUNTY} as string,\n\t\t{      CHD_PD_POSTCODE} as string,\n\t\t{      CHD_SD_PREFIX} as string,\n\t\t{      CHD_SD_SUFFIX} as string,\n\t\t{      CHD_SEX_CODE} as string,\n\t\t{      CHD_SOC_SECURITY_NO} as string,\n\t\t{      CHD_TELEPHONE_NUMBER} as string,\n\t\t{      CHD_SECOND_TELEPHONE_NUMBER} as string,\n\t\t{      CHD_HOME_PHONE_FORMAT} as string,\n\t\t{      CHD_BUS_PHONE_FORMAT} as string,\n\t\t{      CHD_MOTHERS_MAIDEN_NAME} as string,\n\t\t{      CHD_SECONDARY_SOC_SEC_NO} as string,\n\t\t{      CHD_DATE_LAST_ADDR_CHANGE} as string,\n\t\t{      CHD_NAME_ADDR_CHG} as string,\n\t\t{      CHD_ADDRESS_FLAG} as string,\n\t\t{      CHD_HOME_PHONE_FLAG} as string,\n\t\t{      CHD_BUSINESS_PHONE_FLAG} as string,\n\t\t{      CHD_DECEASED_FLAG} as string,\n\t\t{      CHD_SOLICITATION_FLAG} as string,\n\t\t{      CHD_EMPL_ACCT_CD} as string,\n\t\t{      CHD_ALT_CUSTOMER_NO} as string,\n\t\t{      CHD_DATE_OF_BIRTH} as string,\n\t\t{      CHD_SECONDARY_DATE_OF_BIRTH} as string,\n\t\t{      FDR_Date_Processed} as string,\n\t\t{      ExtractDate} as string,\n\t\t{      DateProcessed} as string,\n\t\t{      ReportDate} as string,\n\t\t{      CHD_FIXD_MPD_USAG_CD} as string,\n\t\t{      CHD_MPW_APR_OVRR_USAG_CD} as string,\n\t\t{      CHD_MPW_APR_OVRR_USAG_DT} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM1} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT1} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM2} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT2} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM3} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT3} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_AM4} as string,\n\t\t{      CHD_FIXD_MPD_OVRR_DT4} as string,\n\t\t{      CHD_TSM_PRTC_IN} as string,\n\t\t{      CHD_ZIP_CODE} as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> FDCustomerData\nsource(output(\n\t\tcustomer_key as string,\n\t\tsource_system_key as integer,\n\t\tcardholder_first_name as string,\n\t\tcardholder_middle_initial as string,\n\t\tcardholder_greeting_name as string,\n\t\tcardholder_last_name as string,\n\t\tdate_of_birth as date,\n\t\tnational_identifier as string,\n\t\tcard_status as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select * from member.dim_customer where source_system_key = 2',\n\tformat: 'query',\n\tstaged: false,\n\tpartitionColumn: 'customer_key',\n\tpartitionBy('external', 5)) ~> DWdimCustomer\nsource(output(\n\t\tBaseDataID as integer,\n\t\tCHD_NEW_FILE_TYPE as string,\n\t\tCHD_RECORD_FORMAT as short,\n\t\tCHD_BRANCH_NO as string,\n\t\tCHD_CLIENT_NUMBER as short,\n\t\tCHD_SYSTEM_NO as short,\n\t\tCHD_PRIN_BANK as short,\n\t\tCHD_AGENT_BANK as short,\n\t\tCHD_ACCOUNT_NUMBER as string,\n\t\tCHD_EXTERNAL_STATUS as string,\n\t\tCHD_INTERNAL_STATUS as string,\n\t\tCHD_PREV_EXT_STATUS as string,\n\t\tCHD_CYCLE_CODE_99 as short,\n\t\tCHD_DATE_LAST_NONMON as integer,\n\t\tCHD_PREVIOUS_CYCLE_CODE_99 as short,\n\t\tCHD_CHARGE_DDA_CODE as string,\n\t\tCHD_TRANSIT_ROUTING_NO as integer,\n\t\tCHD_CHECKING_ACCT_NO as string,\n\t\tCHD_SAVINGS_ACCT_NO as integer,\n\t\tCHD_SEC_CODE_NUM_1 as integer,\n\t\tCHD_SEC_CODE_NUM_2 as integer,\n\t\tCHD_PIN_TRANSFER_FLAG as boolean,\n\t\tCHD_ANN_RATE_CASH as double,\n\t\tCHD_ANN_RATE_MRCH as double,\n\t\tCHD_OLD_ANN_RATE as boolean,\n\t\tCHD_OLD_ANN_RATE_CASH as boolean,\n\t\tCHD_ANN_RATE_CASH_MAX as short,\n\t\tCHD_ANN_RATE_MRCH_MAX as short,\n\t\tCHD_ANN_RATE_MRCH_FUTURE as boolean,\n\t\tCHD_ANN_RATE_CASH_FUTURE as boolean,\n\t\tCHD_MONTHLY_RATE_CASH as double,\n\t\tCHD_DAILY_RATE_CASH as double,\n\t\tCHD_MONTHLY_RATE as double,\n\t\tCHD_DAILY_RATE_MRCH as double,\n\t\tCHD_ANN_RATE_CRDINT as boolean,\n\t\tCHD_MONTHLY_RATE_CRDINT as boolean,\n\t\tCHD_DAILY_RATE_CRDINT as boolean,\n\t\tCHD_MTH_RATE_CASH_MAX as double,\n\t\tCHD_MTH_RATE_MRCH_MAX as double,\n\t\tCHD_ANN_RATE_CASH_MIN as boolean,\n\t\tCHD_ANN_RATE_MRCH_MIN as boolean,\n\t\tCHD_MTH_RATE_CASH_MIN as boolean,\n\t\tCHD_MTH_RATE_MRCH_MIN as boolean,\n\t\tCHD_BEHAVIOR_SCORE as boolean,\n\t\tCHD_PREV_BHVR_SCORE as boolean,\n\t\tCHD_CR_SCORE_DATE as short,\n\t\tCHD_CREDIT_SCORE as string,\n\t\tCHD_COLLECTION_CODE as short,\n\t\tCHD_COFF_REASON_CODE as short,\n\t\tCHD_RECOURSE_FLAG as boolean,\n\t\tCHD_RECOURSE_MERCHANT as boolean,\n\t\tCHD_WB_TRAN_TYPE as string,\n\t\tCHD_WB_PURGE_DATE as boolean,\n\t\tCHD_CREDIT_BUREAU_FLAG as string,\n\t\tCHD_COLL_PROC_FLAG as boolean,\n\t\tCHD_RECOVERY_IND as string,\n\t\tCHD_RENEWAL_CODE as short,\n\t\tCHD_NO_PLASTICS as short,\n\t\tCHD_TYPE_PLASTIC as boolean,\n\t\tCHD_SPOUSE_TYPE_PLASTIC as string,\n\t\tCHD_DUAL_TYPE_PLASTIC as string,\n\t\tCHD_DUAL_SPOUSE_TYPE_PLASTIC as string,\n\t\tCHD_NEWCARD_FLAG as string,\n\t\tCHD_ANNUAL_CHARGE_FLAG as boolean,\n\t\tCHD_ANNUAL_CHG_DATE as boolean,\n\t\tCHD_MAIL_CODE as short,\n\t\tCHD_MAIL_CODE_FLAG as boolean,\n\t\tCHD_OPEN_DATE as integer,\n\t\tCHD_MEMBER_SINCE_DATE as short,\n\t\tCHD_EXPIRATION_DATE as integer,\n\t\tCHD_REISSUE_CONTROL as short,\n\t\tCHD_DATE_LAST_PLASTIC as integer,\n\t\tCHD_SMRT_CARD_ICC_CD as string,\n\t\tCHD_CREDIT_LINE as short,\n\t\tCHD_TYPE_CRED_LINE_CHG as string,\n\t\tCHD_CR_LINE_DATE as short,\n\t\tCHD_DATE_LAST_REVIEW as short,\n\t\tCHD_DATE_NEXT_REVIEW as boolean,\n\t\tCHD_CUST_FLG_1 as string,\n\t\tCHD_CUST_FLG_2 as string,\n\t\tCHD_CUST_FLG_3 as string,\n\t\tCHD_CUST_FLG_4 as string,\n\t\tCHD_SC_1 as string,\n\t\tCHD_SC_2 as string,\n\t\tCHD_SC_3 as string,\n\t\tCHD_SC_4 as string,\n\t\tCHD_SC_5 as string,\n\t\tCHD_SC_6 as string,\n\t\tCHD_SC_7 as string,\n\t\tCHD_SC_8 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_1 as short,\n\t\tCHD_MISCELLANEOUS_FIELD_2 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_3 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_4 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_5 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_6 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_7 as string,\n\t\tCHD_MISCELLANEOUS_FIELD_8 as string,\n\t\tCHD_MISC_FIELD_9 as string,\n\t\tCHD_MISC_FIELD_10 as string,\n\t\tCHD_MISC_FIELD_11_TX as string,\n\t\tCHD_MISC_FIELD_12_TX as string,\n\t\tCHD_CROSS_REFERENCE_ACCT_NO as double,\n\t\tCHD_NEW_XREF_NO_1 as boolean,\n\t\tCHD_NEW_XREF_NO_2 as double,\n\t\tCHD_CUST_XREF_ID as string,\n\t\tCHD_CR_LIFE_STAT_DATE as boolean,\n\t\tCHD_CR_LIFE_PAID_AMT as boolean,\n\t\tCHD_LS_TERMS_FLAG as short,\n\t\tCHD_CTD_TERMS_FLAG as short,\n\t\tCHD_TERMS_DATE as boolean,\n\t\tCHD_TRANSFER_FLAG as boolean,\n\t\tCHD_DATE_LOST_STOLEN as integer,\n\t\tCHD_ACCT_TRANSFER as string,\n\t\tCHD_ACCT_XFOOT as string,\n\t\tCHD_STMT_FEE_FLAG as boolean,\n\t\tCHD_FIXED_PAYMENT_AMT as boolean,\n\t\tCHD_CASH_FIXED_PAYMENT as boolean,\n\t\tCHD_ANN_ACTIVITY_SUMM_FLAG as boolean,\n\t\tCHD_90_DAY_FLAG as boolean,\n\t\tCHD_DEFER_PAY_FLAG as boolean,\n\t\tCHD_PAY_AHEAD_FLAG as boolean,\n\t\tCHD_CREDIT_LIFE_FLAG_N as boolean,\n\t\tCHD_MAX_REBATE_AMT as boolean,\n\t\tCHD_DELETE_FLAG as string,\n\t\tCHD_DUALITY_FLAG as boolean,\n\t\tCHD_TYPE_LAST_NONMON as short,\n\t\tCHD_SPEC_STMT_FLAG as short,\n\t\tCHD_AUTOPAY_SKIP_FLAG as boolean,\n\t\tCHD_GROSS_ACTIVE as string,\n\t\tCHD_DEBIT_ACTIVE as string,\n\t\tCHD_BASIC_ACTIVE as string,\n\t\tCHD_AUTH_FLAG as string,\n\t\tCHD_INTEREST_SWITCH as string,\n\t\tCHD_STMT_HOLD_FLAG as string,\n\t\tCHD_MULTRAN_FLAG as boolean,\n\t\tCHD_CR_LIFE_STATUS as string,\n\t\tCHD_CB_SCORE as boolean,\n\t\tCHD_CB_ID as string,\n\t\tCHD_CB_CODE as string,\n\t\tCHD_CB_ATTR1 as string,\n\t\tCHD_CB_ATTR2 as string,\n\t\tCHD_CB_ATTR3 as string,\n\t\tCHD_CB_SCORE_DATE as boolean,\n\t\tCHD_CB_REASON1 as string,\n\t\tCHD_CB_REASON2 as string,\n\t\tCHD_CB_REASON3 as string,\n\t\tCHD_CB_REASON4 as string,\n\t\tCHD_MO_CHARGE_INT_ONLY as boolean,\n\t\tCHD_DATE_STATUS_CHG as integer,\n\t\tCHD_RISK_PREDICTOR_SCORE as boolean,\n\t\tCHD_RISK_PREDICTOR_BUREAU as string,\n\t\tCHD_RISK_PREDICTOR_MODEL as string,\n\t\tCHD_VISA_REGION as string,\n\t\tCHD_MC_REGION as string,\n\t\tCHD_ACCT_TRANSFER_DATE as short,\n\t\tCHD_ACCT_TRANSFER_FLAG as string,\n\t\tCHD_CASH_CREDIT_LINE_CHG_DT as boolean,\n\t\tCHD_CASH_CREDIT_LINE_CHG_TYP as string,\n\t\tCHD_ADD_ON_RATE_FLAG as boolean,\n\t\tCHD_CURR_PRICING_PORTFOLIO as short,\n\t\tCHD_CURR_PRICING_STRATEGY as string,\n\t\tCHD_CURR_PRICE_STRATEGY_DATE as integer,\n\t\tCHD_CURR_STRAT_CYCLE_FLAG as string,\n\t\tCHD_LS_PRCN_PORT_ID as short,\n\t\tCHD_OLD_NEXT_PRICING_STRATEGY as string,\n\t\tCHD_NEXT_PRICE_STRATEGY_DATE as boolean,\n\t\tCHD_OLD_NEXT_STRAT_CYCLE_FLAG as string,\n\t\tCHD_OLD_NEXT_STRT_STAGE_REASO as string,\n\t\tCHD_LS_PRICING_STRATEGY as string,\n\t\tCHD_LAST_STRATEGY_CHANGE_DATE as integer,\n\t\tCHD_PROCESSING_LEVEL as string,\n\t\tCHD_UD_SOURCE_CODE as string,\n\t\tCHD_UD_APPROVAL_OFFICER_CODE as boolean,\n\t\tCHD_FRAUD_PORT_ID as short,\n\t\tCHD_FRAUD_ASSG_STRATEGY as short,\n\t\tCHD_FRAUD_STRAT_CHANGE_DATE as integer,\n\t\tCHD_FRAUD_SUSPEND_STRATEGY as short,\n\t\tCHD_FRAUD_SUSP_STRATEGY_DATE as integer,\n\t\tCHD_LAST_PLASTIC_SOURCE as short,\n\t\tCHD_FRAUD_SCORE_CHANGE_DATE as integer,\n\t\tCHD_FRAUD_SCORE as boolean,\n\t\tCHD_DATE_LAST_ACL_LTR as boolean,\n\t\tCHD_DISCOUNT_CODE as string,\n\t\tCHD_NO_MAIL_FLAG as boolean,\n\t\tCHD_PRICING_STRATEGY_STATUS as string,\n\t\tCHD_BONUS_STRATEGY as string,\n\t\tCHD_LS_BONUS_STRATEGY as string,\n\t\tCHD_LAST_ANNUAL_CHARGE_FLAG as string,\n\t\tCHD_HIGH_BAL_LIFE as double,\n\t\tCHD_MIN_DAYS_DELQ_NR as boolean,\n\t\tCHD_ACS_CLNT_ID as short,\n\t\tCHD_PREV_INTERNAL_STATUS as string,\n\t\tCHD_DATE_IN_COLLECTION as boolean,\n\t\tCHD_START_DATE_OF_DELQ as integer,\n\t\tCHD_PRIMARY_PEF as string,\n\t\tCHD_SECONDARY_PEF as string,\n\t\tCHD_COV_STRATEGY_ID as string,\n\t\tCHD_BS_REASON_CODE_1 as boolean,\n\t\tCHD_BS_REASON_CODE_2 as boolean,\n\t\tCHD_BS_REASON_CODE_3 as boolean,\n\t\tCHD_BS_REASON_CODE_4 as boolean,\n\t\tCHD_REQ_CLOSED_DATE as integer,\n\t\tCHD_PREV_CRLINE_CHANGE_DATE as short,\n\t\tCHD_CRLINE_CHANGE_AMT as short,\n\t\tCHD_CASH_CRDT_LINE_AM as double,\n\t\tCHD_CASH_LINE_REVW_DT as integer,\n\t\tCHD_TLP_CLT_ID as string,\n\t\tCHD_TLP_CLT_EXPR_DT as boolean,\n\t\tCHD_ACCT_CT as short,\n\t\tCHD_CRRN_ANNL_CASH_RT as double,\n\t\tCHD_CRRN_ANNL_MRCH_RT as double,\n\t\tCHD_HIGH_NOM_MRCH_APPLIED_RT as boolean,\n\t\tCHD_LOW_NOM_MRCH_APPLIED_RT as double,\n\t\tCHD_HIGH_NOM_CASH_APPLIED_RT as boolean,\n\t\tCHD_LOW_NOM_CASH_APPLIED_RT as double,\n\t\tCHD_EQTY_ACCT_MTRT_DT as boolean,\n\t\tCHD_SUB_ACCT_CD as string,\n\t\tCHD_CMPN_ID as string,\n\t\tCHD_ACCT_MRKT_STRT_NM as string,\n\t\tCHD_ACCT_MRKT_PRCS_CD as string,\n\t\tCHD_ACCT_MRKT_STRT_DT as date,\n\t\tCHD_REIS_STRT_NM as string,\n\t\tCHD_REIS_PRCS_CD as string,\n\t\tCHD_REIS_STRT_DT as date,\n\t\tCHD_ACCT_GROP_ID as string,\n\t\tCHD_PYMN_DUE_DT as date,\n\t\tCHD_NEWCRD_FLAG_RETN_DT as boolean,\n\t\tCHD_NEXT_CYCL_DT as date,\n\t\tCHD_LAST_MON_TRAN_CD as short,\n\t\tCHD_DALY_INTR_CALC_MTHD_CD as boolean,\n\t\tCHD_CR_LIFE_STATUS_DT as boolean,\n\t\tCHD_LAST_LTTR_ID as string,\n\t\tCHD_LAST_LTTR_DT as date,\n\t\tCHD_AVLB_CRDT_AMT as double,\n\t\tCHD_CALC_NORM_CASH_RT as double,\n\t\tCHD_CALC_NORM_MRCH_RT as double,\n\t\tCHD_CALC_NORM_CASH_MNTH_RT as double,\n\t\tCHD_CALC_NORM_MRCH_MNTH_RT as double,\n\t\tCHD_CALC_NORM_CASH_ANN_RT as double,\n\t\tCHD_CALC_NORM_MRCH_ANN_RT as double,\n\t\tCHD_PAYMENT_DUE_DAYS_NR as short,\n\t\tCHD_MISC_13_PSTN_1_10_TX as string,\n\t\tCHD_MISC_13_PSTN_11_15_TX as string,\n\t\tCHD_MISC_13_PSTN_16_20_TX as string,\n\t\tCHD_MISC_13_PSTN_21_25_TX as string,\n\t\tCHD_MISC_13_PSTN_26_TX as string,\n\t\tCHD_MISC_13_PSTN_27_TX as string,\n\t\tCHD_MISC_13_PSTN_28_TX as string,\n\t\tCHD_MISC_13_PSTN_29_TX as string,\n\t\tCHD_MISC_13_PSTN_30_TX as string,\n\t\tCHD_MISC_13_PSTN_31_TX as string,\n\t\tCHD_MISC_13_PSTN_32_TX as string,\n\t\tCHD_MISC_13_PSTN_33_TX as string,\n\t\tCHD_MISC_13_PSTN_34_TX as string,\n\t\tCHD_MISC_13_PSTN_35_TX as string,\n\t\tCHD_MISC_13_PSTN_36_TX as string,\n\t\tCHD_MISC_13_PSTN_37_TX as string,\n\t\tCHD_MISC_13_PSTN_38_TX as string,\n\t\tCHD_MISC_13_PSTN_39_TX as string,\n\t\tCHD_MISC_13_PSTN_40_TX as string,\n\t\tCHD_MISC_13_PSTN_41_TX as string,\n\t\tCHD_MISC_13_PSTN_42_TX as string,\n\t\tCHD_MISC_13_PSTN_43_TX as string,\n\t\tCHD_MISC_13_PSTN_44_TX as string,\n\t\tCHD_MISC_13_PSTN_45_TX as string,\n\t\tCHD_MISC_13_PSTN_46_TX as string,\n\t\tCHD_MISC_13_PSTN_47_TX as string,\n\t\tCHD_MISC_13_PSTN_48_TX as string,\n\t\tCHD_MISC_13_PSTN_49_TX as string,\n\t\tCHD_MISC_13_PSTN_50_TX as string,\n\t\tCHD_BHVR_SCOR_DT as integer,\n\t\tCHD_DBT_ACTV_ID as short,\n\t\tCHD_CRDT_LINE_CHNG_DT as date,\n\t\tCHD_PREV_CRDT_LINE_CHNG_DT as integer,\n\t\tCHD_CRDT_BUR_BKCY_DT as integer,\n\t\tRoutingTransit as string,\n\t\tFDR_Date_Processed as date,\n\t\tExtractDate as string,\n\t\tDateProcessed as string,\n\t\tCHDHD_1098_YTD_INTR_THRD_AM as boolean,\n\t\tCHDHD_1098_YTD_INTR_TOTL_AM as boolean,\n\t\tCHDHD_1098_PREV_INTR_THRD_AM as boolean,\n\t\tCHDHD_1098_PREV_INTR_TOTL_AM as boolean,\n\t\tSysPrinAgent as double,\n\t\tCHD_AVOD_FINC_CHRG_AM as double,\n\t\tCHD_LFTM_CASH_AND_MRCH_AM as double,\n\t\tCHD_RECOVERY_CD as boolean,\n\t\tReportDate as date,\n\t\tCHD_AUTO_PAY_PNDG_IN as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> FDBaseData\nFDCustomerData select(mapColumn(\n\t\tCardholderFirstName = {      CHD_PRINCIPAL_NAME},\n\t\tCardholderLastName = {      CHD_PRINCIPAL_NAME},\n\t\tGreetingName = {      CHD_PRINCIPAL_NAME},\n\t\tAccountNumber = {      CHD_ACCOUNT_NUMBER},\n\t\tBirthDate = {      CHD_DATE_OF_BIRTH},\n\t\tNationalIdentifier = {      CHD_SOC_SECURITY_NO},\n\t\tReportDate = {      ReportDate}\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectCustomerAttributes\nCreateHashkeys aggregate(groupBy(CustomerHashkey,\n\t\tLower_CardHolderFirstName,\n\t\tLower_CardHolderMiddleInitial,\n\t\tLower_CardHolderLastName,\n\t\tLower_GreetingName,\n\t\tsource_system_key_CustomerData),\n\tCardStatus = case(min(CardStatus)==0,'Non-Statused','Statused'),\n\t\tBirthDate = max(BirthDate),\n\t\tNationalIdentifier = max(NationalIdentifier),\n\t\tReportDate = max(ReportDate)) ~> Dedupe\nLookupCardStatusBaseData derive(Lower_CardHolderFirstName = lower(substring(trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName)))\r\n,1,iif(locate(' ',trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName))))==0,100,locate(' ',trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName))))))),\n\t\tLower_CardHolderMiddleInitial = lower(substring(trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName)))\r\n,iif(locate(' ',trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName))))==0,100,locate(' ',trim(substring(CardholderFirstName,(locate(',',CardholderFirstName)+1), length(CardholderFirstName))))+1),1)),\n\t\tLower_CardHolderLastName = lower(left(CardholderLastName,\r\n(locate(',',CardholderLastName)-1))),\n\t\tLower_GreetingName = lower(GreetingName),\n\t\tCardStatus = toInteger(\r\ncase(\r\nCHD_EXTERNAL_STATUS == 'A'\r\n||CHD_EXTERNAL_STATUS ==' '\r\n||CHD_EXTERNAL_STATUS ==''\r\n||isNull(CHD_EXTERNAL_STATUS)\r\n, '1'\r\n, '0')),\n\t\tBirthDate = toDate(BirthDate,'yyyyMMdd'),\n\t\tsource_system_key_CustomerData = 2,\n\t\tReportDate = toDate(ReportDate,'yyyy-MM-dd')) ~> ConvertDataAndApplyLogic\nSelectCustomerAttributes derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimSpaces\nSelectCustomers derive(CustomerHashkey = md5(iif(isNull(Lower_CardHolderFirstName),'',Lower_CardHolderFirstName)\r\n, iif(isNull(Lower_CardHolderMiddleInitial),'',Lower_CardHolderMiddleInitial)\r\n, iif(isNull(Lower_CardHolderLastName),'',Lower_CardHolderLastName)\r\n, iif(isNull(Lower_GreetingName),'',Lower_GreetingName)\r\n, iif(isNull(source_system_key_CustomerData),0,source_system_key_CustomerData))) ~> CreateHashkeys\nConvertDataAndApplyLogic select(mapColumn(\n\t\tCardStatus,\n\t\tReportDate,\n\t\tLower_CardHolderFirstName,\n\t\tLower_CardHolderMiddleInitial,\n\t\tLower_CardHolderLastName,\n\t\tLower_GreetingName,\n\t\tBirthDate,\n\t\tNationalIdentifier,\n\t\tsource_system_key_CustomerData\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCustomers\nJoinDW derive(Title_CardHolderFirstName = initCap(Lower_CardHolderFirstName),\n\t\tTitle_CardHolderMiddleInitial = initCap(Lower_CardHolderMiddleInitial),\n\t\tTitle_CardHolderLastName = initCap(Lower_CardHolderLastName),\n\t\tTitle_GreetingName = initCap(Lower_GreetingName),\n\t\tcard_status_updated = coalesce(CardStatus,card_status),\n\t\tbirth_date_updated = coalesce(BirthDate,date_of_birth),\n\t\tnational_identifier_updated = coalesce(NationalIdentifier,national_identifier),\n\t\tload_date_updated = coalesce(load_date,ReportDate),\n\t\tcreate_date_updated = coalesce(create_date,currentTimestamp()),\n\t\tmodified_date = toTimestamp(ReportDate)) ~> UpdateAttributes\nFDBaseData select(mapColumn(\n\t\tCHD_ACCOUNT_NUMBER,\n\t\tCHD_EXTERNAL_STATUS\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> BaseDataGetCardStatus\nBaseDataGetCardStatus derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> TrimBaseData\nTrimSpaces, TrimBaseData join(AccountNumber == CHD_ACCOUNT_NUMBER,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> LookupCardStatusBaseData\nUpsert sort(asc(CustomerHashkey, true),\n\tpartitionLevel: true) ~> SortBeforeInsert\nDedupe, DWdimCustomer join(CustomerHashkey == customer_key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> JoinDW\nUpdateAttributes alterRow(upsertIf(true())) ~> Upsert\nSortBeforeInsert sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tcustomer_key as string,\n\t\tsource_system_key as integer,\n\t\tcardholder_first_name as string,\n\t\tcardholder_middle_initial as string,\n\t\tcardholder_greeting_name as string,\n\t\tcardholder_last_name as string,\n\t\tdate_of_birth as date,\n\t\tnational_identifier as string,\n\t\tcard_status as string,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['customer_key'],\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tcustomer_key = CustomerHashkey,\n\t\tsource_system_key = source_system_key_CustomerData,\n\t\tcardholder_first_name = Title_CardHolderFirstName,\n\t\tcardholder_middle_initial = Title_CardHolderMiddleInitial,\n\t\tcardholder_greeting_name = Title_GreetingName,\n\t\tcardholder_last_name = Title_CardHolderLastName,\n\t\tcard_status = card_status_updated,\n\t\tdate_of_birth = birth_date_updated,\n\t\tnational_identifier = national_identifier_updated,\n\t\tload_date = load_date_updated,\n\t\tcreate_date = create_date_updated,\n\t\tmodified_date\n\t)) ~> SnkDimCustomer"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/Update_SemAccountAnalysisDaily')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "this dataflow will be used to keep AccountAnalysis Table in the semantic layer up to date as new transactions come in.",
                "folder": {
                    "name": "Reference"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily_staging",
                                "type": "DatasetReference"
                            },
                            "name": "FirstTxnDate"
                        },
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily",
                                "type": "DatasetReference"
                            },
                            "name": "srcAccountAnalysisDaily"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily",
                                "type": "DatasetReference"
                            },
                            "name": "snkAccountAnalysisDaily"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "CompareTxnDateAndActivationFlg"
                        },
                        {
                            "name": "SelectUpdates"
                        },
                        {
                            "name": "LookupSemAccountAnalysisDaily"
                        },
                        {
                            "name": "AlterRow1"
                        }
                    ],
                    "script": "source(output(\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> FirstTxnDate\nsource(output(\n\t\taccount_analysis_key as long,\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> srcAccountAnalysisDaily\nLookupSemAccountAnalysisDaily filter((\r\n  ((first_txn_date_update != toDate('1900-01-01')) && (first_txn_date > first_txn_date_update ))\r\n|| (account_activation_flag_update == 1 && account_activation_flag==0)\r\n )) ~> CompareTxnDateAndActivationFlg\nFirstTxnDate select(mapColumn(\n\t\tdate_update = date,\n\t\tbinnumber_update = binnumber,\n\t\tbin_type_update = bin_type,\n\t\tnetwork_cd_update = network_cd,\n\t\tclient_id_update = client_id,\n\t\tclient_name_update = client_name,\n\t\taccount_number_update = account_number,\n\t\tsource_system_key_update = source_system_key,\n\t\tissue_date_update = issue_date,\n\t\tactivation_Date_update = activation_Date,\n\t\texpiration_date_update = expiration_date,\n\t\tfirst_txn_date_update = first_txn_date,\n\t\taccount_activation_flag_update = account_activation_flag,\n\t\tdays_to_first_usage_update = days_to_first_usage,\n\t\tdays_to_activation_update = days_to_activation,\n\t\tcnt_transactions_update = cnt_transactions,\n\t\tsum_settlement_amount_update = sum_settlement_amount\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectUpdates\nSelectUpdates, srcAccountAnalysisDaily lookup(account_number_update == account_number\n\t&& source_system_key_update == source_system_key,\n\tmultiple: true,\n\tbroadcast: 'auto')~> LookupSemAccountAnalysisDaily\nCompareTxnDateAndActivationFlg alterRow(updateIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\taccount_analysis_key as long,\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['account_number','source_system_key'],\n\tskipKeyWrites:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\taccount_number = account_number_update,\n\t\tsource_system_key = source_system_key_update,\n\t\tfirst_txn_date = first_txn_date_update,\n\t\taccount_activation_flag = account_activation_flag_update,\n\t\tdays_to_first_usage = days_to_first_usage_update\n\t)) ~> snkAccountAnalysisDaily"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/Update_SemAccountAnalysisDaily1')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "this dataflow will be used to keep AccountAnalysis Table in the semantic layer up to date as new transactions come in.",
                "folder": {
                    "name": "Reference"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily_staging2",
                                "type": "DatasetReference"
                            },
                            "name": "FirstTxnDate"
                        },
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily2",
                                "type": "DatasetReference"
                            },
                            "name": "srcAccountAnalysisDaily"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "sem_AccountAnalysis_Daily2",
                                "type": "DatasetReference"
                            },
                            "name": "snkAccountAnalysisDaily"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "CompareTxnDateAndActivationFlg"
                        },
                        {
                            "name": "SelectUpdates"
                        },
                        {
                            "name": "LookupSemAccountAnalysisDaily"
                        },
                        {
                            "name": "AlterRow1"
                        }
                    ],
                    "script": "source(output(\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> FirstTxnDate\nsource(output(\n\t\taccount_analysis_key as long,\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> srcAccountAnalysisDaily\nLookupSemAccountAnalysisDaily filter((\r\n  ((first_txn_date_update != toDate('1900-01-01')) && (first_txn_date > first_txn_date_update ))\r\n|| (account_activation_flag_update == 1 && account_activation_flag==0)\r\n )) ~> CompareTxnDateAndActivationFlg\nFirstTxnDate select(mapColumn(\n\t\tdate_update = date,\n\t\tbinnumber_update = binnumber,\n\t\tbin_type_update = bin_type,\n\t\tnetwork_cd_update = network_cd,\n\t\tclient_id_update = client_id,\n\t\tclient_name_update = client_name,\n\t\taccount_number_update = account_number,\n\t\tsource_system_key_update = source_system_key,\n\t\tissue_date_update = issue_date,\n\t\tactivation_Date_update = activation_Date,\n\t\texpiration_date_update = expiration_date,\n\t\tfirst_txn_date_update = first_txn_date,\n\t\taccount_activation_flag_update = account_activation_flag,\n\t\tdays_to_first_usage_update = days_to_first_usage,\n\t\tdays_to_activation_update = days_to_activation,\n\t\tcnt_transactions_update = cnt_transactions,\n\t\tsum_settlement_amount_update = sum_settlement_amount\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectUpdates\nSelectUpdates, srcAccountAnalysisDaily lookup(account_number_update == account_number\n\t&& source_system_key_update == source_system_key,\n\tmultiple: true,\n\tbroadcast: 'auto')~> LookupSemAccountAnalysisDaily\nCompareTxnDateAndActivationFlg alterRow(updateIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\taccount_analysis_key as long,\n\t\tdate as date,\n\t\tbinnumber as string,\n\t\tbin_type as string,\n\t\tnetwork_cd as string,\n\t\tclient_id as string,\n\t\tclient_name as string,\n\t\taccount_number as string,\n\t\tsource_system_key as integer,\n\t\tissue_date as date,\n\t\tactivation_Date as date,\n\t\texpiration_date as date,\n\t\tfirst_txn_date as date,\n\t\taccount_activation_flag as integer,\n\t\tdays_to_first_usage as integer,\n\t\tdays_to_activation as integer,\n\t\tcnt_transactions as integer,\n\t\tsum_settlement_amount as decimal(19,4)\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['account_number','source_system_key'],\n\tskipKeyWrites:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\taccount_number = account_number_update,\n\t\tsource_system_key = source_system_key_update,\n\t\tfirst_txn_date = first_txn_date_update,\n\t\taccount_activation_flag = account_activation_flag_update,\n\t\tdays_to_first_usage = days_to_first_usage_update\n\t)) ~> snkAccountAnalysisDaily"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_DimAccount_FactTransaction')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "description": "An account may not be in Dim Account at the time a transaction is received for that account. In order for the account to be visible in vw_account_analysis_daily, a entry in dim account is needed. This process will place a default record in the table, so it can be moved to the semantic layer.",
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "fact_Transaction",
                                "type": "DatasetReference"
                            },
                            "name": "QryAccountsFromFactTransaction"
                        },
                        {
                            "dataset": {
                                "referenceName": "dim_Account",
                                "type": "DatasetReference"
                            },
                            "name": "dimAccount"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dim_Account",
                                "type": "DatasetReference"
                            },
                            "name": "snkDimAccount"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "DoesNotExistInTable"
                        },
                        {
                            "name": "CreateAttributesForInsert"
                        },
                        {
                            "name": "CreateHashkeys"
                        }
                    ],
                    "script": "source(output(\n\t\taccount_key as string,\n\t\tft_source_system_key as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tbatchSize: 100000,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select Distinct ft.account_key , ft.source_system_key as ft_source_system_key\\nFrom \\n[transaction].[fact_transaction] ft with (nolock)\\ninner join (Select distinct run_id from  [Audit].[transactions_log]\\nwhere loaded_to_semantic = \\'False\\' and sem_start_date is not NULL) tl  on ft.run_id= tl.run_id',\n\tformat: 'query',\n\tstaged: true) ~> QryAccountsFromFactTransaction\nsource(output(\n\t\taccount_key as string,\n\t\tsource_system_key as integer,\n\t\tbin_key as long,\n\t\tclient_key as long,\n\t\taccount_number as string,\n\t\taccount_issue_date as date,\n\t\taccount_activation_date as date,\n\t\taccount_activation_flag as string,\n\t\taccount_status_flag as string,\n\t\taccount_expiration_date as date,\n\t\tfirst_txn_date as date,\n\t\tdurable_key as integer,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> dimAccount\nQryAccountsFromFactTransaction, dimAccount exists(QryAccountsFromFactTransaction@account_key == account_number\n\t&& ft_source_system_key == source_system_key,\n\tnegate:true,\n\tbroadcast: 'auto')~> DoesNotExistInTable\nDoesNotExistInTable derive(Lower_Account_City = '',\n\t\tLower_Account_State = '',\n\t\tLower_Account_Zip = '',\n\t\tLower_CardholderFirstName = '',\n\t\tLower_CardholderLastName = '',\n\t\tLower_CardholderMiddleInitial = '',\n\t\tLower_GreetingName = '',\n\t\tcreate_date_insert = currentTimestamp(),\n\t\tmodified_date_insert = currentTimestamp()) ~> CreateAttributesForInsert\nCreateAttributesForInsert derive(AccountGeographyHashKey = crc32(iif(isNull(Lower_Account_City),'',Lower_Account_City)\r\n, iif(isNull(Lower_Account_State),'',Lower_Account_State)\r\n, iif(isNull(Lower_Account_Zip),'',Lower_Account_Zip)\r\n, iif(isNull(ft_source_system_key),0,ft_source_system_key)),\n\t\tAccountHashKey = crc32(iif(isNull(account_key),'',account_key)\r\n, iif(isNull(ft_source_system_key),0,ft_source_system_key)),\n\t\tCustomerHashKey = crc32(iif(isNull(Lower_CardholderFirstName),'',Lower_CardholderFirstName)\r\n, iif(isNull(Lower_CardholderMiddleInitial),'',Lower_CardholderMiddleInitial)\r\n, iif(isNull(Lower_CardholderLastName),'',Lower_CardholderLastName)\r\n, iif(isNull(Lower_GreetingName),'',Lower_GreetingName)\r\n, iif(isNull(ft_source_system_key),0,ft_source_system_key))) ~> CreateHashkeys\nCreateHashkeys sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\taccount_key as string,\n\t\tsource_system_key as integer,\n\t\tbin_key as long,\n\t\tclient_key as long,\n\t\taccount_number as string,\n\t\taccount_issue_date as date,\n\t\taccount_activation_date as date,\n\t\taccount_activation_flag as string,\n\t\taccount_status_flag as string,\n\t\taccount_expiration_date as date,\n\t\tfirst_txn_date as date,\n\t\tdurable_key as integer,\n\t\tload_date as date,\n\t\tcreate_date as timestamp,\n\t\tmodified_date as timestamp,\n\t\taccount_closed_date as date,\n\t\taccount_delinquent_date as date\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\taccount_key = AccountHashKey,\n\t\taccount_geography_key = AccountGeographyHashKey,\n\t\tsource_system_key = ft_source_system_key,\n\t\tcustomer_key = CustomerHashKey,\n\t\taccount_number = account_key,\n\t\tcreate_date = create_date_insert,\n\t\tmodified_date = modified_date_insert\n\t)) ~> snkDimAccount"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/update_DD553')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Dimensions"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_cnfm_All",
                                "type": "DatasetReference"
                            },
                            "name": "Transactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_rawDD553_All",
                                "type": "DatasetReference"
                            },
                            "name": "DD553"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "snk_cnfmTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "sink1"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "LimitTransactions"
                        },
                        {
                            "name": "LimitDD553"
                        },
                        {
                            "name": "ModifyColumns",
                            "description": "Autogenerated by data preview actions"
                        },
                        {
                            "name": "Join1"
                        }
                    ],
                    "script": "parameters{\n\tfile_name as string ('DD553')\n}\nsource(output(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string,\n\t\tAgentNo as string,\n\t\tAgentBank as string,\n\t\tSystemNo as string,\n\t\tTransaction_Key as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['Transactions/2019/12/25/*']) ~> Transactions\nsource(output(\n\t\tREPORTDATE as date,\n\t\tCREDITUNION as short,\n\t\tSYS as short,\n\t\tPRINTBANK as short,\n\t\tMERCHAGENT as short,\n\t\tENTEREDID as long,\n\t\tTRANDT as date,\n\t\tTRANSACTIONAMT as double,\n\t\tTRNCUR as short,\n\t\tBINNO as integer,\n\t\tMERCHANTACCTNO as long,\n\t\tMCC as short,\n\t\tACQRFRDABA as integer,\n\t\tATERMID as string,\n\t\t{TERMSEQ#} as integer,\n\t\tFDRTRANSACTIONID as long,\n\t\tTRANTM as string,\n\t\tSETTLEMENTAMT as double,\n\t\tSTLCURR as short,\n\t\tMERCHNAME as string,\n\t\tANID as string,\n\t\tISSRFDRABA as string,\n\t\tSTERMID as string,\n\t\t{SWTCSEQ#} as string,\n\t\tRETRIEVALREFNO as integer,\n\t\tSTLDT as string,\n\t\tSURCHARGEAM as string,\n\t\tSTLCNVR as double,\n\t\tMERCHANTADDRESS as string,\n\t\tINIDID as string,\n\t\tPOSEM as string,\n\t\tPRCSRID as string,\n\t\tPOSCDNCD as integer,\n\t\tFROMACCOUNT as string,\n\t\tFROMACCOUNTTYPE as integer,\n\t\tMSSGCOD as integer,\n\t\tPRCSCOD as integer,\n\t\tAUTHCOD as integer,\n\t\tMERCHANTCITY as string,\n\t\tST as string,\n\t\tADJTRANAMT as string,\n\t\tPVR as string,\n\t\tADJTRNFEE as boolean,\n\t\tTOACCOUNT as string,\n\t\tTOACCOUNTTYPE as short,\n\t\t{AR/CD} as short,\n\t\tLINEID as string,\n\t\tFDRTRACENO as long,\n\t\tADJSTLAMT as string,\n\t\tPTRAN as string,\n\t\tADJSTLFEE as boolean,\n\t\t{ADDTAMT(1)} as double,\n\t\t{ADDTAMT(2)} as boolean,\n\t\t{ADDTAMT(3)} as boolean,\n\t\t{ADDTAMT(4)} as boolean,\n\t\t{ADDTAMT(5)} as boolean,\n\t\t{ADDTAMT(6)} as boolean,\n\t\tLOGTM as string,\n\t\tSYSTM as string,\n\t\t{ADDTAMTXT(1)} as string,\n\t\t{ADDTAMTXT(2)} as string,\n\t\t{ADDTAMTXT(3)} as string,\n\t\t{ADDTAMTXT(4)} as string,\n\t\t{ADDTAMTXT(5)} as string,\n\t\t{ADDTAMTXT(6)} as string,\n\t\tLOGDT as date,\n\t\tEXPDT as string,\n\t\tSETTLFEEAMT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\twildcardPaths:['Fiserv/DD553/Current/*']) ~> DD553\nTransactions select(mapColumn(\n\t\tAccountNumber,\n\t\tOriginDate,\n\t\tSettlementAmount,\n\t\tAgentNo,\n\t\tAgentBank,\n\t\tSystemNo,\n\t\tTransaction_Key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LimitTransactions\nDD553 select(mapColumn(\n\t\tSYS,\n\t\tPRN = PRINTBANK,\n\t\tAGT = MERCHAGENT,\n\t\tID = ENTEREDID,\n\t\tTRANDT,\n\t\tTRANAMT = TRANSACTIONAMT\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LimitDD553\nLimitDD553 derive(ID = toString(ID),\n\t\tSYS = toString(SYS),\n\t\tPRN = toString(PRN),\n\t\tAGT = lpad(toString(AGT),4,'0')) ~> ModifyColumns\nLimitTransactions, ModifyColumns join(AccountNumber == ID,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string\n\t),\n\tformat: 'parquet',\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/FDTransactions_testing')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "FirstData"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "dropZoneTransactions_FD",
                                "type": "DatasetReference"
                            },
                            "name": "MonetaryDetailTransactions"
                        },
                        {
                            "dataset": {
                                "referenceName": "CCUMSTR",
                                "type": "DatasetReference"
                            },
                            "name": "CCUMSTR"
                        },
                        {
                            "dataset": {
                                "referenceName": "FDTransactionCriteria",
                                "type": "DatasetReference"
                            },
                            "name": "FDCriteria"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_rawDD553_All",
                                "type": "DatasetReference"
                            },
                            "name": "source1"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "snk_cnfmFISTransactions",
                                "type": "DatasetReference"
                            },
                            "name": "sink1"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "MappingTransformation"
                        },
                        {
                            "name": "DerivedColumn1"
                        },
                        {
                            "name": "Filter1"
                        },
                        {
                            "name": "Join1"
                        },
                        {
                            "name": "Join2"
                        },
                        {
                            "name": "Filter"
                        },
                        {
                            "name": "DerivedColumn2"
                        },
                        {
                            "name": "Select1"
                        },
                        {
                            "name": "Select2"
                        },
                        {
                            "name": "DerivedColumn3"
                        },
                        {
                            "name": "HashKey"
                        },
                        {
                            "name": "Select3"
                        },
                        {
                            "name": "Filter3"
                        },
                        {
                            "name": "Aggregate1"
                        },
                        {
                            "name": "Select4"
                        },
                        {
                            "name": "ModifyColumns1",
                            "description": "Autogenerated by data preview actions"
                        },
                        {
                            "name": "Join3"
                        },
                        {
                            "name": "Filter4"
                        }
                    ],
                    "script": "parameters{\n\tfileName as string\n}\nsource(output(\n\t\tTransactions_ID as string,\n\t\tReportDate as string,\n\t\tCreditUnion as string,\n\t\tRDT_CHD_ACCOUNT_NUMBER as string,\n\t\tRDT_ENTRY_TYPE as string,\n\t\tRDT_ENTRY_SYS_4 as string,\n\t\tRDT_ENTRY_SYS_2 as string,\n\t\tRDT_ENTRY_DATE as string,\n\t\tRDT_ENTRY_2 as string,\n\t\tRDT_ENTRY_LAST_6 as string,\n\t\tRDT_RUN_SEQ_NO as string,\n\t\tRTI_REG_INDUSTRY_TRAN_ID as string,\n\t\tRDT_TRANSACTION_AMOUNT as string,\n\t\tRDT_TRANSACTION_DATE as string,\n\t\tSQLDLOG_JobID as string,\n\t\tRDT_REC_CODE_KEY as string,\n\t\tRDT_REC_TYPE_CONTROL as string,\n\t\tRDT_NO_POST_REASON as string,\n\t\tRDT_SC_1 as string,\n\t\tRDT_SC_2 as string,\n\t\tRDT_SC_3 as string,\n\t\tRDT_SC_4 as string,\n\t\tRDT_SC_5 as string,\n\t\tRDT_SC_6 as string,\n\t\tRDT_SC_7 as string,\n\t\tRDT_SC_8 as string,\n\t\tRDT_CHD_SYSTEM_NO as string,\n\t\tRDT_CHD_PRIN_BANK as string,\n\t\tRDT_CHD_AGENT_BANK as string,\n\t\tRDT_TRANSACTION_CODE as string,\n\t\tRDT_MRCH_SYSTEM_NO as string,\n\t\tRDT_MRCH_PRIN_BANK as string,\n\t\tRDT_MRCH_AGENT_NO as string,\n\t\tRDT_MRCH_ACCOUNT_NUMBER as string,\n\t\tRDT_CHD_EXT_STATUS as string,\n\t\tRDT_CHD_INT_STATUS as string,\n\t\tRDT_TANI as string,\n\t\tRDT_TRANSFER_FLAG as string,\n\t\tRDT_ITEM_ASSES_CODE_NUM as string,\n\t\tRDT_MRCH_SIC_CODE as string,\n\t\tRDT_BATCH_TYPE as string,\n\t\tRDT_JULIAN_POST_DATE as string,\n\t\tRDT_BKDT_ADDITIONAL_INT as string,\n\t\tRDT_BACKDATED_TRAN_FLAG as string,\n\t\tRDT_CBRN_TRAN_ID as string,\n\t\tRDT_AUDIT_TRAIL_DATE as string,\n\t\tRDT_AUTHORIZATION_NO as string,\n\t\tRDT_MERCHANT_NAME as string,\n\t\tRDT_MERCHANT_CITY as string,\n\t\tRDT_MERCHANT_STATE as string,\n\t\tRDT_COFF_PRIN_PAID as string,\n\t\tRDT_COFF_INT_PAID as string,\n\t\tRDT_SSR_IN as string,\n\t\tRDT_ITEM_ADDITIONAL_AMT as string,\n\t\tRDT_BACK_PMT_ITEM_DATE as string,\n\t\tRDT_ADDTL_DESCRIPTION_FLAG as string,\n\t\tRDT_ENTERED_CHD_ACCT_NO as string,\n\t\tRDT_FLOAT_IND as string,\n\t\tRDT_REBATE_ADDITIONAL_AMT as string,\n\t\tRDT_REVERSAL_IND as string,\n\t\tRDT_FRGN_CURR_CODE as string,\n\t\tRDT_FGN_TRAN_AMT as string,\n\t\tRDT_VIC_PROC_DATE as string,\n\t\tRDT_ATM_FLAG as string,\n\t\tRDT_CARD_ACTV_TERM as string,\n\t\tRDT_AUTH_SOURCE as string,\n\t\tRDT_PREPAID_CARD_IND as string,\n\t\tRDT_BATCH_TYPE_FOR_SORT as string,\n\t\tRDT_AUTH_NUMBER as string,\n\t\tRDT_DEBIT_CARD_SWITCH as string,\n\t\tRDT_LOYALTY_MRCH_TYPE as string,\n\t\tRDT_BKDT_CTD_INT as string,\n\t\tRDT_RIS_IND as string,\n\t\tRDT_MRCH_RIS_IND as string,\n\t\tRDT_MAIL_PHONE_IND as string,\n\t\tRDT_FLOOR_LIMIT_IND as string,\n\t\tRDT_CWB_CRB_IND as string,\n\t\tRDT_LCS_IND as string,\n\t\tRDT_OVLMT_FEE_NET as string,\n\t\tRDT_NET_ITEM_CHG_CHNG as string,\n\t\tRDT_COFF_REASON as string,\n\t\tRDT_MEMBER_ID as string,\n\t\tRDT_DEBIT_PRODUCT_CODE as string,\n\t\tRDT_PROD_DATE as string,\n\t\tRDT_SEQ_NO as string,\n\t\tRDT_PLUS_ADJ_IND as string,\n\t\tRDT_TYPE_TRANS as string,\n\t\tRDT_RETAIL_SW as string,\n\t\tRDT_CARD_ACCEPTOR_CODE as string,\n\t\tRDT_YYMM_EXPIRE_DATE as string,\n\t\tRDT_RETAIL_FLAP_ID as string,\n\t\tRDT_AIRLINE_DATA_FLAG as string,\n\t\tRDT_TERM_ID as string,\n\t\tRDT_OPER_CODE as string,\n\t\tRDT_BATCH_TYPE2_FOR_SORT as string,\n\t\tRDT_MATCHING_AUTH_IND as string,\n\t\tRDT_BACKDATED_PYMT as string,\n\t\tRDT_USED_OTHR_RCRD as string,\n\t\tRDT_EMPL_ACCT_CD as string,\n\t\tRDT_USAV_OFFR_CD as string,\n\t\tRDT_TRMN_OWNR_ID as string,\n\t\tRDT_TRNS_PRCS_DATA_TX as string,\n\t\tRDT_TRN_286_SPCL_MRCH_DSCR_CD as string,\n\t\tRDT_RWRD_ID as string,\n\t\tRDT_HKBK_FMLY_CARD_CD as string,\n\t\tRDT_ANN_FEE_TRAN_CD as string,\n\t\tRDT_TOTL_DFP_AM as string,\n\t\tRDT_TRAN_GROUP_ID as string,\n\t\tRDT_IVA_TAX_AMOUNT as string,\n\t\tRDT_US_EQUIV_AMT as string,\n\t\tRDT_CURR_MARKUP_FEE as string,\n\t\tRDT_DETAIL_FLAP_DSPLY_IND as string,\n\t\tRDT_FLAP_DETAIL_DSPLY_IND as string,\n\t\tRDT_FLAP_PROMOTION_ID as string,\n\t\tRDT_TERMS_CODE as string,\n\t\tRDT_DEPT_CODE as string,\n\t\tRDT_BTCH_MTCH_CD as string,\n\t\tRDT_ACCT_MRKT_STRT_NM as string,\n\t\tRDT_SUB_ACCT_CD as string,\n\t\tRDT_ORGN_ACCT_NR as string,\n\t\tRDT_CONTROL_NUMBER as string,\n\t\tRDT_ADDL_SEGS_NO as string,\n\t\tRDT_ACCT_CARD_NUMBER as string,\n\t\tRDT_MRCH_SPEC_FLAG_CD as string,\n\t\tRDT_MRCH_DPST_CD as string,\n\t\tRDT_MULT_PURS_ID as string,\n\t\tRDT_TAX_EXMP_TOTL_AM as string,\n\t\tRDT_TDA_TRAN_CPTR_CD as string,\n\t\tRDT_PRCN_STGY_ID as string,\n\t\tRDT_CLNT_ID as string,\n\t\tRDT_LANG_CD as string,\n\t\tRDT_TRAN_ENTR_DT as string,\n\t\tRDT_TRAN_THRS_DT as string,\n\t\tRDT_CLNT_DFND_CARD_TYPE_ID as string,\n\t\tRDT_ITEM_FEE_TEXT_ID as string,\n\t\tRDT_PRMT_ITEM_FEE_MTHD_ID as string,\n\t\tRDT_MTP_DCRM_CD as string,\n\t\tRDT_DFP_CD as string,\n\t\tRDT_CENTURY_JULIAN_POST_DATE as string,\n\t\tRDT_LS_IVA_AM as string,\n\t\tRDT_TLF_MTHD_NM as string,\n\t\tRDT_ADJ_ORGN_TRAN_DT as string,\n\t\tREG_SEGMENT_CODE as string,\n\t\tRTI_REG_TRAN_ID_SOURCE as string,\n\t\tRTI_REG_MISC_AMOUNT as string,\n\t\tRTI_REG_TICKET_AUTH_AMOUNT as string,\n\t\tRTI_REG_BNK_RFRN_ID as string,\n\t\tRTI_REG_ORIG_TRAN_ID as string,\n\t\tRTI_REG_CARD_INPUT_MODE_CD as string,\n\t\tOTI_SEGMENT_CODE as string,\n\t\tOTI_ORIGINAL_REF_NO as string,\n\t\tOTI_ORIGINAL_POST_DATE as string,\n\t\tOTI_ORIGINAL_ADJ_TRAN_DT as string,\n\t\tAPR_SEGMENT_CODE as string,\n\t\tAPR_EAPR_CASH_INT as string,\n\t\tAPR_EAPR_MRCH_INT as string,\n\t\tAPR_EAPR_CASH_ITEM_CHG as string,\n\t\tAPR_EAPR_MRCH_ITEM_CHG as string,\n\t\tAPR_EAPR_LATE_CHG as string,\n\t\tAPR_EAPR_OVLM_CHG as string,\n\t\tAPR2_SEGMENT_CODE as string,\n\t\tAPR2_EAPR_MIN_CHG as string,\n\t\tAPR2_EAPR_STMT_CHG as string,\n\t\tAPR2_EAPR_CR_LIFE_CHG as string,\n\t\tAPR2_EAPR_REBATE_AMT as string,\n\t\tAPR2_EAPR_MIN_FINC_CASH_AM as string,\n\t\tAPR2_EAPR_MXCP_CRDT_AM as string,\n\t\tDFP_SEGMENT_CODE as string,\n\t\tRDT_DFP_FEE_NM as string,\n\t\tRDT_DFP_FEE_AM as string,\n\t\tRDT_DFP_PSTN_BCKT_ID as string,\n\t\tRDT_DFP_MMB_CD as string,\n\t\tRDT_DFP_RCUR_ID as string,\n\t\tRDT_DFP_LTTR_IN as string,\n\t\tRDT_DFP_MEMO_IN as string,\n\t\tRDT_DFP_BTCH_ALPH_CD as string,\n\t\tRDT_DFP_EMBD_IN as string,\n\t\tRDT_DFP_RESN_CD as string,\n\t\tRDT_DFP_STMT_PSTN_CD as string,\n\t\tRDT_DFP_RPT_CD as string,\n\t\tRDT_DFP_DYNM_FEE_GNRC_CD as string,\n\t\tRDT_DETL_ICHG_FEE_AM as string,\n\t\tRDT_POS_ENTR_MODE_CD as string,\n\t\tRDT_PI_TYPE_CD as string,\n\t\tRDT_ILR_IN as string,\n\t\tRDT_FEE_ATTRIBUTE as string,\n\t\tRDT_TKN_CDT as string,\n\t\tRDT_TKN_SRVC_NMBR_ID as string,\n\t\tRDT_WLLT_ID as string,\n\t\tRDT_TKN_RQST_ID as string,\n\t\tRDT_TKN_FILLER as string,\n\t\tRDT_GNRC_TRAN_FLD_SEG_CD as string,\n\t\tRDT_CARD_ACCP_TERM_ID as string,\n\t\tRDT_MRCH_FULL_ZIP_CD as string,\n\t\tRDT_GTF_FILLER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> MonetaryDetailTransactions\nsource(output(\n\t\tsys as string,\n\t\tprin as string,\n\t\tagent as string,\n\t\tPlatform as string,\n\t\tcu_odindx as string,\n\t\tCardCategory as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> CCUMSTR\nsource(output(\n\t\tTransactionCriteriaID as string,\n\t\tFD_Source_System_Key as string,\n\t\tTransactionName as string,\n\t\tBINType as string,\n\t\tTransactionCode as string,\n\t\tResponseCodeOperator as string,\n\t\tResponseCode as string,\n\t\tMerchantTypeOperator as string,\n\t\tMerchantType as string,\n\t\tPOSEntryCode as string,\n\t\tNetworkID as string,\n\t\tReferenceNumberOperator as string,\n\t\tReferenceNumber as string,\n\t\tAuthorizationResponseOperator as string,\n\t\tAuthorizationResponse as string,\n\t\tAuthorizationType as string,\n\t\tReasonCodeOperator as string,\n\t\tReasonCode as string,\n\t\tCreateDate as string,\n\t\tAuthorizationTypeOperator as string,\n\t\tAcctNumMerchNumMatchInd as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> FDCriteria\nsource(output(\n\t\tREPORTDATE as date,\n\t\tCREDITUNION as short,\n\t\tSYS as short,\n\t\tPRINTBANK as short,\n\t\tMERCHAGENT as short,\n\t\tENTEREDID as long,\n\t\tTRANDT as date,\n\t\tTRANSACTIONAMT as double,\n\t\tTRNCUR as short,\n\t\tBINNO as integer,\n\t\tMERCHANTACCTNO as long,\n\t\tMCC as short,\n\t\tACQRFRDABA as integer,\n\t\tATERMID as string,\n\t\t{TERMSEQ#} as integer,\n\t\tFDRTRANSACTIONID as long,\n\t\tTRANTM as string,\n\t\tSETTLEMENTAMT as double,\n\t\tSTLCURR as short,\n\t\tMERCHNAME as string,\n\t\tANID as string,\n\t\tISSRFDRABA as string,\n\t\tSTERMID as string,\n\t\t{SWTCSEQ#} as string,\n\t\tRETRIEVALREFNO as integer,\n\t\tSTLDT as string,\n\t\tSURCHARGEAM as string,\n\t\tSTLCNVR as double,\n\t\tMERCHANTADDRESS as string,\n\t\tINIDID as string,\n\t\tPOSEM as string,\n\t\tPRCSRID as string,\n\t\tPOSCDNCD as integer,\n\t\tFROMACCOUNT as string,\n\t\tFROMACCOUNTTYPE as integer,\n\t\tMSSGCOD as integer,\n\t\tPRCSCOD as integer,\n\t\tAUTHCOD as integer,\n\t\tMERCHANTCITY as string,\n\t\tST as string,\n\t\tADJTRANAMT as string,\n\t\tPVR as string,\n\t\tADJTRNFEE as boolean,\n\t\tTOACCOUNT as string,\n\t\tTOACCOUNTTYPE as short,\n\t\t{AR/CD} as short,\n\t\tLINEID as string,\n\t\tFDRTRACENO as long,\n\t\tADJSTLAMT as string,\n\t\tPTRAN as string,\n\t\tADJSTLFEE as boolean,\n\t\t{ADDTAMT(1)} as double,\n\t\t{ADDTAMT(2)} as boolean,\n\t\t{ADDTAMT(3)} as boolean,\n\t\t{ADDTAMT(4)} as boolean,\n\t\t{ADDTAMT(5)} as boolean,\n\t\t{ADDTAMT(6)} as boolean,\n\t\tLOGTM as string,\n\t\tSYSTM as string,\n\t\t{ADDTAMTXT(1)} as string,\n\t\t{ADDTAMTXT(2)} as string,\n\t\t{ADDTAMTXT(3)} as string,\n\t\t{ADDTAMTXT(4)} as string,\n\t\t{ADDTAMTXT(5)} as string,\n\t\t{ADDTAMTXT(6)} as string,\n\t\tLOGDT as date,\n\t\tEXPDT as string,\n\t\tSETTLFEEAMT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\twildcardPaths:['Fiserv/DD553/Current/*']) ~> source1\nDerivedColumn1 derive(OriginDate_DateID = toDate(RDT_TRANSACTION_DATE,'yyMMdd'),\n\t\tDateExpiration_DateID = toDate(RDT_TRANSACTION_DATE),\n\t\tDateSettlement_DateID = toDate(ReportDate),\n\t\tOriginalDataTransmission_DateID = toDate(OriginalDataTransmission_DateID_S),\n\t\tImportFileDate_DateID = toDate(ReportDate),\n\t\tAccountID = RDT_CHD_ACCOUNT_NUMBER,\n\t\tISOBIN = substring(RDT_CHD_ACCOUNT_NUMBER,1,6),\n\t\tIssuer_ClientID = 'UNK',\n\t\tTransactionNameID = RDT_TRANSACTION_CODE,\n\t\tProcessingCodeID = '',\n\t\tPOSConditionID = case(left(RDT_CHD_ACCOUNT_NUMBER,1)=='2'||left(RDT_CHD_ACCOUNT_NUMBER,1)=='4'||left(RDT_CHD_ACCOUNT_NUMBER,1)=='5',RDT_MAIL_PHONE_IND,''),\n\t\tAcquirerNetworkID = 'UNK',\n\t\tTransactionTypeID = RDT_TRANSACTION_CODE,\n\t\tAcquiringInstitution_CountryCodeID = '',\n\t\tTransaction_CountryCodeID = '',\n\t\tSettlement_CountryCodeID = '',\n\t\tCardEntryMethodID = RDT_POS_ENTR_MODE_CD,\n\t\tMerchantID = RDT_MERCHANT_NAME,\n\t\tTerminalCity = RDT_MERCHANT_CITY,\n\t\tTerminalState = RDT_MERCHANT_STATE,\n\t\tTerminalZipCode = '',\n\t\tTerminalCountry = case(RDT_MERCHANT_STATE=='AA'||RDT_MERCHANT_STATE=='AE'||RDT_MERCHANT_STATE=='AK'||RDT_MERCHANT_STATE=='AL'||RDT_MERCHANT_STATE=='AP'||RDT_MERCHANT_STATE=='AR'||RDT_MERCHANT_STATE=='AS'||RDT_MERCHANT_STATE=='AZ'||RDT_MERCHANT_STATE=='CA'||RDT_MERCHANT_STATE=='CO'||RDT_MERCHANT_STATE=='CT'||RDT_MERCHANT_STATE=='DC'||RDT_MERCHANT_STATE=='DE'||RDT_MERCHANT_STATE=='FL'||RDT_MERCHANT_STATE=='FM'||RDT_MERCHANT_STATE=='GA'||RDT_MERCHANT_STATE=='GU'||RDT_MERCHANT_STATE=='HI'||RDT_MERCHANT_STATE=='IA'||RDT_MERCHANT_STATE=='ID'||RDT_MERCHANT_STATE=='IL'||RDT_MERCHANT_STATE=='IN'||RDT_MERCHANT_STATE=='KS'||RDT_MERCHANT_STATE=='KY'||RDT_MERCHANT_STATE=='LA'||RDT_MERCHANT_STATE=='MA'||RDT_MERCHANT_STATE=='MD'||RDT_MERCHANT_STATE=='ME'||RDT_MERCHANT_STATE=='MH'||RDT_MERCHANT_STATE=='MI'||RDT_MERCHANT_STATE=='MN'||RDT_MERCHANT_STATE=='MO'||RDT_MERCHANT_STATE=='MP'||RDT_MERCHANT_STATE=='MS'||RDT_MERCHANT_STATE=='MT'||RDT_MERCHANT_STATE=='NC'||RDT_MERCHANT_STATE=='ND'||RDT_MERCHANT_STATE=='NE'||RDT_MERCHANT_STATE=='NH'||RDT_MERCHANT_STATE=='NJ'||RDT_MERCHANT_STATE=='NM'||RDT_MERCHANT_STATE=='NV'||RDT_MERCHANT_STATE=='NY'||RDT_MERCHANT_STATE=='OH'||RDT_MERCHANT_STATE=='OK'||RDT_MERCHANT_STATE=='OR'||RDT_MERCHANT_STATE=='PA'||RDT_MERCHANT_STATE=='PR'||RDT_MERCHANT_STATE=='PW'||RDT_MERCHANT_STATE=='RI'||RDT_MERCHANT_STATE=='SC'||RDT_MERCHANT_STATE=='SD'||RDT_MERCHANT_STATE=='TN'||RDT_MERCHANT_STATE=='TX'||RDT_MERCHANT_STATE=='UT'||RDT_MERCHANT_STATE=='VI'||RDT_MERCHANT_STATE=='VT'||RDT_MERCHANT_STATE=='WA'||RDT_MERCHANT_STATE=='WI'||RDT_MERCHANT_STATE=='WV'||RDT_MERCHANT_STATE=='WY'||RDT_MERCHANT_STATE=='','USA',RDT_MERCHANT_STATE),\n\t\tResponseCodeID = '00',\n\t\tIndicatorID = '',\n\t\tAccountFrom = '',\n\t\tAccountTo = '',\n\t\tTransactionCount = 1,\n\t\tInterchangeAmount = toFloat(RDT_DETL_ICHG_FEE_AM)*-1.00,\n\t\tCashBackAmount = 0.00,\n\t\tSurchargeAmount = toFloat(0.00),\n\t\tRequestAmount = RDT_TRANSACTION_AMOUNT,\n\t\tSettlementAmount = toFloat(RDT_TRANSACTION_AMOUNT),\n\t\tExceptionAmount = '',\n\t\tSwitchDate = toDate(OriginalDataTransmission_DateID_S),\n\t\tCardAcceptor = RDT_CARD_ACCEPTOR_CODE,\n\t\tIssuerRTN = '',\n\t\tAcquirerRTN = '',\n\t\tAcquirer_ClientID = 'UNK',\n\t\tBINEXT = RDT_CHD_ACCOUNT_NUMBER,\n\t\tCardPrescenceDescription = case(RDT_MRCH_SIC_CODE=='6011'\r\n||(RDT_MRCH_SIC_CODE=='6010'&& RDT_TRANSACTION_CODE=='271')\r\n||(RDT_POS_ENTR_MODE_CD == '00'&& left(RDT_CHD_ACCOUNT_NUMBER,1) == '4'&&(RDT_MAIL_PHONE_IND==''||RDT_MAIL_PHONE_IND=='0'))\r\n||(RDT_POS_ENTR_MODE_CD == '01'&& left(RDT_CHD_ACCOUNT_NUMBER,1) == '4'&&(RDT_MAIL_PHONE_IND==''||RDT_MAIL_PHONE_IND=='0'))\r\n||(RDT_POS_ENTR_MODE_CD == ''&& left(RDT_CHD_ACCOUNT_NUMBER,1) == '4'&&(RDT_MAIL_PHONE_IND==''||RDT_MAIL_PHONE_IND=='0'))\r\n||(RDT_POS_ENTR_MODE_CD == '00'&& (left(RDT_CHD_ACCOUNT_NUMBER,1) == '5'||left(RDT_CHD_ACCOUNT_NUMBER,1) == '2')&&(RTI_REG_CARD_INPUT_MODE_CD==''||RTI_REG_CARD_INPUT_MODE_CD=='0'||RTI_REG_CARD_INPUT_MODE_CD=='B'||RTI_REG_CARD_INPUT_MODE_CD=='A'))\r\n||(RDT_POS_ENTR_MODE_CD == '01'&& (left(RDT_CHD_ACCOUNT_NUMBER,1) == '5'||left(RDT_CHD_ACCOUNT_NUMBER,1) == '2')&&(RTI_REG_CARD_INPUT_MODE_CD==''||RTI_REG_CARD_INPUT_MODE_CD=='0'||RTI_REG_CARD_INPUT_MODE_CD=='B'||RTI_REG_CARD_INPUT_MODE_CD=='A'))\r\n||(RDT_POS_ENTR_MODE_CD == ''&& (left(RDT_CHD_ACCOUNT_NUMBER,1) == '5'||left(RDT_CHD_ACCOUNT_NUMBER,1) == '2')&&(RTI_REG_CARD_INPUT_MODE_CD==''||RTI_REG_CARD_INPUT_MODE_CD=='0'||RTI_REG_CARD_INPUT_MODE_CD=='B'||RTI_REG_CARD_INPUT_MODE_CD=='A'))\r\n||(RDT_POS_ENTR_MODE_CD=='02'||RDT_POS_ENTR_MODE_CD=='05'||RDT_POS_ENTR_MODE_CD=='07'||RDT_POS_ENTR_MODE_CD=='79'||RDT_POS_ENTR_MODE_CD=='80'||RDT_POS_ENTR_MODE_CD=='82'||RDT_POS_ENTR_MODE_CD=='90'||RDT_POS_ENTR_MODE_CD=='91')\r\n,'CP','CNP'),\n\t\tsource = 'FD',\n\t\tissuenetwork = 'UNK',\n\t\tmonetary = 1,\n\t\tOnUsDescription = 'UNK',\n\t\tRecurringDescription = case(left(RDT_CHD_ACCOUNT_NUMBER,1) == '4'&&RDT_MAIL_PHONE_IND =='2','Yes','' ),\n\t\tResponseCode = '00',\n\t\tTerminalAddress = case(RDT_MRCH_SIC_CODE =='6011',RDT_MERCHANT_NAME,''),\n\t\ttermicalkey = 'UNK',\n\t\tTokenRequestId = 'UNK',\n\t\tTransactionName = 'UNK',\n\t\tTransactionTypeCode = 'UNK',\n\t\tTransmissionDate = toDate(OriginalDataTransmission_DateID_S),\n\t\tSettlementDate = toDate(ReportDate)) ~> MappingTransformation\nMonetaryDetailTransactions derive(each(match(type=='string'), $$ = rtrim(ltrim($$))),\n\t\tOriginalDataTransmission_DateID_S = '1900-01-01') ~> DerivedColumn1\nCCUMSTR filter(cu_odindx=='0008'||cu_odindx=='0014'||cu_odindx=='0035'||cu_odindx=='0037'||cu_odindx=='0040'||cu_odindx=='0062'||cu_odindx=='0064'||cu_odindx=='0065'||cu_odindx=='0067'||cu_odindx=='0072'||cu_odindx=='0090'||cu_odindx=='0104'||cu_odindx=='0142'||cu_odindx=='0172'||cu_odindx=='0213'||cu_odindx=='0216'||cu_odindx=='0231'||cu_odindx=='0238'||cu_odindx=='0247'||cu_odindx=='0258'||cu_odindx=='0261'||cu_odindx=='0265'\n||cu_odindx=='0276'||cu_odindx=='0289'||cu_odindx=='0301'||cu_odindx=='0309'||cu_odindx=='0355'||cu_odindx=='0370'||cu_odindx=='0371'||cu_odindx=='0386'||cu_odindx=='0412'||cu_odindx=='0419'||cu_odindx=='0484'||cu_odindx=='0508'||cu_odindx=='0546'||cu_odindx=='0575'||cu_odindx=='0580'||cu_odindx=='0593'||cu_odindx=='0595'||cu_odindx=='0601'||cu_odindx=='0628'||cu_odindx=='0642'||cu_odindx=='0649'||cu_odindx=='0708'||cu_odindx=='0714'||cu_odindx=='0736'||cu_odindx=='0739'||cu_odindx=='0765'||cu_odindx=='0780'\n||cu_odindx=='0858'||cu_odindx=='3364') ~> Filter1\nFilter1, MappingTransformation join(sys == RDT_CHD_SYSTEM_NO\n\t&& prin == RDT_CHD_PRIN_BANK\n\t&& agent == RDT_CHD_AGENT_BANK,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nSelect1, Select2 join(CardCategory == BINType\n\t&& RDT_TRANSACTION_CODE == TransactionCode,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join2\nDerivedColumn3 filter(FD_Source_System_Key=='3'\r\n&&\r\n(isNull(MerchantType)||MerchantType=='NULL'||(MerchantTypeOperator=='IN'&&iifNull(locate(RDT_MRCH_SIC_CODE,MerchantType),0)!=0)||(MerchantTypeOperator=='NOT IN'&&iifNull(locate(RDT_MRCH_SIC_CODE,MerchantType),0)==0))\r\n&&\r\n(ReferenceNumber_FD=='NULL'||isNull(ReferenceNumber_FD)||(ReferenceNumberOperator=='='&&substring(ReferenceNumber,12,2)==ReferenceNumber_FD)||(ReferenceNumberOperator=='<>'&&substring( ReferenceNumber ,12,2)!=ReferenceNumber_FD))\r\n&&\r\n(isNull(AcctNumMerchNumMatchInd)||AcctNumMerchNumMatchInd=='NULL'||(AcctNumMerchNumMatchInd=='Y'&&left(RDT_CHD_ACCOUNT_NUMBER,6)==left(RDT_MRCH_ACCOUNT_NUMBER ,6))||(AcctNumMerchNumMatchInd=='N'&&left(RDT_CHD_ACCOUNT_NUMBER,6)!=left(RDT_MRCH_ACCOUNT_NUMBER ,6)))) ~> Filter\nJoin1 derive(ReferenceNumber_tran = RDT_ENTRY_TYPE + RDT_ENTRY_SYS_4 + RDT_ENTRY_SYS_2 + RDT_ENTRY_DATE + RDT_ENTRY_2 + RDT_ENTRY_LAST_6,\n\t\tMerchantType_tran = right('000' + RDT_MRCH_SIC_CODE,4)) ~> DerivedColumn2\nDerivedColumn2 select(skipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nFDCriteria select(mapColumn(\n\t\tTransactionCriteriaID,\n\t\tFD_Source_System_Key,\n\t\tTransactionName_src = TransactionName,\n\t\tBINType,\n\t\tTransactionCode,\n\t\tResponseCodeOperator,\n\t\tResponseCode,\n\t\tMerchantTypeOperator,\n\t\tMerchantType,\n\t\tPOSEntryCode,\n\t\tNetworkID,\n\t\tReferenceNumberOperator,\n\t\tReferenceNumber,\n\t\tAuthorizationResponseOperator,\n\t\tAuthorizationResponse,\n\t\tAuthorizationType,\n\t\tReasonCodeOperator,\n\t\tReasonCode,\n\t\tCreateDate,\n\t\tAuthorizationTypeOperator,\n\t\tAcctNumMerchNumMatchInd\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nJoin2 derive(ReferenceNumber_trans = RDT_ENTRY_TYPE + RDT_ENTRY_SYS_4 + RDT_ENTRY_SYS_2 + RDT_ENTRY_DATE + RDT_ENTRY_2 + RDT_ENTRY_LAST_6,\n\t\tReferenceNumber_FD = ReferenceNumber,\n\t\tTransactionName_FD = TransactionName_src,\n\t\tTransmissionTime = 'UNK',\n\t\tTimeLocalTransaction = 'UNK',\n\t\tRetrievalReferenceNumber = 'UNK') ~> DerivedColumn3\nFilter derive(Transaction_Key = crc32(iif(isNull(AccountID),'',AccountID)\r\n, iif(isNull(OriginDate_DateID),'',toString(OriginDate_DateID))\r\n, iif(isNull(RDT_MRCH_AGENT_NO),'',RDT_MRCH_AGENT_NO)\r\n, iif(isNull(RDT_CHD_AGENT_BANK),'',RDT_CHD_AGENT_BANK)\r\n, iif(isNull(RDT_MRCH_SYSTEM_NO),'',RDT_MRCH_SYSTEM_NO)\r\n, iif(isNull(SettlementAmount),0.00,SettlementAmount)\r\n, 2)) ~> HashKey\nMappingTransformation select(mapColumn(\n\t\tRDT_OPER_CODE,\n\t\tRDT_CHD_ACCOUNT_NUMBER = AccountID,\n\t\tRDT_MRCH_AGENT_NO,\n\t\tRDT_CHD_AGENT_BANK,\n\t\tRDT_MRCH_SYSTEM_NO,\n\t\tRDT_TRANSACTION_AMOUNT = SettlementAmount,\n\t\tRDT_TRANSACTION_DATE = OriginDate_DateID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nHashKey filter(RDT_OPER_CODE == 'NYC') ~> Filter3\nSelect3 aggregate(groupBy(RDT_OPER_CODE),\n\tcount = count()) ~> Aggregate1\nsource1 select(mapColumn(\n\t\tSYS,\n\t\tPRINTBANK,\n\t\tMERCHAGENT,\n\t\tENTEREDID,\n\t\tTRANDT,\n\t\tTRANSACTIONAMT,\n\t\tCREDITUNION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select4\nSelect4 derive(SYS = toString(SYS),\n\t\tPRINTBANK = toString(PRINTBANK),\n\t\tMERCHAGENT = lpad(toString(MERCHAGENT),4,'0'),\n\t\tENTEREDID = toString(ENTEREDID),\n\t\tCREDITUNION = toString(CREDITUNION)) ~> ModifyColumns1\nFilter4, Select3 join(ENTEREDID == RDT_CHD_ACCOUNT_NUMBER\n\t&& TRANDT == RDT_TRANSACTION_DATE\n\t&& TRANSACTIONAMT == RDT_TRANSACTION_AMOUNT,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join3\nModifyColumns1 filter(like(ENTEREDID,'%5162890003252712%')) ~> Filter4\nHashKey sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tAccountNumber as string,\n\t\tAcquirerAccountNumber as string,\n\t\tAcquirerNetworkCode as string,\n\t\tBin_ISO as string,\n\t\tBin_EXT as string,\n\t\tCardEntryMethodCode as string,\n\t\tCardPresenceDescription as string,\n\t\tImportFileDate as date,\n\t\tSource as string,\n\t\tInterchangeAmount as float,\n\t\tIssuerAccountNumber as string,\n\t\tIssuerNetworkCode as string,\n\t\tMerchantName as string,\n\t\tMerchantType as string,\n\t\tMonetary as integer,\n\t\tOnUsDescription as string,\n\t\tOriginalDataTransmissionDate as date,\n\t\tOriginDate as date,\n\t\tRecurringDescription as string,\n\t\tResponseCode as string,\n\t\tSettlementAmount as float,\n\t\tSettlementDate as date,\n\t\tSurchargeAmount as float,\n\t\tTerminalAddress as string,\n\t\tTerminalCity as string,\n\t\tTerminalCountry as string,\n\t\tTerminalKey as string,\n\t\tTerminalState as string,\n\t\tTerminalZipCode as string,\n\t\tTokenRequestId as string,\n\t\tTransactionName as string,\n\t\tTransactionTypeCode as string,\n\t\tTransmissionDate as date,\n\t\tTransmissionTime as string,\n\t\tTimeLocalTransaction as string,\n\t\tRetrievalReferenceNumber as string,\n\t\tTransaction_Key as long,\n\t\tAgentNo as string,\n\t\tSystemNo as string,\n\t\tOperCode as string,\n\t\tPrincipalNo as string,\n\t\tAuthorizationNo as string,\n\t\tClientNo as string,\n\t\ttransaction_amount as float,\n\t\tis_authorization as integer,\n\t\tAcquiringRTN as string,\n\t\tSettlementRTN as string,\n\t\tTraceNumber as string,\n\t\tAcqTraceNumber as string,\n\t\tVisaTransactionID as string,\n\t\tMasterCardTransactionID as string,\n\t\tMerchantAccountNumber as string,\n\t\tISOMessageType as string,\n\t\tForwardingRTN as string\n\t),\n\tformat: 'parquet',\n\tpartitionFileNames:[($fileName)],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tmapColumn(\n\t\tAccountNumber = AccountID,\n\t\tAcquirerAccountNumber = Acquirer_ClientID,\n\t\tAcquirerNetworkCode = AcquirerNetworkID,\n\t\tBin_ISO = ISOBIN,\n\t\tBin_EXT = BINEXT,\n\t\tCardEntryMethodCode = RDT_POS_ENTR_MODE_CD,\n\t\tCardPresenceDescription = CardPrescenceDescription,\n\t\tImportFileDate = ImportFileDate_DateID,\n\t\tSource = source,\n\t\tInterchangeAmount,\n\t\tIssuerAccountNumber = Issuer_ClientID,\n\t\tIssuerNetworkCode = issuenetwork,\n\t\tMerchantName = RDT_MERCHANT_NAME,\n\t\tMerchantType = RDT_MRCH_SIC_CODE,\n\t\tMonetary = monetary,\n\t\tOnUsDescription,\n\t\tOriginalDataTransmissionDate = OriginalDataTransmission_DateID,\n\t\tOriginDate = OriginDate_DateID,\n\t\tRecurringDescription,\n\t\tResponseCode = ResponseCodeID,\n\t\tSettlementAmount,\n\t\tSettlementDate,\n\t\tSurchargeAmount,\n\t\tTerminalAddress,\n\t\tTerminalCity = Transactions_ID,\n\t\tTerminalCountry,\n\t\tTerminalKey = termicalkey,\n\t\tTerminalState,\n\t\tTerminalZipCode,\n\t\tTokenRequestId = Transactions_ID,\n\t\tTransactionName = TransactionName_FD,\n\t\tTransactionTypeCode,\n\t\tTransmissionDate,\n\t\tTransmissionTime,\n\t\tTimeLocalTransaction,\n\t\tRetrievalReferenceNumber,\n\t\tTransaction_Key,\n\t\tAgentNo = RDT_MRCH_AGENT_NO,\n\t\tAgentBank = RDT_CHD_AGENT_BANK,\n\t\tSystemNo = RDT_MRCH_SYSTEM_NO\n\t),\n\tpartitionBy('hash', 1)) ~> sink1"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/populate_Chargebacks_FiservMembers')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "FirstData"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "src_stgPIRecord",
                                "type": "DatasetReference"
                            },
                            "name": "srcPIRecord"
                        },
                        {
                            "dataset": {
                                "referenceName": "DS_ADLS_stage_BalanceStatus",
                                "type": "DatasetReference"
                            },
                            "name": "srcBalanceStatus"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgCustExpanded",
                                "type": "DatasetReference"
                            },
                            "name": "scrCustExpanded"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgAltCustIdentification",
                                "type": "DatasetReference"
                            },
                            "name": "srcAltCustIdentification"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgExpAddr",
                                "type": "DatasetReference"
                            },
                            "name": "srcExpAddr"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgPI_Status",
                                "type": "DatasetReference"
                            },
                            "name": "srcPIStatus"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgEmail",
                                "type": "DatasetReference"
                            },
                            "name": "srcEmail"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgCountryCode",
                                "type": "DatasetReference"
                            },
                            "name": "srcCountryCode"
                        },
                        {
                            "dataset": {
                                "referenceName": "src_stgCountryCodeSubdivision",
                                "type": "DatasetReference"
                            },
                            "name": "srcCountryCodeSubdivision"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "dst_CardHolder_staging",
                                "type": "DatasetReference"
                            },
                            "name": "snkCardHolderWithBASTAddr"
                        },
                        {
                            "dataset": {
                                "referenceName": "dst_CardHolderEmail_staging",
                                "type": "DatasetReference"
                            },
                            "name": "snkCardHolderEmail"
                        },
                        {
                            "dataset": {
                                "referenceName": "dst_CardHolder_staging",
                                "type": "DatasetReference"
                            },
                            "name": "snkCardHolderWithExpAddr"
                        },
                        {
                            "dataset": {
                                "referenceName": "dst_CardHolder_staging",
                                "type": "DatasetReference"
                            },
                            "name": "snkNoAddr"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "dcPIRecord"
                        },
                        {
                            "name": "dcBalanceStatus"
                        },
                        {
                            "name": "dcCustExpanded"
                        },
                        {
                            "name": "dcPIStatus"
                        },
                        {
                            "name": "selectPIRecord"
                        },
                        {
                            "name": "SelectBalanceStatus"
                        },
                        {
                            "name": "ijBalanceStatus"
                        },
                        {
                            "name": "SelectCustExpanded"
                        },
                        {
                            "name": "ijCustExpanded"
                        },
                        {
                            "name": "SelectAltCustIdentification"
                        },
                        {
                            "name": "SelectExpAddr"
                        },
                        {
                            "name": "SelectPIStatus"
                        },
                        {
                            "name": "lojPIStatus"
                        },
                        {
                            "name": "SelectPIRecordForEmail"
                        },
                        {
                            "name": "DistinctPIRecordAccount"
                        },
                        {
                            "name": "SelectEmail"
                        },
                        {
                            "name": "ijEmail"
                        },
                        {
                            "name": "trimBlankSpacesPIRecord"
                        },
                        {
                            "name": "trimBlankSpacesEmail"
                        },
                        {
                            "name": "trimBlankSpacesBalanceStatus"
                        },
                        {
                            "name": "trimBlankSpacesCustExpanded"
                        },
                        {
                            "name": "trimBlankSpacesAltCustIdentification"
                        },
                        {
                            "name": "trimBlankSpacesExpAddr"
                        },
                        {
                            "name": "trimBlankSpacesPIStatus"
                        },
                        {
                            "name": "FilterAltCustIdentification"
                        },
                        {
                            "name": "lojAltCustIdentification"
                        },
                        {
                            "name": "FilterExpAddr"
                        },
                        {
                            "name": "dcExpAddr"
                        },
                        {
                            "name": "BASTAddrPrimaryOnly"
                        },
                        {
                            "name": "FilterBASTAddrPrimaryOnly"
                        },
                        {
                            "name": "NotExistsExpAddrPrimary"
                        },
                        {
                            "name": "ExistsExpAddr"
                        },
                        {
                            "name": "ExpAddrFinal"
                        },
                        {
                            "name": "ijExpAddr"
                        },
                        {
                            "name": "FilterNoAddr"
                        },
                        {
                            "name": "NoAddr"
                        },
                        {
                            "name": "dcRequiredValues"
                        },
                        {
                            "name": "LookupExpAddrCountry"
                        },
                        {
                            "name": "SelectCountry"
                        },
                        {
                            "name": "trimBlankSpaceCountry"
                        },
                        {
                            "name": "dcCountrySubdivision"
                        },
                        {
                            "name": "LookupSubdivisionBalanceStatus"
                        },
                        {
                            "name": "trimBlankSpaceSubdivision"
                        },
                        {
                            "name": "SelectSubdivision"
                        },
                        {
                            "name": "ijCountrySubdivision"
                        },
                        {
                            "name": "SelectCountryAll"
                        },
                        {
                            "name": "SelectExpAddrAll"
                        },
                        {
                            "name": "SelectBalanceStatusAll"
                        },
                        {
                            "name": "FilterOutHeadingsIfExists"
                        },
                        {
                            "name": "dcAddressExpAddr"
                        },
                        {
                            "name": "dcAddressNoAddr"
                        },
                        {
                            "name": "dcAddressBAST"
                        }
                    ],
                    "script": "source(output(\n\t\tPI_Record_ID as integer '000',\n\t\tPINS_GROUP_ID as string,\n\t\tPINS_OUT_KEY_SYS_BANK as string,\n\t\tPINS_OUT_KEY_PRIN_BANK as string,\n\t\tPINS_OUT_KEY_AGENT_BANK as string,\n\t\tPINS_OUT_KEY_ACCT_NO as string,\n\t\tPINS_TYPE_CD as string,\n\t\tPINS_MMBR_SQNC_NR as string,\n\t\tPINS_OUT_PI_ID as string,\n\t\tPINS_OUT_ASSG_CRTN_DT as string,\n\t\tPINS_OUT_PLST_GNRT_LAST_DT as string,\n\t\tPINS_OUT_PIN_LAST_CHNG_DT as string,\n\t\tPINS_OUT_PIN_MALR_LAST_DT as string,\n\t\tPINS_OUT_EXPR_DT as string,\n\t\tPINS_OUT_PLST_CT as string,\n\t\tPINS_OUT_PIN_VRFY_NR as string,\n\t\tPINS_OUT_PSTN_TYPE_CD as string,\n\t\tPINS_OUT_PIN_TRNS_FLAG_IN as string,\n\t\tPINS_OUT_SCRT_CD as string,\n\t\tPINS_OUT_PLST_TYPE_CD as string,\n\t\tPINS_OUT_PLST_RPLC_IN as string,\n\t\tPINS_OUT_PIN_PRHB_IN as string,\n\t\tPINS_OUT_PHTC_USE_INDC_CD as string,\n\t\tPINS_OUT_PRSN_EMBS_TX as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_CD as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_DT as string,\n\t\tPINS_OUT_ACCT_ACCS_TS as string,\n\t\tPINS_OUT_PCKG_ID as string,\n\t\tPINS_OUT_LAST_PLST_NNMN_TM as string,\n\t\tPINS_OUT_MNTN_TS as string,\n\t\tPINS_OUT_PI_BULK_MAIL_ID as string,\n\t\tPINS_OUT_PI_TYPE_CD as string,\n\t\tPINS_OUT_PLST_RPLC_DT as string,\n\t\tPINS_OUT_PRIR_EXPR_DT as string,\n\t\tPINS_OUT_PI_RPLC_SQNC_NR as string,\n\t\tPINS_OUT_AUTH_PRIR_EXPR_IN as string,\n\t\tPINS_OUT_PHTC_IMAG_STTS_CD as string,\n\t\treportDate as date 'yyyy-MM-dd',\n\t\tdateProcessed as timestamp 'MM/dd/yyyy HH:mm:ss',\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcPIRecord\nsource(output(\n\t\tBalanceStatus_ID as string,\n\t\tRECORD_TYPE as string,\n\t\tPRIMARY_NAME as string,\n\t\tSECONDARY_NAME as string,\n\t\tADDR_LINE_1 as string,\n\t\tADDR_LINE_2 as string,\n\t\tCITY as string,\n\t\tSTATE as string,\n\t\tZIP_CODE as string,\n\t\tSYS_BANK as string,\n\t\tPRIN_BANK as string,\n\t\tAGENT_BANK as string,\n\t\tACCT_NO as string,\n\t\tNUMBER_OF_PLASTICS_X as string,\n\t\tCYCLE_CODE as string,\n\t\tEXPIRATION_DATE as string,\n\t\tOPEN_DATE_MMYY as string,\n\t\tNEW_CARD_FLAG as string,\n\t\tEXTERNAL_STATUS as string,\n\t\tINTERNAL_STATUS as string,\n\t\tAUTH_FLAG as string,\n\t\tCREDIT_SCORE as string,\n\t\tTYPE_CR_LINE_CHNG as string,\n\t\tTYPE_OF_PLASTICS as string,\n\t\tSPOUSE_TYPE_PLASTIC as string,\n\t\tSPECIAL_FLAGS_5_THRU_8 as string,\n\t\tRENEWAL_CODE as string,\n\t\tCREDIT_LINE as string,\n\t\tAVAILABLE_CREDIT as string,\n\t\tCASH_ADVANCE_BALANCE as string,\n\t\tCREDIT_BUREAU_FLAG as string,\n\t\tTERMS_FLAG as string,\n\t\tHOLD_CODE as string,\n\t\tCROSS_REF_ACCT_NO as string,\n\t\tCROSS_REF_ACCT_NO_1 as string,\n\t\tCROSS_REF_ACCT_NO_2 as string,\n\t\tMISCELLANEOUS_FIELD_1 as string,\n\t\tMISCELLANEOUS_FIELD_2 as string,\n\t\tMISCELLANEOUS_FIELD_3 as string,\n\t\tEXP_USER_FLAGS_1_THRU_4 as string,\n\t\tFIXED_PAYMENT_AMOUNT as string,\n\t\tAUTOMATIC_PAYMENT_FLAG as string,\n\t\tANNUAL_CHARGE_DATE as string,\n\t\tANNUAL_CHARGE_FLAG as string,\n\t\tDATE_OF_CR_LINE_CHNG as string,\n\t\tCREDIT_LIFE_FLAG as string,\n\t\tHOME_TELEPHONE_NUMBER as string,\n\t\tBUSINESS_TELEPHONE_NUMBER as string,\n\t\tSOCIAL_SECURITY_NUMBER as string,\n\t\tCHECKING_ACCOUNT_NUMBER as string,\n\t\tSAVINGS_ACCOUNT_NUMBER as string,\n\t\tRECOURSE_FLAG as string,\n\t\tDUALITY_FLAG as string,\n\t\tMONTHS_GROSS_ACTIVE as string,\n\t\tTIMES_IN_DISPUTE as string,\n\t\tTIMES_ONE_CYCLE_DELINQ as string,\n\t\tTIMES_TWO_CYCLES_DELINQ as string,\n\t\tTIMES_THREE_CYCLES_DELINQ as string,\n\t\tLAST_PAYMENT_AMOUNT as string,\n\t\tSTATEMENT_BALANCE as string,\n\t\tSTATEMENT_DATE as string,\n\t\tDATE_FIRST_ACTIVE as string,\n\t\tDATE_OF_LAST_PAYMENT as string,\n\t\tDATE_OF_LAST_MONETARY as string,\n\t\tTYPE_OF_LAST_MONETARY as string,\n\t\tHIGH_BALANCE as string,\n\t\tPAYMENT_HISTORY as string,\n\t\tDATE_OF_LAST_NON_MONETARY as string,\n\t\tTYPE_OF_LAST_NON_MONETARY as string,\n\t\tDISPUTE_AMOUNT as string,\n\t\tDISPUTE_DAYS as string,\n\t\tDATE_STATUS_CHANGE as string,\n\t\tTIMES_OVERLIMIT as string,\n\t\tTIMES_REAGED as string,\n\t\tMINIMUM_PAYMENT_DUE as string,\n\t\tDELINQUENCY_DOLLARS as string,\n\t\tCURRENT_BALANCE as string,\n\t\tDAYS_DELINQUENT as string,\n\t\tReportDate as string,\n\t\tDATE_OF_BIRTH as string,\n\t\tSECONDARY_DATE_OF_BIRTH as string,\n\t\tWB_TRAN_TYPE as string,\n\t\tWB_PURGE_DATE as string,\n\t\tLIFE_4_CYCLE_DELQ_CT as string,\n\t\tLIFE_5_CYCLE_DELQ_CT as string,\n\t\tLIFE_6_CYCLE_DELQ_CT as string,\n\t\tLIFE_7_CYCLE_DELQ_CT as string,\n\t\tPREV_CRLINE_CHANGE_DATE as string,\n\t\tNAME_ADDR_CHG as string,\n\t\tSOLICITATION_FLAG as string,\n\t\tEMPL_ACCT_CD as string,\n\t\tANN_RATE_CASH as string,\n\t\tANN_RATE_MRCH as string,\n\t\tCURRENT_PRICING_STRATEGY as string,\n\t\tCOV_STRATEGY_ID as string,\n\t\tSECONDARY_SOC_SEC_NO as string,\n\t\tCMPN_ID as string,\n\t\tPYMN_DUE_DT as string,\n\t\tBONUS_STRATEGY as string,\n\t\tFRAUD_SCORE as string,\n\t\tFRAUD_SCORE_CHANGE_DATE as string,\n\t\tFRAUD_PORT_ID as string,\n\t\tFRAUD_ASSG_STRATEGY as string,\n\t\tFRAUD_SUSPEND_STRATEGY as string,\n\t\tFRAUD_SUSP_STRATEGY_DATE as string,\n\t\tBEHAVIOR_SCORE as string,\n\t\tCR_SCORE_DATE as string,\n\t\tPROCESSING_LEVEL as string,\n\t\tMISCELLANEOUS_FIELD_4 as string,\n\t\tMISCELLANEOUS_FIELD_5 as string,\n\t\tMISCELLANEOUS_FIELD_6 as string,\n\t\tMISCELLANEOUS_FIELD_7 as string,\n\t\tMISCELLANEOUS_FIELD_8 as string,\n\t\tMISC_FIELD_9 as string,\n\t\tMISC_FIELD_10 as string,\n\t\tMISC_FIELD_11_TX as string,\n\t\tMISC_FIELD_12_TX as string,\n\t\tMISC_FIELD_13_TX as string,\n\t\tClient as string,\n\t\tDateCreated as string,\n\t\tDateUpdated as string,\n\t\tREISSUE_CONTROL as string,\n\t\tEM_PD_HM_ADDR_TX as string,\n\t\tEM_PD_BS_ADDR_TX as string,\n\t\tEM_SD_HM_ADDR_TX as string,\n\t\tEM_SD_BS_ADDR_TX as string,\n\t\tSEC_CODE_NUM_1 as string,\n\t\tSTATUS_REASON_CODE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcBalanceStatus\nsource(output(\n\t\tCustExpanded_ID as string,\n\t\tCUEX_GROUP_ID as string,\n\t\tCUEX_OUT_KEY_SYS_BANK as string,\n\t\tCUEX_OUT_KEY_PRIN_BANK as string,\n\t\tCUEX_OUT_KEY_AGENT_BANK as string,\n\t\tCUEX_OUT_KEY_ACCT_NO as string,\n\t\tCUEX_TYPE_CD as string,\n\t\tCUEX_MMBR_SQNC_NR as string,\n\t\tCUEX_OUT_EXTR_ID as string,\n\t\tCUEX_OUT_CUST_NM as string,\n\t\tCUEX_OUT_SLLT_SEX_CD as string,\n\t\tCUEX_OUT_DCSD_CD as string,\n\t\tCUEX_OUT_BRTH_DT as string,\n\t\tCUEX_OUT_SLCT_CD as string,\n\t\tCUEX_OUT_CLNT_EMPL_CD as string,\n\t\tCUEX_OUT_MTHR_MADN_NM as string,\n\t\tCUEX_OUT_SFFX_CD as string,\n\t\tCUEX_OUT_PRFX_TX as string,\n\t\tCUEX_OUT_FRST_NM as string,\n\t\tCUEX_OUT_LAST_NM as string,\n\t\tCUEX_OUT_MDDL_NM as string,\n\t\tCUEX_OUT_QLFC_TX as string,\n\t\tCUEX_OUT_TITL_TX as string,\n\t\tCUEX_OUT_NAME_SQNC_CD as string,\n\t\tCUEX_OUT_CMBN_IN as string,\n\t\tCUEX_OUT_LAST_NNMN_SORC_TX as string,\n\t\tCUEX_OUT_LAST_NNMN_CD as string,\n\t\tCUEX_OUT_LAST_NNMN_DT as string,\n\t\tCUEX_OUT_LAST_NNMN_TM as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> scrCustExpanded\nsource(output(\n\t\tAltCustIdentification_ID as string,\n\t\tALTC_GROUP_ID as string,\n\t\tALTC_OUT_KEY_SYS_BANK as string,\n\t\tALTC_OUT_KEY_PRIN_BANK as string,\n\t\tALTC_OUT_KEY_AGENT_BANK as string,\n\t\tALTC_OUT_KEY_ACCT_NO as string,\n\t\tALTC_TYPE_CD as string,\n\t\tALTC_MMBR_SQNC_NR as string,\n\t\tALTC_OUT_EXTR_ID as string,\n\t\tALTC_OUT_ID_TYPE_CD as string,\n\t\tALTC_OUT_ALTR_CUST_ID as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcAltCustIdentification\nsource(output(\n\t\tExpAddr_ID as string,\n\t\tADEX_GROUP_ID as string,\n\t\tADEX_OUT_KEY_SYS_BANK as string,\n\t\tADEX_OUT_KEY_PRIN_BANK as string,\n\t\tADEX_OUT_KEY_AGENT_BANK as string,\n\t\tADEX_OUT_KEY_ACCT_NO as string,\n\t\tADEX_TYPE_CD as string,\n\t\tADEX_MMBR_SQNC_NR as string,\n\t\tADEX_OUT_EXTR_ID as string,\n\t\tADEX_OUT_ADDR_TYPE_CD as string,\n\t\tADEX_OUT_CTGR_CD as string,\n\t\tADEX_OUT_ADDR_FRMT_CD as string,\n\t\tADEX_OUT_EFFC_BEGN_DT as string,\n\t\tADEX_OUT_EFFC_END_DT as string,\n\t\tADEX_OUT_LINE_1_TX as string,\n\t\tADEX_OUT_LINE_2_TX as string,\n\t\tADEX_OUT_CITY_NM as string,\n\t\tADEX_OUT_SBDV_1_TX as string,\n\t\tADEX_OUT_PSTL_CD as string,\n\t\tADEX_OUT_MAIL_CD as string,\n\t\tADEX_OUT_MAIL_CD_FLAG_IN as string,\n\t\tADEX_OUT_DLVR_PONT_CD as string,\n\t\tADEX_OUT_VALD_ADDR_IN as string,\n\t\tADEX_OUT_RLTN_TYPE_CD as string,\n\t\tADEX_OUT_EXPR_RESN_CD as string,\n\t\tADEX_OUT_HSTR_RTNT_CD as string,\n\t\tADEX_OUT_HOUS_NMBR_TX as string,\n\t\tADEX_OUT_HOUS_BLDG_NM as string,\n\t\tADEX_OUT_CPNY_NM as string,\n\t\tADEX_OUT_ATTN_LINE_TX as string,\n\t\tADEX_OUT_POBX_NMBR_TX as string,\n\t\tADEX_OUT_STRT_NM as string,\n\t\tADEX_OUT_LINE_3_TX as string,\n\t\tADEX_OUT_LINE_4_TX as string,\n\t\tADEX_OUT_ISO3_CTRY_CD as string,\n\t\tADEX_OUT_VLDT_CD as string,\n\t\treportDate as date 'yyyy-MM-dd',\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcExpAddr\nsource(output(\n\t\tPI_Status_ID as string,\n\t\tPRST_GROUP_ID as string,\n\t\tPRST_OUT_KEY_SYS_BANK as string,\n\t\tPRST_OUT_KEY_PRIN_BANK as string,\n\t\tPRST_OUT_KEY_AGENT_BANK as string,\n\t\tPRST_OUT_KEY_ACCT_NO as string,\n\t\tPRST_TYPE_CD as string,\n\t\tPRST_MMBR_SQNC_NR as string,\n\t\tPRST_OUT_PI_ID as string,\n\t\tPRST_OUT_DRVN_SIDE_CD as string,\n\t\tPRST_OUT_LOST_STLN_DT as string,\n\t\tPRST_OUT_ACTV_CD as string,\n\t\tPRST_OUT_PI_STTS_CD as string,\n\t\tPRST_OUT_STTS_RESN_CD as string,\n\t\tPRST_OUT_STTS_CHNG_DT as string,\n\t\tPRST_OUT_SYS_ID as string,\n\t\tPRST_OUT_PRIN_ID as string,\n\t\tPRST_OUT_AGNT_ID as string,\n\t\tPRST_OUT_TMPR_CD as string,\n\t\tPRST_OUT_PI_FRAD_STGY_DT as string,\n\t\tPRST_OUT_PI_FRAD_STGY_ID as string,\n\t\tPRST_OUT_TRMN_PRMP_OVRR_CD as string,\n\t\tPRST_OUT_TRAN_RSTR_CD as string,\n\t\tPRST_OUT_EXTR_CLSS_CD as string,\n\t\tPRST_OUT_PITC_EXTR_CLSS_ID as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcPIStatus\nsource(output(\n\t\tEmail_ID as string,\n\t\tEMAL_GROUP_ID as string,\n\t\tEMAL_OUT_KEY_SYS_BANK as string,\n\t\tEMAL_OUT_KEY_PRIN_BANK as string,\n\t\tEMAL_OUT_KEY_AGENT_BANK as string,\n\t\tEMAL_OUT_KEY_ACCT_NO as string,\n\t\tEMAL_TYPE_CD as string,\n\t\tEMAL_MMBR_SQNC_NR as string,\n\t\tEMAL_OUT_EXTR_ID as string,\n\t\tEMAL_OUT_USE_TYPE_CD as string,\n\t\tEMAL_OUT_ADDR_TX as string,\n\t\tEMAL_OUT_SLCT_IN as string,\n\t\tEMAL_OUT_ADDR_STTS_IN as string,\n\t\treportDate as string,\n\t\tdateProcessed as string,\n\t\tFDR_DATE_PROCESSED as string,\n\t\tDBI_CLIENT_NUMBER as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcEmail\nsource(output(\n\t\tAlpha2Code as string,\n\t\tShortName as string,\n\t\tShortNameLowerCase as string,\n\t\tFullName as string,\n\t\tAlpha3Code as string,\n\t\tNumericCode as string,\n\t\tDialCode as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcCountryCode\nsource(output(\n\t\tAlpha2Code as string,\n\t\tSubdivision as string,\n\t\tSubdivisionCategory as string,\n\t\t{3166_2code} as string,\n\t\tSubdivisionName as string,\n\t\tLocalVariant as string,\n\t\tLanguageCode as string,\n\t\tRoaniationSystem as string,\n\t\tParentSubdivision as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> srcCountryCodeSubdivision\nselectPIRecord derive(AccountSystemEntryDate_dcPIRecord = toDate(substring(PINS_OUT_ASSG_CRTN_DT,5,4)+'-'+substring(PINS_OUT_ASSG_CRTN_DT,1,2)+'-'+substring(PINS_OUT_ASSG_CRTN_DT,3,2),'yyyy-MM-dd'),\n\t\tExpirationDate_dcPIRecord = toDate(substring(PINS_OUT_EXPR_DT,5,4)+'-'+substring(PINS_OUT_EXPR_DT,1,2)+'-'+substring(PINS_OUT_EXPR_DT,3,2),'yyyy-MM-dd'),\n\t\tCardNum_dcPIRecord = ltrim(rtrim(CardNum_PIRecord)),\n\t\tSourceId_dcPIRecord = toString('FD')) ~> dcPIRecord\nFilterOutHeadingsIfExists derive(HomePhone_dcBalanceStatus = case(HomePhone == '0' || HomePhone == '1111111111',toString(null()),HomePhone),\n\t\tBusinessPhone_dcBalanceStatus = case(BusinessPhone == '0' || BusinessPhone == '1111111111',toString(null()),BusinessPhone),\n\t\tCrossReferenceAccountNumOne__dcBalanceStatus = case(CrossReferenceAccountNum1 != '0',CrossReferenceAccountNum1,toString(null())),\n\t\tCrossReferenceAccountNumTwo__dcBalanceStatus = case(CrossReferenceAccountNum2 != '0',CrossReferenceAccountNum2,toString(null())),\n\t\tCrossReferenceAccountNumThree__dcBalanceStatus = case(CrossReferenceAccountNum3!= '0',CrossReferenceAccountNum3,toString(null()))) ~> dcBalanceStatus\nSelectCustExpanded derive(CardHolderLastName_dcCustExpanded = case(locate(',',CUEX_OUT_CUST_NM) == 0, CUEX_OUT_CUST_NM , left(CUEX_OUT_CUST_NM, abs(locate(',',CUEX_OUT_CUST_NM)-1))),\n\t\tCardHolderFirstName_dcCustExpanded = case(locate(',',CUEX_OUT_CUST_NM) == 0, toString(null()), substring(CUEX_OUT_CUST_NM, (locate(',',CUEX_OUT_CUST_NM)+1), length(CUEX_OUT_CUST_NM))),\n\t\tBirthDate_dcCustExpanded = case(substring(BirthDate,5,4) == '0001' || substring(BirthDate,5,4) == '0000', toDate(''), toDate(substring(BirthDate,5,4)+'-'+substring(BirthDate,1,2)+'-'+substring(BirthDate,3,2),'yyyy-MM-dd'))) ~> dcCustExpanded\ntrimBlankSpacesPIStatus derive(CardStatusChangeDate = toDate(case(CardStatusChangeDate != '01010001', substring(CardStatusChangeDate,5,4)+'-'+substring(CardStatusChangeDate,1,2)+'-'+substring(CardStatusChangeDate,3,2), toString(null())),'yyyy-MM-dd'),\n\t\tCardStatus = case(CardStatus != '', CardStatus, toString(null()))) ~> dcPIStatus\ntrimBlankSpacesPIRecord select(mapColumn(\n\t\tPI_Record_ID,\n\t\tAccountNum_PIRecord = PINS_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_PIRecord = PINS_TYPE_CD,\n\t\tCardHolderPositionCd_PIRecord = PINS_MMBR_SQNC_NR,\n\t\tCardNum_PIRecord = PINS_OUT_PI_ID,\n\t\tPINS_OUT_ASSG_CRTN_DT,\n\t\tPINS_OUT_EXPR_DT,\n\t\tReportDate_SelectPIRecord = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectPIRecord\nsrcBalanceStatus select(mapColumn(\n\t\tBalanceStatus_ID,\n\t\tAccountNum_BalanceStatus = ACCT_NO,\n\t\tCardsIssuedCnt = NUMBER_OF_PLASTICS_X,\n\t\tAddress1LineOne_BalanceStatus = ADDR_LINE_1,\n\t\tAddress1LineTwo_BalanceStatus = ADDR_LINE_2,\n\t\tAddress1City_BalanceStatus = CITY,\n\t\tAddress1State_BalanceStatus = STATE,\n\t\tAddress1ZipCode_BalanceStatus = ZIP_CODE,\n\t\tStatementCycleCd = CYCLE_CODE,\n\t\tExternalStatus = EXTERNAL_STATUS,\n\t\tInternalStatus = INTERNAL_STATUS,\n\t\tCrossReferenceAccountNum1 = CROSS_REF_ACCT_NO,\n\t\tCrossReferenceAccountNum2 = CROSS_REF_ACCT_NO_1,\n\t\tCrossReferenceAccountNum3 = CROSS_REF_ACCT_NO_2,\n\t\tHomePhone = HOME_TELEPHONE_NUMBER,\n\t\tBusinessPhone = BUSINESS_TELEPHONE_NUMBER,\n\t\tCheckingAccountNum = CHECKING_ACCOUNT_NUMBER,\n\t\tSavingsAccountNum = SAVINGS_ACCOUNT_NUMBER,\n\t\tAccountBalance = CURRENT_BALANCE,\n\t\tReportDate_BalanceStatus = ReportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectBalanceStatus\ndcPIRecord, SelectBalanceStatusAll join(AccountNum_PIRecord == AccountNum_SelectBalanceStatusAll,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> ijBalanceStatus\nscrCustExpanded select(mapColumn(\n\t\tCustExpanded_ID,\n\t\tAccountNum_CustExpanded = CUEX_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_CustExpanded = CUEX_TYPE_CD,\n\t\tCardHolderPositionCd_CustExpanded = CUEX_MMBR_SQNC_NR,\n\t\tCUEX_OUT_CUST_NM,\n\t\tBirthDate = CUEX_OUT_BRTH_DT,\n\t\tReportDate = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCustExpanded\nijBalanceStatus, dcRequiredValues join(AccountNum_PIRecord == AccountNum_CustExpanded\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_CustExpanded\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_CustExpanded,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> ijCustExpanded\nFilterAltCustIdentification select(mapColumn(\n\t\tAltCustIdentification_ID,\n\t\tAccountNum_AltCustIdentification = ALTC_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_AltCustIdentification = ALTC_TYPE_CD,\n\t\tCardHolderPositionCd_AltCustIdentification = ALTC_MMBR_SQNC_NR,\n\t\tSocialSecurtyNum_AltCustIdentification = ALTC_OUT_ALTR_CUST_ID,\n\t\tReportDate_AltCustIdentification = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectAltCustIdentification\nsrcExpAddr select(mapColumn(\n\t\tExpAddr_ID,\n\t\tAccountNum_ExpAddr = ADEX_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_ExpAddr = ADEX_TYPE_CD,\n\t\tCardHolderPositionCd_ExpAddr = ADEX_MMBR_SQNC_NR,\n\t\tADEX_OUT_EFFC_BEGN_DT,\n\t\tADEX_OUT_EFFC_END_DT,\n\t\tAddress1LineOne_ExpAddr = ADEX_OUT_LINE_1_TX,\n\t\tAddress1LineTwo_ExpAddr = ADEX_OUT_LINE_2_TX,\n\t\tAddress1City_ExpAddr = ADEX_OUT_CITY_NM,\n\t\tAddress1State_ExpAddr = ADEX_OUT_SBDV_1_TX,\n\t\tAddress1ZipCode_ExpAddr = ADEX_OUT_PSTL_CD,\n\t\tReportDate_ExpAddr = reportDate,\n\t\tADEX_OUT_ADDR_TYPE_CD,\n\t\tADEX_OUT_CTGR_CD,\n\t\tAddress1CountryCode3_ExpAddr = ADEX_OUT_ISO3_CTRY_CD,\n\t\tAddress1LineThree_SelectExpAddr = ADEX_OUT_LINE_3_TX,\n\t\tAddress1LineFour_SelectExpAddr = ADEX_OUT_LINE_4_TX\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectExpAddr\nsrcPIStatus select(mapColumn(\n\t\tPI_Status_ID,\n\t\tAccountNum_PIStatus = PRST_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_PIStatus = PRST_TYPE_CD,\n\t\tCardHolderPositionCd_PIStatus = PRST_MMBR_SQNC_NR,\n\t\tCardNum_PIStatus = PRST_OUT_PI_ID,\n\t\tCardStatus = PRST_OUT_PI_STTS_CD,\n\t\tCardStatusChangeDate = PRST_OUT_STTS_CHNG_DT,\n\t\tReportDate = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPIStatus\nlojAltCustIdentification, dcPIStatus join(CardNum_dcPIRecord == CardNum_PIStatus\n\t&& AccountNum_PIRecord == AccountNum_PIStatus\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_PIStatus\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_PIStatus,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> lojPIStatus\ntrimBlankSpacesPIRecord select(mapColumn(\n\t\tAccountNum_PIRecordEmail = PINS_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_PIRecordEmail = PINS_TYPE_CD,\n\t\tCardHolderPositionCd_PIRecordEmail = PINS_MMBR_SQNC_NR,\n\t\tReportDate_PIRecordEmail = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPIRecordForEmail\nSelectPIRecordForEmail aggregate(groupBy(AccountNum_PIRecordEmail,\n\t\tCardHolder_Type_Cd_PIRecordEmail,\n\t\tCardHolderPositionCd_PIRecordEmail),\n\tReportDate_LastPIRecordEmail = last(ReportDate_PIRecordEmail)) ~> DistinctPIRecordAccount\nsrcEmail select(mapColumn(\n\t\tEmail_ID,\n\t\tAccountNum_Email = EMAL_OUT_KEY_ACCT_NO,\n\t\tCardHolder_Type_Cd_Email = EMAL_TYPE_CD,\n\t\tCardHolderPositionCd_Email = EMAL_MMBR_SQNC_NR,\n\t\tEmailUseTypeCd = EMAL_OUT_USE_TYPE_CD,\n\t\tEmailAddress = EMAL_OUT_ADDR_TX,\n\t\tEmailAddressStatus = EMAL_OUT_ADDR_STTS_IN,\n\t\tReportDate_Email = reportDate\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectEmail\nDistinctPIRecordAccount, trimBlankSpacesEmail join(AccountNum_PIRecordEmail == AccountNum_Email\n\t&& CardHolder_Type_Cd_PIRecordEmail == CardHolder_Type_Cd_Email\n\t&& CardHolderPositionCd_PIRecordEmail == CardHolderPositionCd_Email,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> ijEmail\nsrcPIRecord derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesPIRecord\nSelectEmail derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesEmail\nSelectBalanceStatus derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesBalanceStatus\ndcCustExpanded derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesCustExpanded\nSelectAltCustIdentification derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesAltCustIdentification\nFilterExpAddr derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',toString($$),toString(null()))))) ~> trimBlankSpacesExpAddr\nSelectPIStatus derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',$$,toString(null()))))) ~> trimBlankSpacesPIStatus\nsrcAltCustIdentification filter(ALTC_OUT_ID_TYPE_CD == '07') ~> FilterAltCustIdentification\nijCustExpanded, trimBlankSpacesAltCustIdentification join(AccountNum_PIRecord == AccountNum_AltCustIdentification\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_AltCustIdentification\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_AltCustIdentification,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> lojAltCustIdentification\nSelectExpAddr filter(ADEX_OUT_ADDR_TYPE_CD == 'BLL1' && toDate(substring(ADEX_OUT_EFFC_BEGN_DT,5,4)+'-'+substring(ADEX_OUT_EFFC_BEGN_DT,1,2)+'-'+substring(ADEX_OUT_EFFC_BEGN_DT,3,2),'yyyy-MM-dd') <= ReportDate_ExpAddr && ADEX_OUT_CTGR_CD == 'P') ~> FilterExpAddr\ntrimBlankSpacesExpAddr derive(Address1LineTwo_dcExpAddr = case(length(toString(Address1LineTwo_ExpAddr)) < 2, toString(null()), Address1LineTwo_ExpAddr),\n\t\tAddress1CountryAlpha3_dcExpAddr = case(isNull(Address1CountryCode3_ExpAddr)==true() && (left(Address1LineThree_SelectExpAddr,3)=='CAN' || left(Address1LineFour_SelectExpAddr,3)=='CAN'), \r\n    'CAN',\r\n    (case(isNull(Address1CountryCode3_ExpAddr)==true() && (left(Address1LineThree_SelectExpAddr,3)=='USA' || left(Address1LineFour_SelectExpAddr,3)=='USA'), \r\n    'USA',\r\n    Address1CountryCode3_ExpAddr)\r\n))) ~> dcExpAddr\ndcAddressBAST select(mapColumn(\n\t\tCardHolderLastName__BASTAddrPrimary = CardHolderLastName_dcRequiredValues,\n\t\tCardHolderFirstName__BASTAddrPrimary = CardHolderFirstName_dcCustExpanded,\n\t\tSocialSecurtyNum__BASTAddrPrimary = SocialSecurtyNum_AltCustIdentification,\n\t\tBirthDate__BASTAddrPrimary = BirthDate_dcCustExpanded,\n\t\tAddress1LineOne__BASTAddrPrimary = Address1LineOne_SelectBalanceStatusAll,\n\t\tAddress1LineTwo__BASTAddrPrimary = Address1LineTwo_SelectBalanceStatusAll,\n\t\tAddress1City__BASTAddrPrimary = Address1City_SelectBalanceStatusAll,\n\t\tAddress1State__BASTAddrPrimary = Address1State_SelectBalanceStatusAll,\n\t\tAddress1ZipCode__BASTAddrPrimary = Address1ZipCode_SelectBalanceStatusAll,\n\t\tHomePhone__BASTAddrPrimary = HomePhone_SelectBalanceStatusAll,\n\t\tBusinessPhone__BASTAddrPrimary = BusinessPhone_SelectBalanceStatusAll,\n\t\tCheckingAccountNum__BASTAddrPrimary = CheckingAccountNum_SelectBalanceStatusAll,\n\t\tSavingsAccountNum__BASTAddrPrimary = SavingsAccountNum_SelectBalanceStatusAll,\n\t\tCardNum__BASTAddrPrimary = CardNum_PIRecord,\n\t\tAccountNum__BASTAddrPrimary = AccountNum_PIRecord,\n\t\tCardHolder_Type_Cd__BASTAddrPrimary = CardHolder_Type_Cd_PIRecord,\n\t\tCardHolderPositionCd__BASTAddrPrimary = CardHolderPositionCd_PIRecord,\n\t\tAccountSystemEntryDate__BASTAddrPrimary = AccountSystemEntryDate_dcPIRecord,\n\t\tExpirationDate__BASTAddrPrimary = ExpirationDate_dcPIRecord,\n\t\tCardsIssuedCnt__BASTAddrPrimary = CardsIssuedCnt_SelectBalanceStatusAll,\n\t\tStatementCycleCd__BASTAddrPrimary = StatementCycleCd_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum1__BASTAddrPrimary = CrossReferenceAccountNumOne_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum2__BASTAddrPrimary = CrossReferenceAccountNumTwo_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum3__BASTAddrPrimary = CrossReferenceAccountNumThree_SelectBalanceStatusAll,\n\t\tAccountBalance__BASTAddrPrimary = AccountBalance_SelectBalanceStatusAll,\n\t\tExternalStatus__BASTAddrPrimary = ExternalStatus_SelectBalanceStatusAll,\n\t\tInternalStatus__BASTAddrPrimary = InternalStatus_SelectBalanceStatusAll,\n\t\tCardStatus__BASTAddrPrimary = CardStatus,\n\t\tCardStatusChangeDate__BASTAddrPrimary = CardStatusChangeDate,\n\t\tSourceId__BASTAddrPrimary = SourceId_dcPIRecord,\n\t\tReportDate_BASTAddrPrimary = ReportDate_SelectPIRecord,\n\t\tAddress1CountryAlpha3_BASTAddrPrimary = Alpha3Code_SelectBalanceStatusAll,\n\t\tAddress1CountryNumeric_BASTAddrPrimary = NumericCode_SelectBalanceStatusAll,\n\t\tAddressSource_BASTAddrPrimary = AddressSource_dcAddressBAST\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> BASTAddrPrimaryOnly\nNotExistsExpAddrPrimary filter(CardHolder_Type_Cd_PIRecord == '01' && CardHolderPositionCd_PIRecord == '001') ~> FilterBASTAddrPrimaryOnly\nlojPIStatus, SelectExpAddrAll exists(AccountNum_PIRecord == AccountNum_SelectExpAddrAll\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_SelectExpAddrAll\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_SelectExpAddrAll,\n\tnegate:true,\n\tbroadcast: 'auto')~> NotExistsExpAddrPrimary\nlojPIStatus, SelectExpAddrAll exists(AccountNum_PIRecord == AccountNum_SelectExpAddrAll\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_SelectExpAddrAll\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_SelectExpAddrAll,\n\tnegate:false,\n\tbroadcast: 'auto')~> ExistsExpAddr\ndcAddressExpAddr select(mapColumn(\n\t\tCardHolderLastName_ExpAddrFinal = CardHolderLastName_dcRequiredValues,\n\t\tCardHolderFirstName_ExpAddrFinal = CardHolderFirstName_dcCustExpanded,\n\t\tSocialSecurtyNum_ExpAddrFinal = SocialSecurtyNum_AltCustIdentification,\n\t\tBirthDate_ExpAddrFinal = BirthDate_dcCustExpanded,\n\t\tAddress1LineOne_ExpAddrFinal = Address1LineOne_SelectExpAddrAll,\n\t\tAddress1LineTwo_ExpAddrFinal = Address1LineTwo_SelectExpAddrAll,\n\t\tAddress1City_ExpAddrFinal = Address1City_SelectExpAddrAll,\n\t\tAddress1State_ExpAddrFinal = Address1State_SelectExpAddrAll,\n\t\tAddress1ZipCode_ExpAddrFinal = Address1ZipCode_SelectExpAddrAll,\n\t\tHomePhone_ExpAddrFinal = HomePhone_SelectBalanceStatusAll,\n\t\tBusinessPhone_ExpAddrFinal = BusinessPhone_SelectBalanceStatusAll,\n\t\tCheckingAccountNum_ExpAddrFinal = CheckingAccountNum_SelectBalanceStatusAll,\n\t\tSavingsAccountNum_ExpAddrFinal = SavingsAccountNum_SelectBalanceStatusAll,\n\t\tCardNum_ExpAddrFinal = CardNum_PIRecord,\n\t\tAccountNum_ExpAddrFinal = AccountNum_PIRecord,\n\t\tCardHolder_Type_Cd_ExpAddrFinal = CardHolder_Type_Cd_PIRecord,\n\t\tCardHolderPositionCd_ExpAddrFinal = CardHolderPositionCd_PIRecord,\n\t\tAccountSystemEntryDate_ExpAddrFinal = AccountSystemEntryDate_dcPIRecord,\n\t\tExpirationDate_ExpAddrFinal = ExpirationDate_dcPIRecord,\n\t\tCardsIssuedCnt_ExpAddrFinal = CardsIssuedCnt_SelectBalanceStatusAll,\n\t\tStatementCycleCd_ExpAddrFinal = StatementCycleCd_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum1_ExpAddrFinal = CrossReferenceAccountNumOne_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum2_ExpAddrFinal = CrossReferenceAccountNumTwo_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum3_ExpAddrFinal = CrossReferenceAccountNumThree_SelectBalanceStatusAll,\n\t\tAccountBalance_ExpAddrFinal = AccountBalance_SelectBalanceStatusAll,\n\t\tExternalStatus_ExpAddrFinal = ExternalStatus_SelectBalanceStatusAll,\n\t\tInternalStatus_ExpAddrFinal = InternalStatus_SelectBalanceStatusAll,\n\t\tCardStatus_ExpAddrFinal = CardStatus,\n\t\tCardStatusChangeDate_ExpAddrFinal = CardStatusChangeDate,\n\t\tSourceId_ExpAddrFinal = SourceId_dcPIRecord,\n\t\tReportDate_ExpAddrFinal = ReportDate_SelectPIRecord,\n\t\tAddress1CountryAlpha3_ExpAddrFinal = Address1CountryCode3_SelectExpAddrAll,\n\t\tAddress1CountryNumeric_ExpAddrFinal = NumericCode_SelectExpAddrAll,\n\t\tAddressSource_ExpAddrFinal = AddressSource_dcAddressExpAddr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ExpAddrFinal\nExistsExpAddr, SelectExpAddrAll join(AccountNum_PIRecord == AccountNum_SelectExpAddrAll\n\t&& CardHolder_Type_Cd_PIRecord == CardHolder_Type_Cd_SelectExpAddrAll\n\t&& CardHolderPositionCd_PIRecord == CardHolderPositionCd_SelectExpAddrAll,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> ijExpAddr\nNotExistsExpAddrPrimary filter(not(CardHolder_Type_Cd_PIRecord == '01' && CardHolderPositionCd_PIRecord == '001')) ~> FilterNoAddr\ndcAddressNoAddr select(mapColumn(\n\t\tCardHolderLastName_NoAddr = CardHolderLastName_dcRequiredValues,\n\t\tCardHolderFirstName_NoAddr = CardHolderFirstName_dcCustExpanded,\n\t\tSocialSecurtyNum_NoAddr = SocialSecurtyNum_AltCustIdentification,\n\t\tBirthDate_NoAddr = BirthDate_dcCustExpanded,\n\t\tHomePhone_NoAddr = HomePhone_SelectBalanceStatusAll,\n\t\tBusinessPhone_NoAddr = BusinessPhone_SelectBalanceStatusAll,\n\t\tCheckingAccountNum_NoAddr = CheckingAccountNum_SelectBalanceStatusAll,\n\t\tSavingsAccountNum_NoAddr = SavingsAccountNum_SelectBalanceStatusAll,\n\t\tCardNum_NoAddr = CardNum_PIRecord,\n\t\tAccountNum_NoAddr = AccountNum_PIRecord,\n\t\tCardHolder_Type_Cd_NoAddr = CardHolder_Type_Cd_PIRecord,\n\t\tCardHolderPositionCd_NoAddr = CardHolderPositionCd_PIRecord,\n\t\tAccountSystemEntryDate_NoAddr = AccountSystemEntryDate_dcPIRecord,\n\t\tExpirationDate_NoAddr = ExpirationDate_dcPIRecord,\n\t\tCardsIssuedCnt_NoAddr = CardsIssuedCnt_SelectBalanceStatusAll,\n\t\tStatementCycleCd_NoAddr = StatementCycleCd_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum1_NoAddr = CrossReferenceAccountNumOne_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum2_NoAddr = CrossReferenceAccountNumTwo_SelectBalanceStatusAll,\n\t\tCrossReferenceAccountNum3_NoAddr = CrossReferenceAccountNumThree_SelectBalanceStatusAll,\n\t\tAccountBalance_NoAddr = AccountBalance_SelectBalanceStatusAll,\n\t\tExternalStatus_NoAddr = ExternalStatus_SelectBalanceStatusAll,\n\t\tInternalStatus_NoAddr = InternalStatus_SelectBalanceStatusAll,\n\t\tCardStatus_NoAddr = CardStatus,\n\t\tCardStatusChangeDate_NoAddr = CardStatusChangeDate,\n\t\tSourceId_NoAddr = SourceId_dcPIRecord,\n\t\tReportDate_NoAddr = ReportDate_SelectPIRecord,\n\t\tAddressSource_NoAddr = AddressSource_dcAddressNoAddr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> NoAddr\ntrimBlankSpacesCustExpanded derive(CardHolderLastName_dcRequiredValues = iifNull(CardHolderLastName_dcCustExpanded, 'Unknown')) ~> dcRequiredValues\ndcExpAddr, SelectCountryAll lookup(Address1CountryAlpha3_dcExpAddr == Alpha3Code_SelectCountryAll,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupExpAddrCountry\nsrcCountryCode select(mapColumn(\n\t\tAlpha2Code_SelectCountry = Alpha2Code,\n\t\tAlpha3Code_SelectCountry = Alpha3Code,\n\t\tNumericCode_SelectCountry = NumericCode,\n\t\tDialCode_SelectCountry = DialCode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCountry\nSelectCountry derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',toString($$),toString(null()))))) ~> trimBlankSpaceCountry\nijCountrySubdivision derive(NumericCode_dcCountrySubdivision = toShort(NumericCode_SelectCountry)) ~> dcCountrySubdivision\ndcBalanceStatus, SelectCountryAll lookup(Address1State_BalanceStatus == Subdivision_SelectCountryAll,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupSubdivisionBalanceStatus\nSelectSubdivision derive(each(match(type=='string'), $$ = trim(iif(toString($$)!='NULL',toString($$),toString(null()))))) ~> trimBlankSpaceSubdivision\nsrcCountryCodeSubdivision select(mapColumn(\n\t\tAlpha2Code_SelectSubdivision = Alpha2Code,\n\t\tAlpha2Code_Subdivision_SelectSubdivision = {3166_2code},\n\t\tSubdivision_SelectSubdivision = Subdivision\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSubdivision\ntrimBlankSpaceCountry, trimBlankSpaceSubdivision join(Alpha2Code_SelectCountry == Alpha2Code_SelectSubdivision,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> ijCountrySubdivision\ndcCountrySubdivision select(mapColumn(\n\t\tAlpha2Code_SelectCountryAll = Alpha2Code_SelectCountry,\n\t\tAlpha3Code_SelectCountryAll = Alpha3Code_SelectCountry,\n\t\tNumericCode_SelectCountryAll = NumericCode_dcCountrySubdivision,\n\t\tDialCode_SelectCountryAll = DialCode_SelectCountry,\n\t\tAlpha2Code_Subdivision_SelectCountryAll = Alpha2Code_Subdivision_SelectSubdivision,\n\t\tSubdivision_SelectCountryAll = Subdivision_SelectSubdivision\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectCountryAll\nLookupExpAddrCountry select(mapColumn(\n\t\tExpAddr_ID_SelectExpAddrAll = ExpAddr_ID,\n\t\tAccountNum_SelectExpAddrAll = AccountNum_ExpAddr,\n\t\tCardHolder_Type_Cd_SelectExpAddrAll = CardHolder_Type_Cd_ExpAddr,\n\t\tCardHolderPositionCd_SelectExpAddrAll = CardHolderPositionCd_ExpAddr,\n\t\tADEX_OUT_EFFC_BEGN_DT_SelectExpAddrAll = ADEX_OUT_EFFC_BEGN_DT,\n\t\tADEX_OUT_EFFC_END_DT_SelectExpAddrAll = ADEX_OUT_EFFC_END_DT,\n\t\tAddress1LineOne_SelectExpAddrAll = Address1LineOne_ExpAddr,\n\t\tAddress1LineTwo_SelectExpAddrAll = Address1LineTwo_ExpAddr,\n\t\tAddress1City_SelectExpAddrAll = Address1City_ExpAddr,\n\t\tAddress1State_SelectExpAddrAll = Address1State_ExpAddr,\n\t\tAddress1ZipCode_SelectExpAddrAll = Address1ZipCode_ExpAddr,\n\t\tReportDate_SelectExpAddrAll = ReportDate_ExpAddr,\n\t\tADEX_OUT_ADDR_TYPE_CD_SelectExpAddrAll = ADEX_OUT_ADDR_TYPE_CD,\n\t\tADEX_OUT_CTGR_CD_SelectExpAddrAll = ADEX_OUT_CTGR_CD,\n\t\tAddress1CountryCode3_SelectExpAddrAll = Address1CountryCode3_ExpAddr,\n\t\tAddress1LineTwo_SelectExpAddrAll = Address1LineTwo_dcExpAddr,\n\t\tAlpha2Code_SelectExpAddrAll = Alpha2Code_SelectCountryAll,\n\t\tAlpha3Code_SelectExpAddrAll = Alpha3Code_SelectCountryAll,\n\t\tNumericCode_SelectExpAddrAll = NumericCode_SelectCountryAll,\n\t\tDialCode_SelectExpAddrAll = DialCode_SelectCountryAll,\n\t\tAlpha2Code_Subdivision_SelectExpAddrAll = Alpha2Code_Subdivision_SelectCountryAll\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectExpAddrAll\nLookupSubdivisionBalanceStatus select(mapColumn(\n\t\tBalanceStatus_ID_SelectBalanceStatusAll = BalanceStatus_ID,\n\t\tAccountNum_SelectBalanceStatusAll = AccountNum_BalanceStatus,\n\t\tCardsIssuedCnt_SelectBalanceStatusAll = CardsIssuedCnt,\n\t\tAddress1LineOne_SelectBalanceStatusAll = Address1LineOne_BalanceStatus,\n\t\tAddress1LineTwo_SelectBalanceStatusAll = Address1LineTwo_BalanceStatus,\n\t\tAddress1City_SelectBalanceStatusAll = Address1City_BalanceStatus,\n\t\tAddress1State_SelectBalanceStatusAll = Address1State_BalanceStatus,\n\t\tAddress1ZipCode_SelectBalanceStatusAll = Address1ZipCode_BalanceStatus,\n\t\tStatementCycleCd_SelectBalanceStatusAll = StatementCycleCd,\n\t\tExternalStatus_SelectBalanceStatusAll = ExternalStatus,\n\t\tInternalStatus_SelectBalanceStatusAll = InternalStatus,\n\t\tHomePhone_SelectBalanceStatusAll = HomePhone_dcBalanceStatus,\n\t\tBusinessPhone_SelectBalanceStatusAll = BusinessPhone_dcBalanceStatus,\n\t\tCheckingAccountNum_SelectBalanceStatusAll = CheckingAccountNum,\n\t\tSavingsAccountNum_SelectBalanceStatusAll = SavingsAccountNum,\n\t\tAccountBalance_SelectBalanceStatusAll = AccountBalance,\n\t\tReportDate_SelectBalanceStatusAll = ReportDate_BalanceStatus,\n\t\tHomePhone_SelectBalanceStatusAll = HomePhone_dcBalanceStatus,\n\t\tBusinessPhone_SelectBalanceStatusAll = BusinessPhone_dcBalanceStatus,\n\t\tCrossReferenceAccountNumOne_SelectBalanceStatusAll = CrossReferenceAccountNumOne__dcBalanceStatus,\n\t\tCrossReferenceAccountNumTwo_SelectBalanceStatusAll = CrossReferenceAccountNumTwo__dcBalanceStatus,\n\t\tCrossReferenceAccountNumThree_SelectBalanceStatusAll = CrossReferenceAccountNumThree__dcBalanceStatus,\n\t\tAlpha2Code_SelectBalanceStatusAll = Alpha2Code_SelectCountryAll,\n\t\tAlpha3Code_SelectBalanceStatusAll = Alpha3Code_SelectCountryAll,\n\t\tNumericCode_SelectBalanceStatusAll = NumericCode_SelectCountryAll,\n\t\tDialCode_SelectBalanceStatusAll = DialCode_SelectCountryAll,\n\t\tAlpha2Code_Subdivision_SelectBalanceStatusAll = Alpha2Code_Subdivision_SelectCountryAll\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectBalanceStatusAll\ntrimBlankSpacesBalanceStatus filter(BalanceStatus_ID != 'BalanceStatus_Daily_ArchiveID') ~> FilterOutHeadingsIfExists\nijExpAddr derive(AddressSource_dcAddressExpAddr = 'ExpAddr') ~> dcAddressExpAddr\nFilterNoAddr derive(AddressSource_dcAddressNoAddr = 'NoAddr') ~> dcAddressNoAddr\nFilterBASTAddrPrimaryOnly derive(AddressSource_dcAddressBAST = 'BalanceStatus') ~> dcAddressBAST\nBASTAddrPrimaryOnly sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCardHolderId as long,\n\t\tCardHolderLastName as string,\n\t\tCardHolderFirstName as string,\n\t\tSocialSecurtyNum as string,\n\t\tBirthDate as date,\n\t\tAddress1LineOne as string,\n\t\tAddress1LineTwo as string,\n\t\tAddress1City as string,\n\t\tAddress1State as string,\n\t\tAddress1ZipCode as string,\n\t\tHomePhone as string,\n\t\tBusinessPhone as string,\n\t\tCheckingAccountNum as string,\n\t\tSavingsAccountNum as string,\n\t\tCardNum as string,\n\t\tAccountNum as string,\n\t\tCardHolder_Type_Cd as string,\n\t\tCardHolderPositionCd as string,\n\t\tAccountSystemEntryDate as date,\n\t\tExpirationDate as date,\n\t\tCardsIssuedCnt as string,\n\t\tStatementCycleCd as string,\n\t\tCrossReferenceAccountNum1 as string,\n\t\tCrossReferenceAccountNum2 as string,\n\t\tCrossReferenceAccountNum3 as string,\n\t\tAccountBalance as decimal(19,4),\n\t\tExternalStatus as string,\n\t\tInternalStatus as string,\n\t\tCardStatus as string,\n\t\tCardStatusChangeDate as date,\n\t\tSourceId as string,\n\t\tReportDate as date,\n\t\tLoadDate as timestamp,\n\t\tAddress1CountryAlpha3 as string,\n\t\tAddress1CountryNumeric as integer,\n\t\tAddressSource as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCardHolderLastName = CardHolderLastName__BASTAddrPrimary,\n\t\tCardHolderFirstName = CardHolderFirstName__BASTAddrPrimary,\n\t\tSocialSecurtyNum = SocialSecurtyNum__BASTAddrPrimary,\n\t\tBirthDate = BirthDate__BASTAddrPrimary,\n\t\tAddress1LineOne = Address1LineOne__BASTAddrPrimary,\n\t\tAddress1LineTwo = Address1LineTwo__BASTAddrPrimary,\n\t\tAddress1City = Address1City__BASTAddrPrimary,\n\t\tAddress1State = Address1State__BASTAddrPrimary,\n\t\tAddress1ZipCode = Address1ZipCode__BASTAddrPrimary,\n\t\tHomePhone = HomePhone__BASTAddrPrimary,\n\t\tBusinessPhone = BusinessPhone__BASTAddrPrimary,\n\t\tCheckingAccountNum = CheckingAccountNum__BASTAddrPrimary,\n\t\tSavingsAccountNum = SavingsAccountNum__BASTAddrPrimary,\n\t\tCardNum = CardNum__BASTAddrPrimary,\n\t\tAccountNum = AccountNum__BASTAddrPrimary,\n\t\tCardHolder_Type_Cd = CardHolder_Type_Cd__BASTAddrPrimary,\n\t\tCardHolderPositionCd = CardHolderPositionCd__BASTAddrPrimary,\n\t\tAccountSystemEntryDate = AccountSystemEntryDate__BASTAddrPrimary,\n\t\tExpirationDate = ExpirationDate__BASTAddrPrimary,\n\t\tCardsIssuedCnt = CardsIssuedCnt__BASTAddrPrimary,\n\t\tStatementCycleCd = StatementCycleCd__BASTAddrPrimary,\n\t\tCrossReferenceAccountNum1 = CrossReferenceAccountNum1__BASTAddrPrimary,\n\t\tCrossReferenceAccountNum2 = CrossReferenceAccountNum2__BASTAddrPrimary,\n\t\tCrossReferenceAccountNum3 = CrossReferenceAccountNum3__BASTAddrPrimary,\n\t\tAccountBalance = AccountBalance__BASTAddrPrimary,\n\t\tExternalStatus = ExternalStatus__BASTAddrPrimary,\n\t\tInternalStatus = InternalStatus__BASTAddrPrimary,\n\t\tCardStatus = CardStatus__BASTAddrPrimary,\n\t\tCardStatusChangeDate = CardStatusChangeDate__BASTAddrPrimary,\n\t\tSourceId = SourceId__BASTAddrPrimary,\n\t\tReportDate = ReportDate_BASTAddrPrimary,\n\t\tAddress1CountryAlpha3 = Address1CountryAlpha3_BASTAddrPrimary,\n\t\tAddress1CountryNumeric = Address1CountryNumeric_BASTAddrPrimary,\n\t\tAddressSource = AddressSource_BASTAddrPrimary\n\t)) ~> snkCardHolderWithBASTAddr\nijEmail sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCardHolderEmailId as long,\n\t\tAccountNum as string,\n\t\tCardHolder_Type_Cd as string,\n\t\tCardHolderPositionCd as string,\n\t\tEmailAddress as string,\n\t\tEmailAddressStatus as string,\n\t\tEmailUseTypeCd as string,\n\t\tReportDate as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tAccountNum = AccountNum_PIRecordEmail,\n\t\tCardHolder_Type_Cd = CardHolder_Type_Cd_PIRecordEmail,\n\t\tCardHolderPositionCd = CardHolderPositionCd_PIRecordEmail,\n\t\tEmailAddress,\n\t\tEmailAddressStatus,\n\t\tEmailUseTypeCd,\n\t\tReportDate = ReportDate_LastPIRecordEmail\n\t)) ~> snkCardHolderEmail\nExpAddrFinal sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCardHolderId as long,\n\t\tCardHolderLastName as string,\n\t\tCardHolderFirstName as string,\n\t\tSocialSecurtyNum as string,\n\t\tBirthDate as date,\n\t\tAddress1LineOne as string,\n\t\tAddress1LineTwo as string,\n\t\tAddress1City as string,\n\t\tAddress1State as string,\n\t\tAddress1ZipCode as string,\n\t\tHomePhone as string,\n\t\tBusinessPhone as string,\n\t\tCheckingAccountNum as string,\n\t\tSavingsAccountNum as string,\n\t\tCardNum as string,\n\t\tAccountNum as string,\n\t\tCardHolder_Type_Cd as string,\n\t\tCardHolderPositionCd as string,\n\t\tAccountSystemEntryDate as date,\n\t\tExpirationDate as date,\n\t\tCardsIssuedCnt as string,\n\t\tStatementCycleCd as string,\n\t\tCrossReferenceAccountNum1 as string,\n\t\tCrossReferenceAccountNum2 as string,\n\t\tCrossReferenceAccountNum3 as string,\n\t\tAccountBalance as decimal(19,4),\n\t\tExternalStatus as string,\n\t\tInternalStatus as string,\n\t\tCardStatus as string,\n\t\tCardStatusChangeDate as date,\n\t\tSourceId as string,\n\t\tReportDate as date,\n\t\tLoadDate as timestamp,\n\t\tAddress1CountryAlpha3 as string,\n\t\tAddress1CountryNumeric as integer,\n\t\tAddressSource as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 2,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCardHolderLastName = CardHolderLastName_ExpAddrFinal,\n\t\tCardHolderFirstName = CardHolderFirstName_ExpAddrFinal,\n\t\tSocialSecurtyNum = SocialSecurtyNum_ExpAddrFinal,\n\t\tBirthDate = BirthDate_ExpAddrFinal,\n\t\tAddress1LineOne = Address1LineOne_ExpAddrFinal,\n\t\tAddress1LineTwo = Address1LineTwo_ExpAddrFinal,\n\t\tAddress1City = Address1City_ExpAddrFinal,\n\t\tAddress1State = Address1State_ExpAddrFinal,\n\t\tAddress1ZipCode = Address1ZipCode_ExpAddrFinal,\n\t\tHomePhone = HomePhone_ExpAddrFinal,\n\t\tBusinessPhone = BusinessPhone_ExpAddrFinal,\n\t\tCheckingAccountNum = CheckingAccountNum_ExpAddrFinal,\n\t\tSavingsAccountNum = SavingsAccountNum_ExpAddrFinal,\n\t\tCardNum = CardNum_ExpAddrFinal,\n\t\tAccountNum = AccountNum_ExpAddrFinal,\n\t\tCardHolder_Type_Cd = CardHolder_Type_Cd_ExpAddrFinal,\n\t\tCardHolderPositionCd = CardHolderPositionCd_ExpAddrFinal,\n\t\tAccountSystemEntryDate = AccountSystemEntryDate_ExpAddrFinal,\n\t\tExpirationDate = ExpirationDate_ExpAddrFinal,\n\t\tCardsIssuedCnt = CardsIssuedCnt_ExpAddrFinal,\n\t\tStatementCycleCd = StatementCycleCd_ExpAddrFinal,\n\t\tCrossReferenceAccountNum1 = CrossReferenceAccountNum1_ExpAddrFinal,\n\t\tCrossReferenceAccountNum2 = CrossReferenceAccountNum2_ExpAddrFinal,\n\t\tCrossReferenceAccountNum3 = CrossReferenceAccountNum3_ExpAddrFinal,\n\t\tAccountBalance = AccountBalance_ExpAddrFinal,\n\t\tExternalStatus = ExternalStatus_ExpAddrFinal,\n\t\tInternalStatus = InternalStatus_ExpAddrFinal,\n\t\tCardStatus = CardStatus_ExpAddrFinal,\n\t\tCardStatusChangeDate = CardStatusChangeDate_ExpAddrFinal,\n\t\tSourceId = SourceId_ExpAddrFinal,\n\t\tReportDate = ReportDate_ExpAddrFinal,\n\t\tAddress1CountryAlpha3 = Address1CountryAlpha3_ExpAddrFinal,\n\t\tAddress1CountryNumeric = Address1CountryNumeric_ExpAddrFinal,\n\t\tAddressSource = AddressSource_ExpAddrFinal\n\t)) ~> snkCardHolderWithExpAddr\nNoAddr sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCardHolderId as long,\n\t\tCardHolderLastName as string,\n\t\tCardHolderFirstName as string,\n\t\tSocialSecurtyNum as string,\n\t\tBirthDate as date,\n\t\tAddress1LineOne as string,\n\t\tAddress1LineTwo as string,\n\t\tAddress1City as string,\n\t\tAddress1State as string,\n\t\tAddress1ZipCode as string,\n\t\tHomePhone as string,\n\t\tBusinessPhone as string,\n\t\tCheckingAccountNum as string,\n\t\tSavingsAccountNum as string,\n\t\tCardNum as string,\n\t\tAccountNum as string,\n\t\tCardHolder_Type_Cd as string,\n\t\tCardHolderPositionCd as string,\n\t\tAccountSystemEntryDate as date,\n\t\tExpirationDate as date,\n\t\tCardsIssuedCnt as string,\n\t\tStatementCycleCd as string,\n\t\tCrossReferenceAccountNum1 as string,\n\t\tCrossReferenceAccountNum2 as string,\n\t\tCrossReferenceAccountNum3 as string,\n\t\tAccountBalance as decimal(19,4),\n\t\tExternalStatus as string,\n\t\tInternalStatus as string,\n\t\tCardStatus as string,\n\t\tCardStatusChangeDate as date,\n\t\tSourceId as string,\n\t\tReportDate as date,\n\t\tLoadDate as timestamp,\n\t\tAddress1CountryAlpha3 as string,\n\t\tAddress1CountryNumeric as integer,\n\t\tAddressSource as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 3,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCardHolderLastName = CardHolderLastName_NoAddr,\n\t\tCardHolderFirstName = CardHolderFirstName_NoAddr,\n\t\tSocialSecurtyNum = SocialSecurtyNum_NoAddr,\n\t\tBirthDate = BirthDate_NoAddr,\n\t\tHomePhone = HomePhone_NoAddr,\n\t\tBusinessPhone = BusinessPhone_NoAddr,\n\t\tCheckingAccountNum = CheckingAccountNum_NoAddr,\n\t\tSavingsAccountNum = SavingsAccountNum_NoAddr,\n\t\tCardNum = CardNum_NoAddr,\n\t\tAccountNum = AccountNum_NoAddr,\n\t\tCardHolder_Type_Cd = CardHolder_Type_Cd_NoAddr,\n\t\tCardHolderPositionCd = CardHolderPositionCd_NoAddr,\n\t\tAccountSystemEntryDate = AccountSystemEntryDate_NoAddr,\n\t\tExpirationDate = ExpirationDate_NoAddr,\n\t\tCardsIssuedCnt = CardsIssuedCnt_NoAddr,\n\t\tStatementCycleCd = StatementCycleCd_NoAddr,\n\t\tCrossReferenceAccountNum1 = CrossReferenceAccountNum1_NoAddr,\n\t\tCrossReferenceAccountNum2 = CrossReferenceAccountNum2_NoAddr,\n\t\tCrossReferenceAccountNum3 = CrossReferenceAccountNum3_NoAddr,\n\t\tAccountBalance = AccountBalance_NoAddr,\n\t\tExternalStatus = ExternalStatus_NoAddr,\n\t\tInternalStatus = InternalStatus_NoAddr,\n\t\tCardStatus = CardStatus_NoAddr,\n\t\tCardStatusChangeDate = CardStatusChangeDate_NoAddr,\n\t\tSourceId = SourceId_NoAddr,\n\t\tReportDate = ReportDate_NoAddr,\n\t\tAddressSource = AddressSource_NoAddr\n\t)) ~> snkNoAddr"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/PMTREQ')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "folder": {
                    "name": "Zelle/DropToDW"
                },
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "dropZoneTransactions_ZellePMTREQ",
                                "type": "DatasetReference"
                            },
                            "name": "PMTREQSource"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "zelle_payment_raw",
                                "type": "DatasetReference"
                            },
                            "name": "paymentraw"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "AddingFileName"
                        }
                    ],
                    "script": "parameters{\n\tfileName as string\n}\nsource(output(\n\t\tBR_ID as string,\n\t\tMEM_ID as string,\n\t\tPAE_ID as string,\n\t\tTRANSACTION_AMT as string,\n\t\tTRANSACTION_NOTIFICATION as string,\n\t\tRECIPIENT_STATUS as string,\n\t\tPM_ID as string,\n\t\tPAYOPT_SHORT_NAME as string,\n\t\tTRANSACTION_ID as string,\n\t\tTRANSACTION_TYPE as string,\n\t\tTRANSACTION_STATUS as string,\n\t\tTRANSACTION_COMPLETE_DATE as string,\n\t\tTRANSACTION_MODIFIED_DATE as string,\n\t\tFORCE_WF_ID as string,\n\t\tTRANSACTION_START_DATE as string,\n\t\tXPPMTMAP_RLT_PMT_ID as string,\n\t\tTRANSACTION_CONFIRM_NO as string,\n\t\tNOTIFICATION_DELVRY_METHD as string,\n\t\tTRANSACTION_DELVRY_METHD as string,\n\t\tPMT_EXTERNAL_ID as string,\n\t\tPMT_REQUEST_ID as string,\n\t\tSENDER_NAME as string,\n\t\tREQUESTOR_NAME as string,\n\t\tDM_PROV_TYPE as string,\n\t\tRECIPIENT_NAME as string,\n\t\tORIGINATING_ORG_ID as string,\n\t\tORIGINATING_ORG_NAME as string,\n\t\tRECEIVING_ORG_ID as string,\n\t\tRECEIVING_ORG_NAME as string,\n\t\tCLIENT_APP_NAME as string,\n\t\tSESSION_DEVICE_ID as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> PMTREQSource\nPMTREQSource derive(File_Name = $fileName) ~> AddingFileName\nAddingFileName sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tBR_ID as string,\n\t\tMEM_ID as string,\n\t\tPAE_ID as string,\n\t\tTRANSACTION_AMT as string,\n\t\tTRANSACTION_NOTIFICATION as string,\n\t\tRECIPIENT_STATUS as string,\n\t\tPM_ID as string,\n\t\tPAYOPT_SHORT_NAME as string,\n\t\tTRANSACTION_ID as long,\n\t\tTRANSACTION_TYPE as string,\n\t\tTRANSACTION_STATUS as string,\n\t\tTRANSACTION_COMPLETE_DATE as string,\n\t\tTRANSACTION_MODIFIED_DATE as string,\n\t\tFORCE_WF_ID as string,\n\t\tTRANSACTION_START_DATE as string,\n\t\tXPPMTMAP_RLT_PMT_ID as integer,\n\t\tTRANSACTION_CONFIRM_NO as string,\n\t\tNOTIFICATION_DELVRY_METHD as string,\n\t\tTRANSACTION_DELVRY_METHD as string,\n\t\tPMT_EXTERNAL_ID as string,\n\t\tPMT_REQUEST_ID as string,\n\t\tSENDER_NAME as string,\n\t\tREQUESTOR_NAME as string,\n\t\tDM_PROV_TYPE as string,\n\t\tRECIPIENT_NAME as string,\n\t\tORIGINATING_ORG_ID as string,\n\t\tORIGINATING_ORG_NAME as string,\n\t\tRECEIVING_ORG_ID as string,\n\t\tRECEIVING_ORG_NAME as string,\n\t\tCLIENT_APP_NAME as string,\n\t\tSESSION_DEVICE_ID as string,\n\t\tFile_Name as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> paymentraw"
                }
            },
            "dependsOn": []
        }
    ]
}